<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.1.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2020-06-22T17:32:38-03:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">CGomesu</title><subtitle>A blog and portfolio website built with Jekyll and hosted on Github Pages</subtitle><author><name>Carlos Gomes</name></author><entry><title type="html">Youtube live-streams as IPTV channels for TVHeadend</title><link href="http://localhost:4000/blog/Youtube-as-IPTV-with-TVH/" rel="alternate" type="text/html" title="Youtube live-streams as IPTV channels for TVHeadend" /><published>2020-05-07T00:00:00-03:00</published><updated>2020-05-07T00:00:00-03:00</updated><id>http://localhost:4000/blog/Youtube-as-IPTV-with-TVH</id><content type="html" xml:base="http://localhost:4000/blog/Youtube-as-IPTV-with-TVH/">&lt;b&gt;- Update tracker -&lt;/b&gt;&lt;br /&gt;&lt;div&gt;&lt;i&gt;May 19th, 2020 - &lt;/i&gt;Added info about TVH m3u re-fetch period and youtube4tvh cronjob for streams that change very often.&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;May 14th, 2020 - &lt;/i&gt;Added more info about streamlink install and outdated versions; fixed a few typos. &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Introduction&lt;/b&gt;&lt;/div&gt;&lt;div&gt;
In this guide, we will learn how to feed Youtube live-streams into a TVHeadend (TVH) server as Internet protocol television (IPTV) channels.&amp;nbsp; This is a fairly advanced guide but I'll try my best to make it as digestible as possible to any individual with minimal knowledge about selfhosting.&amp;nbsp; You will need a &lt;b&gt;Linux distro&lt;/b&gt; (e.g., Debian, Ubuntu) to follow this guide.&amp;nbsp; All the software described here is &lt;b&gt;free&lt;/b&gt; and &lt;b&gt;open-source&lt;/b&gt;.&lt;/div&gt;
&lt;br /&gt;
The guide is divided into eight sections:&lt;br /&gt;
&lt;br /&gt;
1. &lt;a href=&quot;#motivation&quot;&gt;Motivation&lt;/a&gt;&lt;br /&gt;
2. &lt;a href=&quot;#objectives&quot;&gt;Objectives&lt;/a&gt;&lt;br /&gt;
3. &lt;a href=&quot;#clientserverlayout&quot;&gt;Client-server layout&lt;/a&gt;&amp;nbsp; &lt;br /&gt;
4. &lt;a href=&quot;#youtube4tvh&quot;&gt;Youtube4tvh&lt;/a&gt;&lt;br /&gt;
5. &lt;a href=&quot;#streamlink&quot;&gt;Streamlink &lt;/a&gt;&lt;br /&gt;
6. &lt;a href=&quot;#tvhserver&quot;&gt;TVH server&lt;/a&gt;&lt;br /&gt;
7. &lt;a href=&quot;#tvhclient&quot;&gt;TVH client&lt;/a&gt;&lt;br /&gt;
8. &lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;br /&gt;
&lt;br /&gt;
I'm not an expert in any of the topics mentioned here.&amp;nbsp; If you have suggestions on how to improve something, please leave a comment below stating what could be changed and why it should be changed.&lt;br /&gt;
&lt;br /&gt;
Youtube4tvh is a utility program I wrote just for this guide.&amp;nbsp; I welcome anyone who wants to improve it or fork into something more abstract.&amp;nbsp; If that sounds like something you want to do, please head to github (&lt;a href=&quot;https://github.com/cgomesu/youtube4tvh&quot;&gt;https://github.com/cgomesu/youtube4tvh&lt;/a&gt;) and hit me up once you've done some coding. &lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;&lt;a id=&quot;motivation&quot; name=&quot;motivation&quot;&gt;1. Motivation&lt;/a&gt; &lt;/b&gt;&lt;br /&gt;
There are multiple reasons to watch Youtube live-streams as if they were IPTV channels.&amp;nbsp; Here are a reasons few that come to mind right now:&lt;br /&gt;
&lt;ul&gt;
&lt;li&gt;It's free and all programs are open-source; &lt;/li&gt;
&lt;li&gt;There is at least one Youtube 24/7 live-stream that you enjoy. Some of my personal favorites, per category:&amp;nbsp;&lt;/li&gt;
&lt;ul&gt;
&lt;li&gt;News: &lt;a href=&quot;https://www.youtube.com/user/NewsOnABC&quot; target=&quot;_blank&quot;&gt;ABC News AU&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/user/skynews&quot; target=&quot;_blank&quot;&gt;Sky News&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/user/deutschewelleenglish&quot; target=&quot;_blank&quot;&gt;DW in English&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/user/france24english&quot; target=&quot;_blank&quot;&gt;France 24 in English&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Space: &lt;a href=&quot;https://www.youtube.com/user/NASAtelevision&quot; target=&quot;_blank&quot;&gt;NASA TV&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/channel/UCakgsb0w7QB0VHdnCc-OVEA&quot; target=&quot;_blank&quot;&gt;Space Videos&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/channel/UC9pYOJPB5UYlMlGKKZWo-Bw&quot; target=&quot;_blank&quot;&gt;Space &amp;amp; The Universe HD&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Webcam - Nature: &lt;a href=&quot;https://www.youtube.com/channel/UCZXZQxS3d6NpR-eH_gdDwYA&quot; target=&quot;_blank&quot;&gt;Cornell Lab of Ornithology Cams&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/user/MontereyBayAquarium&quot; target=&quot;_blank&quot;&gt;Monterey Bay Aquarium&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/channel/UCSyg9cb3Iq-NtlbxqNB9wGw&quot; target=&quot;_blank&quot;&gt;Explore Oceans&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/channel/UC-2KSeUU5SMCX6XLRD-AEvw&quot; target=&quot;_blank&quot;&gt;Explore Nature&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/channel/UCi3T_esus8Sr9I-3W5teVQQ&quot; target=&quot;_blank&quot;&gt;Volcanoverse &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Webcam - Other: &lt;a href=&quot;https://www.youtube.com/channel/UCOIkT9bq-1N2BvrsBjhNlag&quot; target=&quot;_blank&quot;&gt;Virtual Railfan&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/user/earthTV&quot; target=&quot;_blank&quot;&gt;earthTV&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/channel/UCMpn1qLudF-zb4M4bqxLIbw&quot; target=&quot;_blank&quot;&gt;I Love You Venice&lt;/a&gt;, &lt;/li&gt;
&lt;li&gt;Radio:&amp;nbsp; &lt;a href=&quot;https://www.youtube.com/user/bgmchannelbgm&quot; target=&quot;_blank&quot;&gt;BGM channel&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/user/cafedelmar&quot; target=&quot;_blank&quot;&gt;Cafe del Mar&lt;/a&gt;, &lt;a href=&quot;https://www.youtube.com/user/stayseemusic&quot; target=&quot;_blank&quot;&gt;Stay See&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;You want to make selected Youtube live-streams available as IPTV channels through a TVH server (TVH -&amp;gt; Streamlink pipe -&amp;gt; Youtube); &lt;/li&gt;
&lt;li&gt;You want to keep your streaming services as centralized as possible.&amp;nbsp; That is, instead of multiple apps, you can manage all of them using a single application (TVH);&lt;/li&gt;
&lt;li&gt;You want to take advantage of one of the fastest and most reliable media delivery networks out there (Youtube's CDN);&lt;/li&gt;&lt;li&gt;You dislike Youtube ads (Streamlink will get rid of them without the need to install any filtering system);&lt;/li&gt;&lt;li&gt;You like how it looks for the client:&lt;/li&gt;&lt;/ul&gt;&lt;div style=&quot;text-align: center;&quot;&gt;&lt;iframe allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot; frameborder=&quot;0&quot; height=&quot;315&quot; src=&quot;https://www.youtube-nocookie.com/embed/9FSPf5wISUY&quot; width=&quot;560&quot;&gt;&lt;/iframe&gt;&lt;br /&gt;&lt;/div&gt;

&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;
&lt;a id=&quot;objectives&quot; name=&quot;objectives&quot;&gt;&lt;b&gt;2. Objectives&lt;/b&gt;&lt;/a&gt;&lt;br /&gt;
&lt;span class=&quot;flex-auto mb-2&quot;&gt;&lt;span class=&quot;text-gray-dark mr-2&quot;&gt;By the end of the guide, you'll have learned how to do the following:&lt;/span&gt;&lt;/span&gt;&lt;br /&gt;
&lt;ul&gt;&lt;li&gt;Create a customized Youtube live-stream
m3u playlist with the help of youtube4tvh; &lt;/li&gt;&lt;li&gt;Install a TVH server on a Linux machine;&lt;/li&gt;&lt;li&gt;Install Streamlink (https://streamlink.github.io) to pipe live-stream data into a TVH server;&lt;/li&gt;&lt;li&gt;Add a Youtube live-stream m3u playlist to a TVH server as an IPTV auto network;&lt;/li&gt;&lt;li&gt;Configure a TVH server to auto-map muxes to channels using bouquets;&lt;/li&gt;&lt;li&gt;Create a cronjob to automatically update the Youtube live-stream m3u playlist every day at 6am.&lt;/li&gt;&lt;/ul&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;
&lt;a id=&quot;clientserverlayout&quot; name=&quot;clientserverlayout&quot;&gt;&lt;b&gt;3. Client-server layout&lt;/b&gt;&lt;/a&gt;&lt;br /&gt;
There are three main components to this setup, namely &lt;b&gt;TVH&lt;/b&gt;, &lt;b&gt;Streamlink&lt;/b&gt;, and &lt;b&gt;youtube4tvh&lt;/b&gt;, which are all open-source and free:&lt;br /&gt;
&lt;br /&gt;
- &lt;b&gt;TVHeadend&lt;/b&gt; (&lt;a href=&quot;https://github.com/tvheadend/tvheadend&quot;&gt;https://github.com/tvheadend/tvheadend&lt;/a&gt;): &lt;span class=&quot;text-gray-dark mr-2&quot;&gt;Tvheadend is a TV 
streaming server for Linux supporting DVB-S, DVB-S2, DVB-C, DVB-T, ATSC,
 IPTV, SAT&amp;gt;IP and other formats through the unix pipe as input sources.&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;table align=&quot;center&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;tr-caption-container&quot; style=&quot;margin-left: auto; margin-right: auto; text-align: center;&quot;&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: center;&quot;&gt;&lt;a href=&quot;https://1.bp.blogspot.com/-_ute9lktZgM/XrGOMVJSDWI/AAAAAAAABYo/Bp1w9A8GEWUT1K7Q9j8GKJLAff8EZ1ZCwCEwYBhgL/s1600/tvh_github_front.png&quot; style=&quot;margin-left: auto; margin-right: auto;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;876&quot; data-original-width=&quot;1243&quot; height=&quot;225&quot; src=&quot;https://1.bp.blogspot.com/-_ute9lktZgM/XrGOMVJSDWI/AAAAAAAABYo/Bp1w9A8GEWUT1K7Q9j8GKJLAff8EZ1ZCwCEwYBhgL/s320/tvh_github_front.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td class=&quot;tr-caption&quot; style=&quot;text-align: center;&quot;&gt;TVH Github&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;br /&gt;
&lt;table align=&quot;center&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;tr-caption-container&quot; style=&quot;margin-left: auto; margin-right: auto; text-align: center;&quot;&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: center;&quot;&gt;&lt;a href=&quot;https://1.bp.blogspot.com/-zqIz7kT7Ir8/XrGPUu7BflI/AAAAAAAABY0/dfEWu_DsjhsM02fAq1inAsEvywLfQ5t1QCNcBGAsYHQ/s1600/tvh_webui_channels.png&quot; style=&quot;margin-left: auto; margin-right: auto;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;900&quot; data-original-width=&quot;1600&quot; height=&quot;180&quot; src=&quot;https://1.bp.blogspot.com/-zqIz7kT7Ir8/XrGPUu7BflI/AAAAAAAABY0/dfEWu_DsjhsM02fAq1inAsEvywLfQ5t1QCNcBGAsYHQ/s320/tvh_webui_channels.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td class=&quot;tr-caption&quot; style=&quot;text-align: center;&quot;&gt;WebUI&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;br /&gt;
- &lt;b&gt;Streamlink&lt;/b&gt; (&lt;a href=&quot;https://github.com/streamlink/streamlink&quot;&gt;https://github.com/streamlink/streamlink&lt;/a&gt;): &lt;span class=&quot;text-gray-dark mr-2&quot;&gt;Streamlink is a CLI utility which pipes video streams from various services into a video player.&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;table align=&quot;center&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;tr-caption-container&quot; style=&quot;margin-left: auto; margin-right: auto; text-align: center;&quot;&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: center;&quot;&gt;&lt;a href=&quot;https://1.bp.blogspot.com/-0_NUjHhKTSM/XrGOMRMfrEI/AAAAAAAABYg/lwPtu4Q4eC86LxzC0MOBjujiMKAnoqs-wCEwYBhgL/s1600/streamlink_github_front.png&quot; style=&quot;margin-left: auto; margin-right: auto;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;878&quot; data-original-width=&quot;1255&quot; height=&quot;223&quot; src=&quot;https://1.bp.blogspot.com/-0_NUjHhKTSM/XrGOMRMfrEI/AAAAAAAABYg/lwPtu4Q4eC86LxzC0MOBjujiMKAnoqs-wCEwYBhgL/s320/streamlink_github_front.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td class=&quot;tr-caption&quot; style=&quot;text-align: center;&quot;&gt;Streamlink Github&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;span class=&quot;text-gray-dark mr-2&quot;&gt;&amp;nbsp;&lt;/span&gt; &lt;br /&gt;
- &lt;b&gt;youtube4tvh&lt;/b&gt; (&lt;a href=&quot;https://github.com/cgomesu/youtube4tvh&quot;&gt;https://github.com/cgomesu/youtube4tvh&lt;/a&gt;): &lt;span class=&quot;flex-auto mb-2&quot;&gt;&lt;span class=&quot;text-gray-dark mr-2&quot;&gt;Youtube4tvh
 is a Python CLI program that uses Youtube API to create (or update) m3u
 playlists of live-streams that are piped into a TVH server via 
Streamlink.&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;br /&gt;
&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;table align=&quot;center&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;tr-caption-container&quot; style=&quot;margin-left: auto; margin-right: auto;&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style=&quot;text-align: center;&quot;&gt;&lt;a href=&quot;https://1.bp.blogspot.com/-gBCFFy5hQS8/XrGOMOs5qmI/AAAAAAAABYk/JQRfD5SmlWoary4SX_rODeCgXRpIoiT6wCK4BGAsYHg/youtube4tvh_github_front.png&quot; style=&quot;margin-left: auto; margin-right: auto;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;872&quot; data-original-width=&quot;1292&quot; src=&quot;https://1.bp.blogspot.com/-gBCFFy5hQS8/XrGOMOs5qmI/AAAAAAAABYk/JQRfD5SmlWoary4SX_rODeCgXRpIoiT6wCK4BGAsYHg/s320/youtube4tvh_github_front.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class=&quot;tr-caption&quot; style=&quot;text-align: center;&quot;&gt;youtube4tvh Github&lt;br /&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span class=&quot;flex-auto mb-2&quot;&gt;&lt;span class=&quot;text-gray-dark mr-2&quot;&gt;For this guide, we will assume that such components are related to each other and any clients (any IPTV players, such as VLC, Plex or a Kodi PVR) according to the following layout:&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;span class=&quot;flex-auto mb-2&quot;&gt;&lt;span class=&quot;text-gray-dark mr-2&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/span&gt;
&lt;br /&gt;
&lt;table align=&quot;center&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; class=&quot;tr-caption-container&quot; style=&quot;margin-left: auto; margin-right: auto; text-align: center;&quot;&gt;&lt;tbody&gt;
&lt;tr&gt;&lt;td style=&quot;text-align: center;&quot;&gt;&lt;a href=&quot;https://1.bp.blogspot.com/-ir6K0zJDeUA/XrGkNGgQ6RI/AAAAAAAABZA/RFsB4RuO8vUL3QES8upgLGff-FNMUWgCQCNcBGAsYHQ/s1600/tvh_layout.jpg&quot; style=&quot;margin-left: auto; margin-right: auto;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;456&quot; data-original-width=&quot;713&quot; height=&quot;204&quot; src=&quot;https://1.bp.blogspot.com/-ir6K0zJDeUA/XrGkNGgQ6RI/AAAAAAAABZA/RFsB4RuO8vUL3QES8upgLGff-FNMUWgCQCNcBGAsYHQ/s320/tvh_layout.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td class=&quot;tr-caption&quot; style=&quot;text-align: center;&quot;&gt;Client-server layout&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;span class=&quot;flex-auto mb-2&quot;&gt;&lt;span class=&quot;text-gray-dark mr-2&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;flex-auto mb-2&quot;&gt;&lt;span class=&quot;text-gray-dark mr-2&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;flex-auto mb-2&quot;&gt;&lt;span class=&quot;text-gray-dark mr-2&quot;&gt;However, once you're done with the initial configuration, you can try changing it to accomodate your needs.&amp;nbsp; For example, you can multicast a live-stream to a TVH server using VLC (&lt;a href=&quot;https://tvheadend.org/projects/tvheadend/wiki/VLC_Multicasting&quot;&gt;https://tvheadend.org/projects/tvheadend/wiki/VLC_Multicasting&lt;/a&gt;).&amp;nbsp; This will let you use a single connection to Youtube be distributed to multiple clients, instead of creating multiple connections to Youtube--definitely take a look at it if you're serving a large number of clients with your TVH server.&amp;nbsp; Also, you might want to pipe the Streamlink data to FFMPEG before sending to TVH, which will let you set custom AV codecs.&amp;nbsp; &lt;/span&gt;&lt;/span&gt;&lt;br /&gt;

&lt;br /&gt;
&lt;br /&gt;
&lt;a id=&quot;youtube4tvh&quot; name=&quot;youtube4tvh&quot;&gt;&lt;b&gt;4. Youtube4tvh&lt;/b&gt;&lt;/a&gt;&lt;br /&gt;
This is a utility program that will let us create and manage m3u playlist of Youtube live-streams.&amp;nbsp; It uses Youtube API, so we'll need to create one (or more) to use it before anything else.&amp;nbsp; APIs have daily quotas that this program will reach fairly quickly.&amp;nbsp; Fortunately, those quotas are &lt;i&gt;per project&lt;/i&gt;, and you should be able to create multiple projects with a free account.&amp;nbsp; For more info, checkout the github page: &lt;a href=&quot;https://github.com/cgomesu/youtube4tvh&quot; target=&quot;_blank&quot;&gt;https://github.com/cgomesu/youtube4tvh&lt;/a&gt;.&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;4.1 Create a Youtube API v3&lt;/b&gt;&lt;br /&gt;&lt;div&gt;
You can find instructions on the official page (&lt;a href=&quot;https://developers.google.com/youtube/v3/getting-started&quot; target=&quot;_blank&quot;&gt;https://developers.google.com/youtube/v3/getting-started&lt;/a&gt;).&amp;nbsp; (Don't follow that video though. It's outdated as fuck.)&amp;nbsp; If you don't want to head there, here is a streamlined version:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Sing up for or Log into your Google account&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to your API dashboard (&lt;a href=&quot;https://console.developers.google.com/apis/&quot; target=&quot;_blank&quot;&gt;https://console.developers.google.com/apis/&lt;/a&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Create a project (top left &amp;gt; new project)&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-R-QxzI50PSM/XrG9CM1oMbI/AAAAAAAABZM/FDF302FBLOwWw-6Ddd6M8vBGxsBQTxwygCNcBGAsYHQ/s1600/youtubeapi_newproject.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;788&quot; data-original-width=&quot;1600&quot; height=&quot;98&quot; src=&quot;https://1.bp.blogspot.com/-R-QxzI50PSM/XrG9CM1oMbI/AAAAAAAABZM/FDF302FBLOwWw-6Ddd6M8vBGxsBQTxwygCNcBGAsYHQ/s200/youtubeapi_newproject.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Give the project a name and create it (this should take a few seconds...)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Select the project you just created and in the dashboard,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# go to '+ Enable APIs and Services'&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;
&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-v0g5lipXau0/XrG-DsCyuVI/AAAAAAAABZU/ZeVpnsY_M9AKM5pX93fcC1umKTV9di1_QCNcBGAsYHQ/s1600/youtubeapi_enableapi.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;827&quot; data-original-width=&quot;1600&quot; height=&quot;103&quot; src=&quot;https://1.bp.blogspot.com/-v0g5lipXau0/XrG-DsCyuVI/AAAAAAAABZU/ZeVpnsY_M9AKM5pX93fcC1umKTV9di1_QCNcBGAsYHQ/s200/youtubeapi_enableapi.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Search for Youtube Data API v3 and enable it.&amp;nbsp; &lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# It should redirect you to its dashboard but if doesn't, select Manage&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Select Create Credentials (if you don't see a button, &lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# just go to Credentials in the side menu)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# It's going to ask you which API you're going to use (select Youtube Data API v3),&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# where you'll be calling it from (Other UI) and what data (Public data). &lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Then select 'What credentials do I need?' and it will generate an unrestricted &lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# API for the project you created.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# In the side menu, go to Credentials and Edit the API Key you generated&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Under 'API restrictions', select Restrict key &amp;gt; Youtube Data API v3 &amp;gt; Save&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;verdana&amp;quot;;&quot;&gt;That's it! Your key is that long string with random letters and numbers in the column labeled Key (blurred in the figure below). Whenever you see a field to YOURKEY, use that one.&amp;nbsp; Also, you can repeat this process to generate additional keys.&amp;nbsp; It's a good idea to do so. &lt;/span&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-QWYvTwv7erw/XrHDdzFiT-I/AAAAAAAABZg/pHuM-S46tq8kI0YCmq9LZ_H0p0vIXXTOACNcBGAsYHQ/s1600/youtubeapi_goodapi.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;783&quot; data-original-width=&quot;1600&quot; height=&quot;97&quot; src=&quot;https://1.bp.blogspot.com/-QWYvTwv7erw/XrHDdzFiT-I/AAAAAAAABZg/pHuM-S46tq8kI0YCmq9LZ_H0p0vIXXTOACNcBGAsYHQ/s200/youtubeapi_goodapi.png&quot; width=&quot;320&quot; /&gt;&lt;br /&gt;&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;br /&gt;&lt;a href=&quot;https://1.bp.blogspot.com/-QWYvTwv7erw/XrHDdzFiT-I/AAAAAAAABZg/pHuM-S46tq8kI0YCmq9LZ_H0p0vIXXTOACNcBGAsYHQ/s1600/youtubeapi_goodapi.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;/a&gt;&lt;/div&gt;&lt;b&gt;4.2 Install youtube4tvh&lt;/b&gt;&lt;br /&gt;&lt;div&gt;Open a terminal window and run the following&lt;br /&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;sudo apt update&lt;br /&gt;sudo apt install git python-pip&lt;br /&gt;cd /opt&lt;br /&gt;sudo git clone https://github.com/cgomesu/youtube4tvh.git&lt;br /&gt;cd youtube4tvh&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Install required packages via pip&lt;br /&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;pip install .&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Test the program (change YOURKEY for your API key)&lt;br /&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;cd youtube4tvh&lt;br /&gt;python main.py --apikey=YOURKEY --channelname=&quot;DW News&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Now, there should be an output.m3u file on the same folder you are (you can 'ls' to list files).&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;If you run into permission issues, make sure to use a user with sudo perission.&amp;nbsp; Also, if your user is not allowed to write to /opt, then run the follwing (changing YOURSER for your sudo username):&lt;br /&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;sudo chown -R YOURUSER:sudo /opt/youtube4tvh&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;If everything looks good, go ahead and add permission to execute the streamlink.sh helper script that will pipe data into TVH (if you want to change settings from streamlink, change them in the streamlink.sh file):&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;sudo chmod +x /opt/youtube4tvh/streamlink.sh&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Done!&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;b&gt;4.3 Basic usage&lt;/b&gt;&lt;br /&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;(If you don't feel like reading this, please refer to the &lt;a href=&quot;https://github.com/cgomesu/youtube4tvh/blob/master/README.md&quot; target=&quot;_blank&quot;&gt;README.md&lt;/a&gt; in the Github page.) &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;This program has two modes of execution, '&lt;b&gt;add&lt;/b&gt;' and '&lt;b&gt;update&lt;/b&gt;'. The '--mode=add' is the default mode and it will create an m3u file if you don't specify one.&amp;nbsp; However, if you do provide an '--m3uinput=/path/to/file.m3u', it will instead append channels to output.m3u. (If --m3uinput and --m3uoutput are the same, then it appends to itself).&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;The '--mode=update' will parse an '--m3uinput=/path/to/file.m3u' and update all URLs to make sure they are the ones currently available (instead of a broken URL).&amp;nbsp; This is useful because even though some Youtube channels stream 24/7, they will at times stop and restart the stream, which will cause Youtube to generate a new URL to their live-stream.&amp;nbsp; The '--mode=update' will make sure your output.m3u is always using the correct URLs.&amp;nbsp; (Again, if you want to update the same input file, then point both --m3uinput and --m3uoutput to the same m3u file.)&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;First, we will generate a youtube.m3u file with the channel &quot;DW News&quot;.&amp;nbsp; Afterwards, we will append a couple of additional channels to the youtube.m3u file.&amp;nbsp; Then, we will create a cronjob to keep our youtube.m3u up-to-date.&lt;br /&gt;&lt;/div&gt;
&lt;br /&gt;&lt;div&gt;
4.3.1 Create youtube.m3u file and add the channel &quot;DW News&quot; (change YOURKEY to your actual API key)&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;cd /opt/youtube4tvh/youtube4tvh&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;python main.py --apikey=YOURKEY --m3uoutput=youtube.m3u --channelname=&quot;DW News&quot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;4.3.2 Append the channel &quot;France 24 English&quot; to the youtube.m3u file&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;python main.py --apikey=YOURKEY --m3uinput=youtube.m3u --m3uoutput=youtube.m3u --channelname=&quot;France 24 English&quot;&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;4.3.3 Append the channel &quot;Explore Nature&quot; to the youtube.m3u file&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;python main.py --apikey=YOURKEY --m3uinput=youtube.m3u --m3uoutput=youtube.m3u --channelname=&quot;Explore Nature&quot;&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;4.3.4 Create a cronjob to update the youtube.m3u file everyday at 6am (make sure the paths are correct first!)&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# First, make a backup or your youtube.m3u file&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;cp /opt/youtube4tvh/youtube4tvh/youtube.m3u /opt/youtube4tvh/youtube4tvh/youtube.m3u.backup&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Create a cronjob&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;crontab -e&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Add the following at the bottom&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;0 6 * * * /usr/bin/python /opt/youtube4tvh/youtube4tvh/main.py --apikey=YOURKEY --m3uinput=&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;/opt/youtube4tvh/youtube4tvh/&lt;/span&gt;youtube.m3u --m3uoutput=&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;/opt/youtube4tvh/youtube4tvh/&lt;/span&gt;youtube.m3u --mode=update&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Save and exit (ctrl+x)&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;
&lt;br /&gt;&lt;div&gt;
That's all we need to do with this program.&amp;nbsp; If you ever feel like adding a new channel to the playlist, you can just repeat the &quot;Append&quot; examples with the new channel instead.&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;If you want to remove a channel, you'll need to manually edit the youtube.m3u file (remove the channel's #EXTINF row and the one immediately below it, which contains the pipe command).&amp;nbsp; You can also manually edit the m3u file to add a group-title to the channels (see sample/input.m3u, for example), change their order, etc.&amp;nbsp; Just use your favorite text editor to do that and when you're done, save preserving the .m3u extension.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;4.4 Recommendations&lt;/b&gt;&lt;br /&gt;&lt;/div&gt;
&lt;div&gt;Theoretically, the m3u playlists can contain as many streams as you want.&amp;nbsp; However, as a general rule of thumb, I find it useful to create one m3u playlist for &lt;i&gt;each type of streaming channel&lt;/i&gt;--for example, youtube-webcams.m3u, youtube-news.m3u, youtube-radio.m3u, and etc--and then have a unique API key for each of them.&amp;nbsp; This way, I can run the youtube4tvh cronjob more often, thus reducing the chance of having broken URLs in the m3u file.&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;a id=&quot;streamlink&quot; name=&quot;streamlink&quot;&gt;&lt;b&gt;5. Streamlink&lt;/b&gt;&lt;/a&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Streamlink is an awesome utility program and if you've never used it before, make sure to check their documentation at &lt;a href=&quot;https://streamlink.github.io/&quot; target=&quot;_blank&quot;&gt;https://streamlink.github.io/&lt;/a&gt;.&amp;nbsp; Here, we will only use it to pipe data from Youtube to a TVH server but Streamlink is able to pipe video streams from many other platforms (Twitch, Dailymotion, etc.).&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;To install Streamlink, please follow the instructions on the official website: &lt;a href=&quot;https://streamlink.github.io/install.html&quot; target=&quot;_blank&quot;&gt;https://streamlink.github.io/install.html&lt;/a&gt;.&amp;nbsp; Make sure you're running the latest version afterwards.&amp;nbsp; You can find the installed version by running 'streamlink --version', which should be the same one as the latest version on their Releases page (&lt;a href=&quot;https://github.com/streamlink/streamlink/releases&quot; target=&quot;_blank&quot;&gt;https://github.com/streamlink/streamlink/releases&lt;/a&gt;). &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;(It looks like multiple repos are distributing a much older version than the 1.4.1, which is the latest when this article was first posted.&amp;nbsp; If that's the case for your distro, take a look at the PyPi and source installation on their Install page.&amp;nbsp; Uninstall the older version and install via pip and if that doesn't work, try cloning their git repo and install via setup-tools, very much like the youtube4tvh utility.)&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;In &lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;/opt/youtube4tvh&lt;/span&gt;, you'll notice a file called &lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;streamlink.sh&lt;/span&gt;.&amp;nbsp; That is a &lt;b&gt;helper script&lt;/b&gt; that TVH will use to get the video stream from a Youtube URL.&amp;nbsp; If you open it with a text editor, you'll see the follwoing:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;#!/bin/bash&lt;br /&gt;####################################################&lt;br /&gt;################ Streamlink script #################&lt;br /&gt;####################################################&lt;br /&gt;# The default version writes the data from the best&lt;br /&gt;# stream ($1, the first argument) to stdout using a&lt;br /&gt;# thread pool of size 2 to download HLS segments.&lt;br /&gt;# Everything else follows default values.&lt;br /&gt;#&lt;br /&gt;# Inspired by niwi_niwi's post at&lt;br /&gt;# https://tvheadend.org/boards/5/topics/35658&lt;br /&gt;#&lt;br /&gt;# More info: https://streamlink.github.io/cli.html&lt;br /&gt;#&lt;br /&gt;####################################################&lt;br /&gt;#### Add/modify script according to your needs #####&lt;br /&gt;streamlink \&lt;br /&gt;--stdout \&lt;br /&gt;--hls-segment-threads 4 \&lt;br /&gt;--hls-live-edge 10 \&lt;br /&gt;&quot;$1&quot; best&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;The actual command to execute streamlink and its options are all at the bottom.&amp;nbsp; If you know what you're doing and want to play with different configurations, go ahead and change the arguments in the streamlink command.&amp;nbsp; Say, if instead of playing always the 'best' stream you want to play the 480p version, then just change it to that (but always leave --stdout or you won't be able to pipe data to TVH).&amp;nbsp; Once again, check the docs for a comprehensive list of options (&lt;a href=&quot;https://streamlink.github.io/cli.html&quot; target=&quot;_blank&quot;&gt;https://streamlink.github.io/cli.html&lt;/a&gt;).&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;To test the script, you can simply execute the following (change YOUTUBEURL for the URL of a Youtube live-stream):&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;courier&quot;&gt;bash streamlink.sh YOUTUBEURL&lt;/font&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;You should see a whole bunch random characters as streamlink outputs the video stream to the terminal.&amp;nbsp; Hit ctrl+c to terminate the process.&amp;nbsp; If you have a player, you can run the command above with a pipe to the player.&amp;nbsp; Using VLC (&lt;a href=&quot;https://github.com/videolan/vlc&quot; target=&quot;_blank&quot;&gt;https://github.com/videolan/vlc&lt;/a&gt;), for example:&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;courier&quot;&gt;bash streamlink.sh YOUTUBEURL | vlc -&lt;br /&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;a id=&quot;tvhserver&quot; name=&quot;tvhserver&quot;&gt;&lt;b&gt;6. TVH server&lt;/b&gt;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;TVH was a game-changer for me.&amp;nbsp; It offers a centralized system to manage multiple IPTV networks and TV tuners.&amp;nbsp; I can fully customize how all channels will show up to all my clients and that's so much better than using multiple (and sometimes shady) applications developed by each IPTV provider.&amp;nbsp; If a channel is down, I can tell TVH to automatically remove it or remap to another provider.&amp;nbsp; If the EPG is not working, I can tell TVH to fetch from another source.&amp;nbsp; If a client does not support a particular type of codec, I can create a profile that uses the codec that works with it.&amp;nbsp; And all those changes are automatically applied to all clients, without the need to change one by one, because they are all getting data from my TVH server instead of external sources.&amp;nbsp; (It's the TVH server that should always do that latter.)&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;6.1 Installation&lt;/b&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;To install a TVH server, please follow the instructions on the official website: &lt;a href=&quot;https://tvheadend.org/projects/tvheadend/wiki/Download&quot; target=&quot;_blank&quot;&gt;https://tvheadend.org/projects/tvheadend/wiki/Download&lt;/a&gt;.&amp;nbsp; I strongly suggest you to install from the repo to make it easy to update with a simple &lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;apt update&lt;/span&gt; command.&amp;nbsp; Also, make sure you're running the latest version of it afterwards.&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;6.2 Basic Configuration&lt;/b&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;After installing TVH, head to the webUI on &lt;a href=&quot;http://localhost:9981&quot; target=&quot;_blank&quot;&gt;http://localhost:9981&lt;/a&gt;.&amp;nbsp; (If you're not running a desktop environment on the same machine, access it from another machine on the same network and change localhost for the IP of the machine running the TVH server.&amp;nbsp; Also, it goes without saying that the machine hosting the TVH server should have a fixed IP address at the local network because all the clients will be pointing to it.)&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;If you provided admin credentials for TVH during the installation, it will ask you to identify yourself now.&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;TVH will start the wizard the first time you access the webUI but you can just skip it (hit Cancel).&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Notice that there are several tabs in the webUI but many options will not show up if the &quot;View level&quot; is set to Basic, so let's change the default to &lt;b&gt;Expert&lt;/b&gt;:&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Configuration &amp;gt; General &amp;gt; Base &amp;gt; Server &amp;gt; Set &quot;User interface level&quot; to Expert and hit Save&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Now, let's configure the Stream profiles to restart on error:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Configuration &amp;gt; Stream &amp;gt; Stream profiles &amp;gt; htsp &amp;gt; Check &quot;restart on error&quot; hit Save&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;(You can repeat that step to all profiles that you're going to use.&amp;nbsp; I usually just use htsp for clients and pass for auto-recording.)&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;While we're at it, let's go ahead and customize the Recording settings as well.&amp;nbsp; This is all really up to your own preferences but this is what I use that is different from the default configuration:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Configuration &amp;gt; Recording &amp;gt; DVR Profiles &amp;gt; Default profile &lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# DVR file retention: 3 days&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Pre-recording padding: 5 mins&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Post-recording padding: 5 mins&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Recording system path: /path/to/my/NAS/media/iptv/recording&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Maintain free storage space in MiB: 5000&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# File permissions: 0777&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Filename character set: UTF-8&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Skip commercials: Unchecked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Format string: $c/$t - $c - %F - %R$n.$x&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Directory permissions: 0777&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Make subdirectories per channel: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Include date in filename: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Include time in filename: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Remove all unsafe characters from filename: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Hit Save&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;We're done with the basic configuration!&amp;nbsp; Before moving to the next section, notice that at the bottom of the webUI there's a bar called &quot;&lt;b&gt;Tvheadend log&lt;/b&gt;&quot; and on the opposite side, there is a button.&amp;nbsp; Click on it to open the log.&amp;nbsp; This is very useful to check if there's any error while you're making changes to the server.&amp;nbsp; Keep it open as you change the settings and if you see an error, there's probably something misconfigured that you should fix before moving on.&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;6.3 Adding the youtube.m3u playlist as an IPTV automatic network to the TVH server&lt;/b&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;We're now going to create an IPTV network using the youtube.m3u file we created with youtube4tvh.&amp;nbsp; Open the TVH webUI and do the following:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Configuration &amp;gt; DVB Inputs &amp;gt; Networks &amp;gt; Add&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Type: IPTV automatic network&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;verdana&amp;quot;;&quot;&gt;This will redirect to IPTV settings.&amp;nbsp; Change the following:&lt;/span&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Network name: youtube&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# URL: file:///opt/youtube4tvh/youtube4tvh/youtube.m3u&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Create bouquet: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Channel numbers start from: 1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Accept zero value for TSID: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Provider network name: youtube&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Ignore provider's channel numbers: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Character set: UTF-8&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Scan after creation: Unchecked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Content character set: UTF-8&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Service ID: 1&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Hit Create&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;Before we move on, now is a good time to check if streamlink and the helper script are working.&amp;nbsp; We're going to force play a few muxes (channels from your youtube.m3u playlist) to make sure that it's all good before mapping them to actual TV channels.&amp;nbsp; (You gonna need a player for this step; if you don't have one, skip it or install VLC).&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Configuration &amp;gt; DVB Inputs &amp;gt; Muxes &amp;gt; Choose a random one and Hit the Play button&lt;/span&gt;&lt;/div&gt;&lt;br /&gt;&lt;div&gt;The selected stream should show up in a few seconds.&amp;nbsp; If it doesn't, there's likely an issue with streamlink or the player or both, in which case you should stop and try to solve it before moving on.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;6.4 Mapping services to channels: Bouquets and auto-mapping&lt;/b&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;There are two ways of mapping services to channels.&amp;nbsp; The standard way is to go to the Services tab and choose Map Selected &amp;gt; Map all services.&amp;nbsp; This should work very well if your muxes won't ever change.&amp;nbsp; However, if they do (as in our case), they won't be automatically remapped to their channel, and you gonna have to do this mapping process manually once again, multiple times.&amp;nbsp; We don't wanna do that.&amp;nbsp; Fortunately, there's a second way of mapping services to channels that does so automatically, even if your muxes change, and that's via &lt;b&gt;Bouquets&lt;/b&gt;.&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Remember that when we created the youtube IPTV network, we selected &quot;Create a bouquet&quot;.&amp;nbsp; Because of that, there's now a new entry in Configuration &amp;gt; Channel / EPG &amp;gt; Bouquets &amp;gt; &quot;youtube&quot;.&amp;nbsp; So, let's go ahead and edit it a little bit:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Configuration &amp;gt; Channel / EPG &amp;gt; Bouquets &amp;gt; Edit the &quot;youtube&quot; bouquet&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Enabled: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Auto-map to channels: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Channel mapping options: Select all&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Create tags: Create provider name tags, Create network name tags&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Hit Save&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Wait a few seconds and go to the &quot;Channels&quot; tab and you should see all your channels auto-mapped to their services.&amp;nbsp; If you make any changes to the youtube.m3u playlist, the bouquet should automatically detect those changes from now on.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;6.5 EPG data&lt;br /&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Some of the 24/7 news channels on Youtube (e.g., France 24, DW) actually follow the same eletronic program guide (EPG) as their Cable/Satellite broadcast.&amp;nbsp; So, if you want, you can add EPG data to their Youtube live-stream.&amp;nbsp; There's a fantastic program called &lt;b&gt;WebGrab+Plus&lt;/b&gt; (&lt;a href=&quot;http://webgrabplus.com/&quot; target=&quot;_blank&quot;&gt;http://webgrabplus.com/&lt;/a&gt;) that can do that for you &lt;b&gt;for free&lt;/b&gt;, but there's a learning curve to it and how to feed the data to TVH (netcat or curl).&amp;nbsp; I'm planning on writing a guide about it in the near future, as I work on a parser for the site.pack folder as well.&amp;nbsp; But if you don't feel like diving into that, you can always pay an EPG provider--&lt;a href=&quot;https://lmgtfy.com/?q=epg+provider&quot; target=&quot;_blank&quot;&gt;just Google it&lt;/a&gt;--and manually add it to your clients (bad) or try to figure it out how to feed the EPG data to the TVH server (good).&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;6.6 Creating and editing Users for clients&lt;/b&gt;&lt;/div&gt;&lt;div&gt;Clients can access TVH using the same credentials as you've been using to configure the TVH server (admin access). As a general rule of thumb, however, that's not a good practice.&amp;nbsp; Also, if you have multiple clients, it's nice to know what each one is trying to access on your TVH server.&amp;nbsp; So, let's go ahead and create a &quot;client&quot; user:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Configuration &amp;gt; Users &amp;gt; Access Entries &amp;gt; Add&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Streaming: Select all&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Video recorder: Basic, HTSP, View All&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Hit Create&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;Now let's add a password for it:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Configuration &amp;gt; Users &amp;gt; Passwords &amp;gt; Add&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Enabled: Checked&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Username: client&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Password: password&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Hit Create&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;That's it!&amp;nbsp; You can repeat this process as many times as you need and play around with permissions, depending on your use-case.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;6.7 Re-fetch period and youtube4tvh cronjobs&lt;/b&gt;&lt;/div&gt;&lt;div&gt;If you've a youtube m3u playlist with channels that are likely to change multiple times during the same day, then it's a good idea to create a separate playlist for those channels.&amp;nbsp; Then, when you create a youtube4tvh cronjob for the new m3u playlist, make it run more frequently (e.g., every 5 mins would be &quot;*/5 * * * *&quot;) and in the TVH server, add a new IPTV auto network for the new m3u playlist and in its settings, edit the &quot;re-fetch period&quot; to match the cronjob update interval (5); hit save and then restart the TVH server to apply the new settings. If you've done it right, the TVH server will now check the m3u playlist at an interval equal to the re-fetch period and update any new/changed mux on it, which will be automatically mapped to a channel in its bouquet.&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;a href=&quot;#&quot; id=&quot;tvhclient&quot;&gt;7. TVH client&lt;/a&gt;&lt;br /&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;There are multiple ways to watch the channels on your TVH server, including directly from the webUI itself (EPG tab &amp;gt; Watch TV).&amp;nbsp; The one I use is &lt;b&gt;Kodi&lt;/b&gt; (&lt;a href=&quot;https://kodi.tv/download&quot; target=&quot;_blank&quot;&gt;https://kodi.tv/download&lt;/a&gt;) + &lt;b&gt;TVH client addon&lt;/b&gt; because my Kodi clients also access my Plex server.&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;You can install Kodi on virtually any single-board computer, such as Raspberry Pi (&lt;a href=&quot;https://www.raspberrypi.org/&quot; target=&quot;_blank&quot;&gt;https://www.raspberrypi.org/&lt;/a&gt;) and Odroid (&lt;a href=&quot;https://www.hardkernel.com/&quot; target=&quot;_blank&quot;&gt;https://www.hardkernel.com/&lt;/a&gt;), and Linux distro.&amp;nbsp; There are hundreds of guides showing how to install Kodi, so I won't do that.&amp;nbsp; Instead, I'll talk about the &lt;b&gt;TVH client addon&lt;/b&gt; for it.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;7.1 Install a TVH client addon for Kodi&lt;/b&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Open Kodi and try to install via the official repo:&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;courier&quot;&gt;&lt;br /&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;courier&quot;&gt;# Go to Add-ons &amp;gt; Install from repo &amp;gt; PVR clients&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font face=&quot;courier&quot;&gt;# Look for Tvheadend HTSP Client and install it&lt;/font&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Now, depending on the distribution, you won't see the &quot;PVR clients&quot; option.&amp;nbsp; In this case, you have to manually install the TVH client.&amp;nbsp; On Debian, for example, you can install it like so:&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Open a terminal&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;sudo apt update&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;sudo apt install kodi-pvr-hts&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;(Another option is to download a .zip of the addon but please do your research first.&amp;nbsp; Don't download and install addons from random repos.)&amp;nbsp; If you didn't see any error, it means the PVR client is now available on Kodi, so open it (restart it, if it was already open) and then do the following (changing the values to the appropriate ones for your TVH server and client credentials):&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to Add-ons &amp;gt; My add-ons &amp;gt; PVR clients &amp;gt; Tvheadend HTSP Client &amp;gt; Configure &lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# &lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;&amp;gt; Connection Settings&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# IP address: The IP address of the machine hosting your TVH server&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# HTTP port: 9981&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# HTSP port: 9982&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Username: client&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Password: password&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# &amp;gt; Streaming settings&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Profile to use: htsp&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# (If your connection is pretty good, you might want to try enabling predictive tuning &lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# but I've had mixed results with it.)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Hit OK&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Restart Kodi&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;If you want to play around, you can create a video profile just for this client and then set the Profile to use it.&amp;nbsp; This could be a profile that transcodes to a particular AV codec that best fits the client hardware, for example.&amp;nbsp; Be mindful that whenever you make a change to the addon, you'll need to restart Kodi to see the changes take effect.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;Test the Kodi client:&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;courier&amp;quot;;&quot;&gt;# Go to TV &amp;gt; Channels &amp;gt; Play random one&lt;/span&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;If everything is working as it should, you should now be able to watch the stream from your Kodi client.&amp;nbsp; Play around with it and try recording something, too.&amp;nbsp; Now it's time to fine-tune your TVH server to best serve your clients.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;You can make further client-side changes in &lt;b&gt;Kodi's PVR &amp;amp; Live TV settings menu&lt;/b&gt;, such as mapping channels to specific numbers, behavior of changing channels, etc.&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;a href=&quot;#&quot; id=&quot;conclusion&quot;&gt;&lt;b&gt;8. Conclusion&lt;/b&gt;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Congratulations for reaching the end of this guide.&amp;nbsp; As I said before, one of my future projects is to work on a parser for the Webgrab+Plus EPG data and then write a guide on how to implement it using the current setup.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;If you found this useful or have suggestions on how to improve this guide, please leave a comment and I'll try to reply asap.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;--CG&lt;br /&gt;&lt;/div&gt;</content><author><name>Carlos Gomes</name></author><category term="github" /><category term="iptv" /><category term="kodi" /><category term="streamlink" /><category term="tvheadend" /><category term="youtube" /></entry><entry><title type="html">Using any IR remote with the Odroid C2 IR receiver + LibreElec OS</title><link href="http://localhost:4000/blog/IR-with-odroidc2/" rel="alternate" type="text/html" title="Using any IR remote with the Odroid C2 IR receiver + LibreElec OS" /><published>2020-02-18T00:00:00-03:00</published><updated>2020-02-18T00:00:00-03:00</updated><id>http://localhost:4000/blog/IR-with-odroidc2</id><content type="html" xml:base="http://localhost:4000/blog/IR-with-odroidc2/">&lt;div&gt;In case you didn't know, the Odroid C2 (&lt;a href=&quot;https://www.hardkernel.com/shop/odroid-c2/&quot;&gt;https://www.hardkernel.com/shop/odroid-c2/&lt;/a&gt;) comes with an onboard infrared (IR) receiver.&amp;nbsp; Until a few days ago, I thought that such a receive was only compatible with their own IR remote controller but it turns out you can use it with &lt;i&gt;any IR controller&lt;/i&gt;.&amp;nbsp; We can do that with a package called &lt;i&gt;lirc&lt;/i&gt;, which stands for linux infrared remote control (&lt;a href=&quot;http://www.lirc.org/html/&quot;&gt;http://www.lirc.org/html/&lt;/a&gt;).&amp;nbsp; &lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;&lt;a href=&quot;https://1.bp.blogspot.com/-8FZvCPFMbgQ/XrQpSpxWgWI/AAAAAAAABaw/B_23PiUqm3YiWwv8tZ4bxtRL_zjygHGrQCK4BGAsYHg/odroidc2.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;396&quot; data-original-width=&quot;608&quot; src=&quot;https://1.bp.blogspot.com/-8FZvCPFMbgQ/XrQpSpxWgWI/AAAAAAAABaw/B_23PiUqm3YiWwv8tZ4bxtRL_zjygHGrQCK4BGAsYHg/s320/odroidc2.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;This tutorial is for the LibreElec OS but one can use lirc with any linux distro and the configuration is not completely different than the one shown here.&amp;nbsp; Here's a step by step procedure to get the IR working with lirc:&lt;/div&gt;
&lt;br /&gt;
# Tested with LibreElec Official OS 9.0.2 running Kodi 18.2&lt;br /&gt;
&lt;br /&gt;
# SSH into your Odroid C2&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;ssh root@IP&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
# Get a list of all available keys that you can map to your IR remote&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;irrecord --list-namespace&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
# Kill running lircd, if there's any&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;ps aux | grep lircd&lt;br /&gt;kill PID&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
# Turn off all other IR compatible devices before moving forward&lt;br /&gt;
&lt;br /&gt;
# Go to /storage and record IR custom keys: &lt;br /&gt;
# Follow the instructions that will show yup on your screen&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;cd /storage/&lt;br /&gt;irrecord&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
# If succesful, irrecord will genetare a *.conf file on /storage/&lt;br /&gt;
# with the name you provided at the beginnig&lt;br /&gt;
&lt;br /&gt;
# Copy the *.conf file to /storage/.conf/lircd.conf&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;cp *.conf /storage/.conf/lircd.conf&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
# Reboot your system&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;reboot now&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
# Test your IR remote&lt;br /&gt;</content><author><name>Carlos Gomes</name></author><category term="odroid" /><category term="sbc" /></entry><entry><title type="html">The math of a bruised souleater</title><link href="http://localhost:4000/blog/Math-of-bruised-souleater/" rel="alternate" type="text/html" title="The math of a bruised souleater" /><published>2019-07-19T00:00:00-03:00</published><updated>2019-07-19T00:00:00-03:00</updated><id>http://localhost:4000/blog/Math-of-bruised-souleater</id><content type="html" xml:base="http://localhost:4000/blog/Math-of-bruised-souleater/">(&lt;a href=&quot;https://www.reddit.com/r/magicTCG/comments/7phqk1/the_math_of_a_bruised_souleater/&quot; target=&quot;_blank&quot;&gt;This is a repost of my original reddit post here&lt;/a&gt;. I've made a few changes to the original version to improve readability.)&lt;br /&gt;
&lt;br /&gt;
This is a post about an interesting interaction that came up 
yesterday, when I was making changes to an EDH deck.  I thought someone 
else might find this analysis interesting, so I decided to share it 
here. If you spot an error, feel free to point it out. The interaction is about two cards, namely &lt;b&gt;Immolating Souleater&lt;/b&gt; and &lt;b&gt;Bruse Tarl, Boorish Herder&lt;/b&gt;.&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-s-SLz9sGOLs/XTHQDNmxMJI/AAAAAAAABO0/YiEh01uLvpE8brJ2jevwByYpDzONxzK_ACLcBGAs/s1600/souleater.jpeg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;936&quot; data-original-width=&quot;672&quot; height=&quot;320&quot; src=&quot;https://1.bp.blogspot.com/-s-SLz9sGOLs/XTHQDNmxMJI/AAAAAAAABO0/YiEh01uLvpE8brJ2jevwByYpDzONxzK_ACLcBGAs/s320/souleater.jpeg&quot; width=&quot;229&quot; /&gt;&lt;/a&gt;&lt;a href=&quot;https://1.bp.blogspot.com/-Nyz-HJZx2JE/XTHQDBRvESI/AAAAAAAABOw/NXIJVTlc10gLNO5TtdzqoXDxsQQRbmkzgCLcBGAs/s1600/brusetarl.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;936&quot; data-original-width=&quot;672&quot; height=&quot;320&quot; src=&quot;https://1.bp.blogspot.com/-Nyz-HJZx2JE/XTHQDBRvESI/AAAAAAAABOw/NXIJVTlc10gLNO5TtdzqoXDxsQQRbmkzgCLcBGAs/s320/brusetarl.jpg&quot; width=&quot;229&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
Suppose you have Immolating Souleater on the battlefield and Bruse Tarl, Boorish Herder's triggered ability give it double-strike
 and lifelink. Souleater is a 1/1 creature that costs 2 colorless and let's you pay one 
phyrexian red mana to give it +1/+0 until eot.&amp;nbsp; Let's assume you cannot 
pay red mana and if you want to activate Souleater's ability, you need 
to pay life.  The souleater is not under summoning sickness, so it can 
attack an opponent.  For now, let's also assume you have 40 life and 
your opponents also have 40 life.  You see an opportunity to kill an 
opponent, declare attack, the souleater is not blocked, you pay 38 life 
to make it a 20/1 creature with double-strike and lifelink, and after 
all damage is done, your opponent dies and you gain 40 life back (for a 
+2 net life, as you end up with 42 in the end).&lt;br /&gt;
&lt;br /&gt;
This is cool and all but what happens when you cannot pay 38 life 
before the first hit?  What if your opponent has more life than you?  
Life-wise, does it matter how much life you pay before the first hit?  
How much life can you pay at any given point to either maximize damage 
or minimize net life loss?  Let's think about it.&lt;br /&gt;
&lt;br /&gt;
Souleater's activated ability is a simple linear function of the 
amount of life you pay.  Let &lt;i&gt;x&lt;/i&gt; be the amount of life paid, so that 
souleater's power is given by&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-dhyLVHpLnmA/XTHcIETpmhI/AAAAAAAABQE/1ZexZS3jUU0UcTfjP_hABEKUfXvSVME_QCLcBGAs/s1600/eq1.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;85&quot; data-original-width=&quot;252&quot; src=&quot;https://1.bp.blogspot.com/-dhyLVHpLnmA/XTHcIETpmhI/AAAAAAAABQE/1ZexZS3jUU0UcTfjP_hABEKUfXvSVME_QCLcBGAs/s1600/eq1.png&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
(To make it simple, we 
ignore the fact that phyrexian mana is always 2 life and let &lt;i&gt;x&lt;/i&gt; be any 
non-negative integer.)  As in the previous example, if you pay 38 life, 
f(38) = 20.  The tricky part is how this simple linear function 
interacts with Bruse's ability, that is, the ability to give a creature 
double-strike and lifelink (&quot;bruised&quot;).&lt;br /&gt;
&lt;br /&gt;
The intuition with double-strike is to multiply &lt;i&gt;f&lt;/i&gt;(&lt;i&gt;x&lt;/i&gt;) by 2, which 
would be correct if we only paid life before the first hit (&lt;i&gt;x1&lt;/i&gt;) and 
nothing else before the second hit (&lt;i&gt;x2&lt;/i&gt; = 0) but that does not need to be
 the case.  Say we pay 20 life before the first hit (&lt;i&gt;x1&lt;/i&gt; = 20) and an 
additional 10 life afterwards (&lt;i&gt;x2&lt;/i&gt; = 10).  How much damage will we deal 
to the opponent?  We know that &lt;i&gt;f&lt;/i&gt;(20) = 11 and &lt;i&gt;f&lt;/i&gt;(10) = 6 but the first 
hit should carry over to the second becasue the +1/+0 lasts until eot.  
At this point, let's make an equation for the first hit,&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-z1yLtLX24OY/XTHcBOjC2KI/AAAAAAAABQA/HVGKRrMqP78TUTaPL_iU3YKiGIqFaRB9wCLcBGAs/s1600/eq2.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;56&quot; data-original-width=&quot;269&quot; src=&quot;https://1.bp.blogspot.com/-z1yLtLX24OY/XTHcBOjC2KI/AAAAAAAABQA/HVGKRrMqP78TUTaPL_iU3YKiGIqFaRB9wCLcBGAs/s1600/eq2.png&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
and another for the second hit,&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/--iRYU1Z-mJo/XTHb9Eu15-I/AAAAAAAABP8/hFQYI9dP434sUqBY2b9qymaItdCx4JMfwCLcBGAs/s1600/eq3.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;72&quot; data-original-width=&quot;728&quot; height=&quot;37&quot; src=&quot;https://1.bp.blogspot.com/--iRYU1Z-mJo/XTHb9Eu15-I/AAAAAAAABP8/hFQYI9dP434sUqBY2b9qymaItdCx4JMfwCLcBGAs/s400/eq3.png&quot; width=&quot;400&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
&amp;nbsp;Now, we can sum both functions to get the total 
amount of damage dealt (&lt;i&gt;d&lt;/i&gt;) by a Souleater with double-strike:&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-2AlH-sOq3eY/XTHb5lsAczI/AAAAAAAABP0/q7kf9ig5JY4f_qcvpq-UZ8r0AQpn1PSgwCLcBGAs/s1600/eq4.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;77&quot; data-original-width=&quot;1051&quot; height=&quot;46&quot; src=&quot;https://1.bp.blogspot.com/-2AlH-sOq3eY/XTHb5lsAczI/AAAAAAAABP0/q7kf9ig5JY4f_qcvpq-UZ8r0AQpn1PSgwCLcBGAs/s640/eq4.png&quot; width=&quot;640&quot; /&gt;&lt;/a&gt; &lt;/div&gt;
&lt;br /&gt;
(It's easy to see how one could generalize 
this to triple-strike, quadruple-strike, ..., but let’s not delve into 
it now.)  Therefore, if &lt;i&gt;x1&lt;/i&gt;=20 and &lt;i&gt;x2&lt;/i&gt;=10, &lt;i&gt;d&lt;/i&gt;(20,10) = &lt;i&gt;f1&lt;/i&gt;(20)+&lt;i&gt;f2&lt;/i&gt;(20,10), 
which is 27 damage for 30 life paid.&lt;br /&gt;
&lt;br /&gt;
So, now we have an equation (&lt;i&gt;d&lt;/i&gt;) that we can play with. For 
example, if an opponent has 60 life, how much life do you need to pay?  
Because &lt;i&gt;x1&lt;/i&gt; is multiplied by two, if the goal is to deal as much damage 
as possible, you should always pay as much life as possible before the 
first hit.  The easiest way here is to pay 58 life right away (&lt;i&gt;x1&lt;/i&gt; = 58 
and &lt;i&gt;x2&lt;/i&gt; = 0) but what if you only have 40 life.  Our dmg equation shows 
that if you have 40 life, you can pay 38 before the first hit (&lt;i&gt;x1&lt;/i&gt;=38) 
but in order to kill your opp, you’d have to pay 40 before the second 
hit (&lt;i&gt;x2&lt;/i&gt;=40), which we can already tell that won’t be possible with the 
other parameters we set for this scenario.  The question is then how 
high can x2 be in order to deal the highest amount of damage without 
killing ourselves?  Now we need to figure out how to add lifelink into 
the equation.&lt;br /&gt;
&lt;br /&gt;
Lifelink will affect your life total (&lt;i&gt;k&lt;/i&gt;) and because a souleater with
 double-strike hits twice, let’s define your starting life total (&lt;i&gt;k1&lt;/i&gt;), 
our life total after the first hit (&lt;i&gt;k2&lt;/i&gt;), and our life total after the 
second hit (&lt;i&gt;k3&lt;/i&gt;).  As before, let’s say that we pay 20 life before the 
first hit (&lt;i&gt;x1&lt;/i&gt; = 20) and an additional 10 life afterwards (&lt;i&gt;x2&lt;/i&gt; = 10).  
Because our life total matters here, let’s also assume that our starting
 life total is &lt;i&gt;k1&lt;/i&gt; = 40.  So, if &lt;i&gt;x1&lt;/i&gt; = 20, our remaining life before the 
first hit is the difference &lt;i&gt;k1&lt;/i&gt; – &lt;i&gt;x1&lt;/i&gt; = 20 and immediately after the first
 hit, the lifelink effect makes it go up by &lt;i&gt;f1&lt;/i&gt;(20) = 11 points, which 
means that we can define&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-GsrX01pXEuE/XTHbxWAC-_I/AAAAAAAABPs/mR0TJCRNV64RWjV0XIXfcUySeJnTM4yNQCLcBGAs/s1600/eq5.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;62&quot; data-original-width=&quot;515&quot; height=&quot;38&quot; src=&quot;https://1.bp.blogspot.com/-GsrX01pXEuE/XTHbxWAC-_I/AAAAAAAABPs/mR0TJCRNV64RWjV0XIXfcUySeJnTM4yNQCLcBGAs/s320/eq5.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
and similarly,&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-utLNlH51tho/XTHbr4Fi5jI/AAAAAAAABPo/-PAxT2mVQiYQ80pN9B3X2f48lw9Wq5dRACLcBGAs/s1600/eq6.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;66&quot; data-original-width=&quot;543&quot; height=&quot;38&quot; src=&quot;https://1.bp.blogspot.com/-utLNlH51tho/XTHbr4Fi5jI/AAAAAAAABPo/-PAxT2mVQiYQ80pN9B3X2f48lw9Wq5dRACLcBGAs/s320/eq6.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
Now we have a simple way of defining net-life gain/loss (&lt;i&gt;nl&lt;/i&gt;) as the 
difference between &lt;i&gt;k3&lt;/i&gt; and &lt;i&gt;k1&lt;/i&gt;, namely&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-wB-v9hjyG84/XTHbkZJ-79I/AAAAAAAABPg/GhCI37Sar-8Z5DCqxBakzrdlgYU6KH8NACLcBGAs/s1600/eq7.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;76&quot; data-original-width=&quot;373&quot; height=&quot;65&quot; src=&quot;https://1.bp.blogspot.com/-wB-v9hjyG84/XTHbkZJ-79I/AAAAAAAABPg/GhCI37Sar-8Z5DCqxBakzrdlgYU6KH8NACLcBGAs/s320/eq7.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
which funny enough doesn’t include &lt;i&gt;x1&lt;/i&gt; into the equation. The equation 
for nl tells us three main things: (a) that we will never net more than 2
 life, (b) we’ll net life loss proportional to the amount of life 
we pay before the second hit (&lt;i&gt;x2&lt;/i&gt;), and (c) net-wise, it doesn’t really 
matter how much life you pay before the first hit (&lt;i&gt;x1&lt;/i&gt;).  (&lt;i&gt;x1&lt;/i&gt; doesn’t 
matter because in our scenario, it always nets 0 life.  Think about it. 
 You are paying 2 life to increase 1 dmg but with double-strike, 
souleater hits twice and in the end, you get your 2 life back with 
lifelink.  The only thing that carries over is the base power, which is 
why there’s a constant 2 in the equation for &lt;i&gt;k3&lt;/i&gt;.)&lt;br /&gt;
&amp;nbsp; &lt;br /&gt;
Good.  Now, what can we do with that?  Well, we can figure out how to
 maximize dmg in terms of our life total, so that you deal as much 
damage as possible without dying for any given amount of starting life 
total (the math equivalent of “just pay as much life as you can before 
each hit”).  For &lt;i&gt;k1&lt;/i&gt; &amp;gt; 0, let &lt;i&gt;i1&lt;/i&gt; and &lt;i&gt;i2&lt;/i&gt; be the
 amount of life you want to have before the first hit and second hit, 
respectively, then&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-TmQSb93i_k0/XTHbdhU4O1I/AAAAAAAABPc/HlFtRFclXToZBqRfoMAcEp-Zsm1Fg6yMQCLcBGAs/s1600/eq8.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;60&quot; data-original-width=&quot;1343&quot; height=&quot;27&quot; src=&quot;https://1.bp.blogspot.com/-TmQSb93i_k0/XTHbdhU4O1I/AAAAAAAABPc/HlFtRFclXToZBqRfoMAcEp-Zsm1Fg6yMQCLcBGAs/s640/eq8.png&quot; width=&quot;640&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
(There’s an additional complication here because of how we use phyrexian
 mana but we don’t need to worry too much about it as long as we can 
figure out the appropriate &lt;i&gt;i1&lt;/i&gt; and &lt;i&gt;i2&lt;/i&gt; for each value of &lt;i&gt;k1&lt;/i&gt;.
  For example, if you have 40 life, max(&lt;i&gt;d&lt;/i&gt;) = 2.5 + 1.25(40) - .75(2) -
 .5(2) = 50.  Because &lt;i&gt;k1&lt;/i&gt; is multiplied by a value greater than one, this
 equation tells us that the amount of damage done above your starting 
life increases with our starting life.  For example, if you have 40 
life, you can deal 10 damage above your starting life to an opponent 
(e.g., kill an opponent with 50 life points) but if you have 20 life, 
you can only deal 5 damage above your starting life (e.g., kill an 
opponent with 25 life points).  It’s easier to see this relationship 
when we plot max(&lt;i&gt;d&lt;/i&gt;) as a function of the starting life (&lt;i&gt;k1&lt;/i&gt;) using the 
minimum appropriate values of &lt;i&gt;i1&lt;/i&gt; and &lt;i&gt;i2&lt;/i&gt;:&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&amp;nbsp;&lt;a href=&quot;https://1.bp.blogspot.com/-hhrmKTAKKeM/XTHQzX5EznI/AAAAAAAABPA/hG4vnqzyI4IqoF7_o_K-nwu2dKs87zjpwCLcBGAs/s1600/plot.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;587&quot; data-original-width=&quot;750&quot; height=&quot;250&quot; src=&quot;https://1.bp.blogspot.com/-hhrmKTAKKeM/XTHQzX5EznI/AAAAAAAABPA/hG4vnqzyI4IqoF7_o_K-nwu2dKs87zjpwCLcBGAs/s320/plot.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
If we fit a linear equation to it, we get a solution that does
 not require knowing the exact values of &lt;i&gt;i1&lt;/i&gt; and &lt;i&gt;i2&lt;/i&gt;, namely max(&lt;i&gt;d&lt;/i&gt;) ≈ 
.65 + 1.25&lt;i&gt;k1&lt;/i&gt;.&amp;nbsp; However, because each point is equally likely, as /u/darth_aardvark pointed out, the appropriate intercept should be the mean of all possible combinations of min(&lt;i&gt;i1&lt;/i&gt;) and min(&lt;i&gt;i2&lt;/i&gt;), which can only take on values {1, 2}.&amp;nbsp; There is a total of 2^2 combinations of&amp;nbsp; min(&lt;i&gt;i1&lt;/i&gt;) and min(&lt;i&gt;i2&lt;/i&gt;), namely&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-c2o6F9bHJ2w/XTIS0C8UVFI/AAAAAAAABQg/G2uYk4TQKbgrS2hxpM9zLhWKJFopuHjKQCLcBGAs/s1600/eq8-2.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;237&quot; data-original-width=&quot;736&quot; height=&quot;128&quot; src=&quot;https://1.bp.blogspot.com/-c2o6F9bHJ2w/XTIS0C8UVFI/AAAAAAAABQg/G2uYk4TQKbgrS2hxpM9zLhWKJFopuHjKQCLcBGAs/s400/eq8-2.png&quot; width=&quot;400&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
Those equations give us a mean intercept = .625 and a revised and final formula for the maximum amount of damage that a &quot;bruised&quot; souleater can do, specifically &lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-ZUFPOQUI09E/XTHa0rg9LFI/AAAAAAAABPU/aYoGCoDLvzUKAyj-rBccRJpd5pUt152UwCLcBGAs/s1600/eq9.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;73&quot; data-original-width=&quot;337&quot; height=&quot;69&quot; src=&quot;https://1.bp.blogspot.com/-ZUFPOQUI09E/XTHa0rg9LFI/AAAAAAAABPU/aYoGCoDLvzUKAyj-rBccRJpd5pUt152UwCLcBGAs/s320/eq9.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
which is equivalent to the more memorable formula&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-01Bg4iZZAAE/XTIXoYSKvpI/AAAAAAAABQs/b7mIhtenEOMOwqKBzxS02gYHAwOh75pVQCLcBGAs/s1600/eq9-2.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;110&quot; data-original-width=&quot;523&quot; height=&quot;67&quot; src=&quot;https://1.bp.blogspot.com/-01Bg4iZZAAE/XTIXoYSKvpI/AAAAAAAABQs/b7mIhtenEOMOwqKBzxS02gYHAwOh75pVQCLcBGAs/s320/eq9-2.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
in which &lt;i&gt;k1&lt;/i&gt; is simply your life total before the attack.&amp;nbsp; The 5/4 coefficient is quite instructive because it connects this approach to /u/darth_aardvark's.&amp;nbsp; Specifically, the first maximized damage of a bruised souleater will hit for approximately half our life total (&lt;i&gt;k1&lt;/i&gt;/2), while the second hit will hit for half our life total plus half of the life gained from the second hit (&lt;i&gt;k1&lt;/i&gt;/2 + &lt;i&gt;k1&lt;/i&gt;/4), which gives us a total of 5/4*&lt;i&gt;k1&lt;/i&gt;.&lt;br /&gt;
&lt;br /&gt;
Well, this has been fun.  I’m sure there are other things we could 
play with here but I’ve had enough for now.  I think there are two main 
conclusions about a “bruised” Souleater.  The first and least obvious 
one imo is that the more life you have, the more damage you can deal 
above your own life total.  This is useful because it gives an intuition
 about whether you can kill an opponent or not at any given point (low 
life = cannot deal much above my own life; high life = can deal a bit 
more than my own life), and whether you should attempt to compute 
exacties.  In most cases, however, you won’t be able to deal a whole lot
 more than your own life.  The other conclusion is that the amount of 
life you pay before the first hit and second hit is net neutral and net 
negative, respectively, but I feel most of us would be able to figure 
this one out without much effort (lifelink gets only half the amount of 
life paid immediately before the second hit, while it gets it all back 
for the amount of life paid immediately before the first hit).&lt;br /&gt;
&lt;br /&gt;
Again, if you spot an error, please point it out. If you found a 
better way to look at this interaction or thought about a different 
scenario, feel free to explain it.</content><author><name>Carlos Gomes</name></author><category term="mtg" /><category term="math" /></entry><entry><title type="html">The probability of Warp World</title><link href="http://localhost:4000/blog/Probability-warp-world/" rel="alternate" type="text/html" title="The probability of Warp World" /><published>2019-07-15T00:00:00-03:00</published><updated>2019-07-15T00:00:00-03:00</updated><id>http://localhost:4000/blog/Probability-warp-world</id><content type="html" xml:base="http://localhost:4000/blog/Probability-warp-world/">&lt;div class=&quot;expando&quot; data-pin-condition=&quot;function() {return this.style.display != 'none';}&quot; style=&quot;clear: left; color: #cccccc; margin: 5px 0px; padding: 0px;&quot;&gt;
&lt;form action=&quot;https://www.reddit.com/r/magicTCG/comments/8956af/the_probability_of_warp_world_math/#&quot; class=&quot;usertext warn-on-unload&quot; id=&quot;form-t3_8956afvtw&quot; style=&quot;margin: 0px; padding: 0px;&quot;&gt;
&lt;div class=&quot;usertext-body may-blank-within md-container&quot; style=&quot;background-color: #373737; margin: 0px; padding: 0px; unicode-bidi: isolate;&quot;&gt;
&lt;div class=&quot;md&quot; style=&quot;background: rgba(0, 0, 0, 0) none repeat scroll 0% 0%; border-radius: 7px; border: 1px solid rgb(102, 102, 102); color: #dddddd; margin: 5px 0px; max-width: 60em; overflow-wrap: break-word; padding: 5px 10px;&quot;&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; padding: 0px;&quot;&gt;
&lt;div style=&quot;font-size: 1em;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;(&lt;a href=&quot;https://www.reddit.com/r/magicTCG/comments/8956af/the_probability_of_warp_world_math/&quot; target=&quot;_blank&quot;&gt;This is a repost from my original reddit post.&lt;/a&gt;)&lt;/span&gt;&lt;/div&gt;
&lt;b&gt;Introduction&lt;/b&gt;&lt;br /&gt;
&lt;div style=&quot;font-size: 1em;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;If you’re unfamiliar with &lt;b&gt;Warp World&lt;/b&gt;, you are in for a treat. It’s a 5RRR sorcery from Ravnica that reads as follows:&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;i style=&quot;font-weight: inherit; margin: 0px;&quot;&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;“Each player shuffles all permanents he or she owns into his or her library, then reveals that many cards from the top of his or her library. Each player puts all artifact, creature, and land cards revealed this way onto the battlefield, then does the same for enchantment cards, then puts all cards revealed this way that weren't put onto the battlefield on the bottom of his or her library.”&lt;/span&gt;&lt;/i&gt;&lt;br /&gt;
&lt;i style=&quot;font-weight: inherit; margin: 0px;&quot;&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/i&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-dDj9o9kRxD4/XSyCpGBovVI/AAAAAAAABK4/UmCDFCZZxk8dhAnKa_Ltcarv-mVVba61QCLcBGAs/s1600/rav-warp-world.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;936&quot; data-original-width=&quot;672&quot; height=&quot;320&quot; src=&quot;https://1.bp.blogspot.com/-dDj9o9kRxD4/XSyCpGBovVI/AAAAAAAABK4/UmCDFCZZxk8dhAnKa_Ltcarv-mVVba61QCLcBGAs/s320/rav-warp-world.jpg&quot; width=&quot;229&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;There are many different ways to build around such a card. For example, we can play mostly permanents in our deck (i.e., very few instants and sorceries), add creatures with ETB ability (e.g., Eternal Witness), add creatures with landfall ability (Lotus Cobra), and so on. I’m not going to tell you how to play Warp World or advertise any particular deck that takes advantage of it. Instead, I’ll try to formalize what happens when we cast Warp World, and how the outcome of casting it changes as a function of the type of cards we choose to play and when we cast it.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;This is not meant to be an exhaustive analysis of the card and all of its possible interactions. There are many other things that I’d like to talk about (e.g., stats for proper comparison of multivariate distributions of Warp World, describe the necessary and sufficient conditions to create an infinite loop in a Warp World deck) but I don’t have enough time to cover them right now. If someone shows interest in this sort of thing, I might release a more comprehensive version of this analysis in the future. Furthermore, I’m far from being smart enough to figure out the best way to deal with this issue. So, if you spot an error or thought about a much simpler way of analyzing Warp World, please feel free to share it in the comments below. Above all, this is meant to be an intellectual exercise (mostly mathematical/statistical). There’s math. There’re walls of text. No shortcuts. No tldr. Deal with it. (Just kidding! I’ll do my best to explain the mathematics with examples that most magic players should be familiar with.)&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;b&gt;The Basics&lt;/b&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;In a game of magic, we play with a deck, Ω, composed of&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;n&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;cards, such that Ω = {&lt;/span&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;ω&lt;/span&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;1&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, …,&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;ω&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;n&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;} is our deck. The current types of cards in MtG can be of two sorts, namely permanents (land, creature, artifact, enchantment, and planeswalker) and non-permanents (sorcery and instant). Let Λ be the set of all&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;z&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;permanents that we have in our deck (e.g., Elvish Mystic, forests, mountains, Primeval Titan), such that Λ = {&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;λ&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;1&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, …,&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;λ&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;z&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;} are all the permanents in our deck. Because there’re only permanents and non-permanents in our deck, the set of non-permanents can be defined as the negation of Λ, ¬Λ, such that ¬Λ∪Λ = Ω.&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;When a game of magic starts, our deck becomes our library. Let’s define our library by the set Θ of&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;k&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;cards, such that Θ = {&lt;/span&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;θ&lt;/span&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;1&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, …,&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;θ&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;k&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;} is our library, and the rules tell us that Θ ⊆ Ω, that is, all cards in our library are cards from our deck. In addition, when the game starts, it also creates other three zones that are of particular relevance to us, namely the battlefield, our hand, and the graveyard. Let’s define Ψ as the set of&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;y&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;permanents we have on the battlefield, such that Ψ = {&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;ψ&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;1&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, …,&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;ψ&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;y&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;} are the permanents we have on our side of the battlefield. To make matters as simple as possible for now, let’s also assume that Ψ ⊆ Λ, that is, all permanents we have on the battlefield are permanents from our deck, until otherwise specified, and permanents are all but planeswalkers. Then we define Α as the set of&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;a&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;permanents in our hand, such that Α = {&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;α&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;1&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, …,&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;α&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;a&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;} are the permanents in our hand, and B is the set of&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;b&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;permanents in our graveyard, B = {&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;β&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;1&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, …,&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;β&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;b&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;}. As before, let’s also assume that A ⊆ Λ and B ⊆ Λ.&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Now we have a fairly good characterization of our deck and board state, so let’s see what Warp World does. First, it makes us (a) count all permanents we have on the battlefield, (b) shuffle all of them into our library, then (c) reveal as many cards from the top of our library as permanents we counted, and finally, (d) put all revealed artifacts, creatures, lands, and (afterwards) enchantments onto the battlefield. Everything else that was not put onto the battlefield goes to the bottom of the library. (Our opponents do the same thing at the same time, and triggered abilities follow apnap order, as usual.)&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Let’s relate what Warp World does to our previous definitions. During step ‘a’, the number of permanents we have on the battlefield will be the cardinality of Ψ, that is, |Ψ| =&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;y&lt;/i&gt;. During step ‘b’, we put |Ψ∩Λ| cards back into our library, and because we’re assuming that Ψ ⊆ Λ, there are exactly&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;y&lt;/i&gt;&amp;nbsp;cards from Λ that will be put back into our library. So, by the end of step ‘b’, our library will have exactly |Θ∪Ψ| =&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;k&lt;/i&gt;&amp;nbsp;+&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;y&lt;/i&gt;&amp;nbsp;cards, of which |Λ|-|Α∪B| =&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;z&lt;/i&gt;&amp;nbsp;– (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;a&lt;/i&gt;&amp;nbsp;+&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;b&lt;/i&gt;) are permanents. Regarding shuffling, we assume it’s not biased in any particular manner—that is, cards from our library are ordered at random every time it’s required to shuffle.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;Here comes the interesting part, namely steps ‘c’ and ‘d’. During step ‘c’, we’re instructed to reveal&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;y&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;cards from the top of our library and then, during step ‘d’, we put all artifacts, creatures, lands, and enchantments revealed this way onto the battlefield. Let’s define Φ as the set of&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;x&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;revealed artifacts, creatures, lands, and enchantments, such that Φ = {&lt;/span&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;φ&lt;/span&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;1&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, …,&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;φ&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;x&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;} are all the revealed permanents that will be put onto the battlefield. Now, because we don’t know how all the cards in our library were ordered (unbiased shuffling), we can’t tell which cards will be revealed in a deterministic way (e.g., the first will be a land, the second will be a creature, etc.). Fortunately, we’re quite capable of telling which cards will be revealed in a stochastic way (i.e., probabilistically) (e.g., there’s a .90 chance to reveal a land, there’s a .10 chance to reveal a creature, etc.).&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;The act of revealing cards from the top of our library is analogous to sampling objects from a finite population without replacing them, much like picking apples from an apple tree. Of note, we are usually revealing more than one card (&lt;i style=&quot;font-weight: inherit; margin: 0px;&quot;&gt;y&lt;/i&gt;&amp;nbsp;&amp;gt; 1), and for now, the outcomes of interest will fall into two main categories, namely it’s either a permanent that we will put onto the battlefield or not. If each sampling were independent of one another (e.g., after revealing a card, we reshuffle it back into our library before revealing another card), we could classify this action as a Bernoulli trial and compute the probability of revealing permanents according to the binomial distribution. However, in our case, each sampling is not independent of one another, as the probability of a “success” (reveal a permanent) changes as the number of revealed cards also increases. Therefore, we should model such an action of revealing cards from the top of our library with a hypergeometric distribution, which some magic players should be already familiar with, as it is often used to compute the optimal number of lands in a deck, for example, or the chance of drawing a certain card by turn.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;When there are two mutually exclusive outcomes (e.g., permanent and non-permanent card), the probability mass function (pmf) of the number of permanents that Warp World will reveal will take the form&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-P4yQk88v7Vg/XSyEIcnQlwI/AAAAAAAABLE/8TyYMhMAiAME6QMQY4jjmHxFB_323eywACLcBGAs/s1600/10%2B-%2B2VlTkqG.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;153&quot; data-original-width=&quot;702&quot; height=&quot;86&quot; src=&quot;https://1.bp.blogspot.com/-P4yQk88v7Vg/XSyEIcnQlwI/AAAAAAAABLE/8TyYMhMAiAME6QMQY4jjmHxFB_323eywACLcBGAs/s400/10%2B-%2B2VlTkqG.jpg&quot; width=&quot;400&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;in which (p¦q) is a binomial coefficient—that is, the number of ways q elements can be chosen from p elements, regardless of order. To make it easier for us, I wrote a table with definitions of the main parameters:&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-ssSol_jrseE/XSyEOUEUVpI/AAAAAAAABLI/tvZhihAZVoIfk4z4eHwnB_opUACbDhwqgCLcBGAs/s1600/7%2B-%2BMzjJiPk.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;388&quot; data-original-width=&quot;1394&quot; height=&quot;111&quot; src=&quot;https://1.bp.blogspot.com/-ssSol_jrseE/XSyEOUEUVpI/AAAAAAAABLI/tvZhihAZVoIfk4z4eHwnB_opUACbDhwqgCLcBGAs/s400/7%2B-%2BMzjJiPk.jpg&quot; width=&quot;400&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;span class=&quot;res-freetext-expando&quot; style=&quot;display: inline-block; height: 1em; margin-bottom: 0px !important; margin-left: 0px; margin-right: 0px; margin-top: 0px !important; margin: 0px; vertical-align: middle;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;When we compute Eq. 1 for all possible number of permanents revealed with Warp World, we get a probability distribution with mean&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-EjYqtMnxYZ4/XSyEUTqENYI/AAAAAAAABLM/pBSQixBVtZMfBlhkE3ClB27gNNboPB2-ACLcBGAs/s1600/11%2B-%2B1EW19ZL.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;148&quot; data-original-width=&quot;490&quot; height=&quot;96&quot; src=&quot;https://1.bp.blogspot.com/-EjYqtMnxYZ4/XSyEUTqENYI/AAAAAAAABLM/pBSQixBVtZMfBlhkE3ClB27gNNboPB2-ACLcBGAs/s320/11%2B-%2B1EW19ZL.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;and variance&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-T81A8XeCCQc/XSyEZGJ4gaI/AAAAAAAABLQ/wmGCwK2iNnsk78UUJ8O2Cjt8UfQVpwpXwCLcBGAs/s1600/12%2B-%2BK3auR8V.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;128&quot; data-original-width=&quot;1373&quot; height=&quot;35&quot; src=&quot;https://1.bp.blogspot.com/-T81A8XeCCQc/XSyEZGJ4gaI/AAAAAAAABLQ/wmGCwK2iNnsk78UUJ8O2Cjt8UfQVpwpXwCLcBGAs/s400/12%2B-%2BK3auR8V.jpg&quot; width=&quot;400&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;To illustrate its application, let’s imagine the following scenario. We’re playing with a 60-card deck that has 56 permanents (let’s think of them as all mountains;&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;z&lt;/i&gt;&amp;nbsp;= 56) and four copies of Warp World. The game starts. We’re on the play and we mull to two cards, a mountain and a copy of Warp World. During the next seven turns, we only draw mountains, so when we get to turn eight, we have eight mountains on the battlefield (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;y&lt;/i&gt;&amp;nbsp;= 8), a single card in hand, which is Warp World, and 51 remaining cards in our library (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;k&lt;/i&gt;&amp;nbsp;= 51). If we cast Warp World, what are our chances of putting, say, eight permanents back on the battlefield? What about seven, six, five, …? If we calculate such probabilities with Eq. 1 and plot the results for various numbers of permanents we had before casting Warp World (&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;y&lt;/i&gt;), we get the following probability distributions:&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-Pec_lTRcEPk/XSyEnZaWdcI/AAAAAAAABLc/IpYd8wF8INo-zz7m8IO3F1m_CQj739bEwCLcBGAs/s1600/1%2B-%2Biqdv66X.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;755&quot; data-original-width=&quot;1206&quot; height=&quot;200&quot; src=&quot;https://1.bp.blogspot.com/-Pec_lTRcEPk/XSyEnZaWdcI/AAAAAAAABLc/IpYd8wF8INo-zz7m8IO3F1m_CQj739bEwCLcBGAs/s320/1%2B-%2Biqdv66X.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;In the horizontal axis, we have the number of permanents that we get after resolving Warp World (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;x&lt;/i&gt;), while in the vertical axis, we have the probability of each of them. In addition, the multiple distributions represent different numbers of permanents we had before casting Warp World (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;y&lt;/i&gt;). (Missing probabilities are all zero.) In our example, if we have 8 permanents on the battlefield when we cast Warp World, we will get a mean of 8 permanents after resolving Warp World—that is, we usually get our eight lands back—but if we have 20 permanents on the battlefield when we cast Warp World, on average, we get 19 permanents back. Notice that even though the variability (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;stands for standard deviation) is low in absolute terms (the value of&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;x&lt;/i&gt;&amp;nbsp;is likely equal or close to the mean), the higher is the value of&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;y&lt;/i&gt;, the higher is the variance. For example, if we have 8 permanents on the battlefield, we will usually get 7 or 8 permanents after resolving Warp World, and rarely anything other than that. However, if we have 20 permanents on the battlefield, we will usually get something between 18 and 20 permanents after resolving Warp World, and rarely anything other than that.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Before we move on, I should point out that each probability in Figure 1 refers to the probability of getting exactly that number of permanents, as Eq. 1 is a pmf. However, if your interest is in answering questions about fewer-than/up-to/at-least a certain number of permanents, all you need to do is sum adjacent values of&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin: 0px;&quot;&gt;x&lt;/i&gt;&amp;nbsp;in the appropriate direction to get the cumulative probability. For example, if we have 20 permanents on the board before casting Warp World, what would be the probability of getting at least, say, 18 permanents? According to the Y=20 distribution in Figure 1, that probability would be .96.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Despite being a somewhat unrealistic scenario, Figure 1 gives us something that we can use to compare against different situations. For instance, how adding more non-permanents to our deck would affect the previous distributions? Let’s set everything else equal to the previous example, except that now, our deck has 44 mountains (&lt;i style=&quot;font-weight: inherit; margin: 0px;&quot;&gt;z&lt;/i&gt;&amp;nbsp;= 44), four copies of Warp World, and 12 other non-permanents. The results are the following:&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-MRRNNPpRCes/XSyErJHPEfI/AAAAAAAABLk/g-VXivYY6NAHXAf0Oc9O4BSfe-1K5o77ACLcBGAs/s1600/2%2B-%2BodXdXAg.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;750&quot; data-original-width=&quot;1192&quot; height=&quot;201&quot; src=&quot;https://1.bp.blogspot.com/-MRRNNPpRCes/XSyErJHPEfI/AAAAAAAABLk/g-VXivYY6NAHXAf0Oc9O4BSfe-1K5o77ACLcBGAs/s320/2%2B-%2BodXdXAg.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Inspection of Figure 2 indicates two main differences in comparison to Figure 1. First, adding more non-permanents to a Warp World deck decreases the mean of the probability distribution of the number of permanents you will get after resolving Warp World, regardless of how many permanents you had before casting Warp World. Second, variability increased all over the board, so the chance of getting screwed up by Warp World increased quite a lot. In other words, this is why it’s not a good idea to play non-permanents in a Warp World deck, as you decrease its expected value and increase its variability. You get double screwed.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;This concludes the basics of my approach. In the following sections, I’ll show how to add distinctions between the various types of permanents that we can reveal with Warp World (e.g., lands, creatures, other non-planeswalker permanents) and drop some of the assumptions we’ve made so far (e.g., empty hand and graveyard, no tokens).&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;b&gt;The multivariate Warp World model&lt;/b&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;One limitation of the previous approach is that we can’t tell what sort of permanent Warp World puts onto the battlefield. In some cases, the binary distinction is just what we need. In others, however, a more detailed distinction is needed, as different types of permanent will have different effects on the board state after Warp World resolves. One distinction that would make sense is the one given by Warp World itself, namely that permanents can be artifacts, creatures, lands, and enchantments. We’ve already defined Λ as the set of all permanents in our deck, so it follows that artifacts, Λ&lt;/span&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, creatures, Λ&lt;/span&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, lands, Λ&lt;/span&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;3&lt;/span&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, and enchantments, Λ&lt;/span&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;4&lt;/span&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;, ought to be subsets of Λ, such that&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-_onAsPEaQyo/XSyE2y5nO7I/AAAAAAAABLo/3p9yHv_yCfol1GahQn6n28b_wcoslJnOACLcBGAs/s1600/8%2B-%2BcXlFhpJ.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;84&quot; data-original-width=&quot;157&quot; src=&quot;https://1.bp.blogspot.com/-_onAsPEaQyo/XSyE2y5nO7I/AAAAAAAABLo/3p9yHv_yCfol1GahQn6n28b_wcoslJnOACLcBGAs/s1600/8%2B-%2BcXlFhpJ.jpg&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;because for the sake of simplicity, we will continue to assume that we’re not playing planeswalkers. (Remember that Warp World does not put planeswalkers onto the battlefield, even though they are permanents that can be part of our deck.) Similarly, let’s say that mutually exclusive subsets of Φ, A, and B fall into the same categories as Λi, such that&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-chUcocZ92k0/XSyE6IvGzjI/AAAAAAAABL4/FOdb_fhO2Ds0ronC_khwAmfzMnBQE5zFgCLcBGAs/s1600/9%2B-%2BYpXMDBW.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;98&quot; data-original-width=&quot;462&quot; height=&quot;67&quot; src=&quot;https://1.bp.blogspot.com/-chUcocZ92k0/XSyE6IvGzjI/AAAAAAAABL4/FOdb_fhO2Ds0ronC_khwAmfzMnBQE5zFgCLcBGAs/s320/9%2B-%2BYpXMDBW.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Now we can extend Eq. 1 to accommodate the additional outcomes of Warp Wold as follows&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-BGgrP2pYmI0/XSyE_7qKKvI/AAAAAAAABMA/2MzDihfRpr4eB__iaje-ClV7Etdand_aACLcBGAs/s1600/13%2B-%2BwO76V7P.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;113&quot; data-original-width=&quot;889&quot; height=&quot;50&quot; src=&quot;https://1.bp.blogspot.com/-BGgrP2pYmI0/XSyE_7qKKvI/AAAAAAAABMA/2MzDihfRpr4eB__iaje-ClV7Etdand_aACLcBGAs/s400/13%2B-%2BwO76V7P.jpg&quot; width=&quot;400&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;which is the pmf of the multivariate Warp World model. Such a distribution has mean&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-jGF1-TsZEf0/XSyFG2lPCKI/AAAAAAAABMI/bc-mZm2XVyoxr_EPX61X6yKVCUyGVeD7wCLcBGAs/s1600/14%2B-%2BsVAGLTT.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;106&quot; data-original-width=&quot;459&quot; height=&quot;73&quot; src=&quot;https://1.bp.blogspot.com/-jGF1-TsZEf0/XSyFG2lPCKI/AAAAAAAABMI/bc-mZm2XVyoxr_EPX61X6yKVCUyGVeD7wCLcBGAs/s320/14%2B-%2BsVAGLTT.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;and variance&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-4ebUChncfZ0/XSyFMOlwk-I/AAAAAAAABMQ/1LBVb-fFsdcTGH-QvVtEneQV2DdX0P_PACLcBGAs/s1600/15%2B-%2BbCj1DnN.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;106&quot; data-original-width=&quot;1044&quot; height=&quot;40&quot; src=&quot;https://1.bp.blogspot.com/-4ebUChncfZ0/XSyFMOlwk-I/AAAAAAAABMQ/1LBVb-fFsdcTGH-QvVtEneQV2DdX0P_PACLcBGAs/s400/15%2B-%2BbCj1DnN.jpg&quot; width=&quot;400&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;As before, let’s think about a scenario to illustrate how Eq. 4-6 informs us about the probability of Warp World revealing different sorts of permanents as a function of the properties of our deck. Similar to our previous example, imagine we we’re playing with a 60-card deck composed of 24 lands (&lt;/span&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;z&lt;/span&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;3&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;= 24), 16 creatures (&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;z&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;2&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;= 24), and 20 non-permanents. The game starts. We’re on the play and unfortunately, we have to mull to four cards, specifically two forests and two copies of [[elvish mystic]]. On turn 1, we play a forest and an elvish mystic. On turn 2, we draw a copy of Warp World, then play another forest and cast another elvish mystic. During the next four turns, we draw four mountains, so when we get to turn 6, we cast Warp World with two forests, four mountains, and two elvish mystics on the battlefield (&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;y&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;= 8), no cards in hand or graveyard, and 51 cards left in our library (&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;k&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;= 51). What’s the probability of revealing, say, two creatures and four lands with Warp World? On average, how many creatures and lands would Warp World put back on the battlefield after it resolves? We can answer such questions with Eq. 4-5. When we compute the probabilities in Eq. 4 for all possible values of&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;x&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;2&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;(# of creatures that Warp World reveals) and&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;x&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;3&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;(# of lands that Warp World reveals) and plot such values, we generate the following three-dimensional representation of the probability distribution of&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;x&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;2&lt;/span&gt;&lt;/i&gt;&lt;span style=&quot;font-size: 1em;&quot;&gt;&amp;nbsp;and&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-size: 1em; font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;x&lt;/i&gt;&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;&lt;span style=&quot;font-size: xx-small;&quot;&gt;3&lt;/span&gt;&lt;/i&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-cqsa5DcGiPw/XSyFSf1_voI/AAAAAAAABMY/Jep2cJqvPoU2eHrUcgtByo8zahWxrUqagCLcBGAs/s1600/3%2B-%2BkJIDkN6.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;674&quot; data-original-width=&quot;1190&quot; height=&quot;181&quot; src=&quot;https://1.bp.blogspot.com/-cqsa5DcGiPw/XSyFSf1_voI/AAAAAAAABMY/Jep2cJqvPoU2eHrUcgtByo8zahWxrUqagCLcBGAs/s320/3%2B-%2BkJIDkN6.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Figure 3 shows that when&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;y&lt;/i&gt;&amp;nbsp;= 8, the probability of revealing exactly two creatures and four lands from the top of our library is .10. In fact, this is one of the two most likely cases, the second one being two creatures and three lands, as both of them account for roughly 20% of the possible outcomes of a Warp World under this condition. In addition, Eq. 5 and 6 show that on average, Warp World will reveal 2 creatures (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;= 1 creature) and 3 lands (&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;= 1 land) in this particular example.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;We’ve seen before that playing non-permanents in a Warp World deck is a bad idea. So, let’s run the same simulation as before, except that instead of playing 16 creatures and 24 lands, our deck has 22 creatures and 26 lands. When that’s done, we find the following distribution&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-BTHrqZJ3b50/XSyFWcNMaII/AAAAAAAABMc/RCtv959dDc8HC3miMN6eJ8AUy4HIVH6WQCLcBGAs/s1600/4%2B-%2B6lFiK9b.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;721&quot; data-original-width=&quot;1215&quot; height=&quot;189&quot; src=&quot;https://1.bp.blogspot.com/-BTHrqZJ3b50/XSyFWcNMaII/AAAAAAAABMc/RCtv959dDc8HC3miMN6eJ8AUy4HIVH6WQCLcBGAs/s320/4%2B-%2B6lFiK9b.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Inspection of Figure 4 indicates a shift of the mean of the probability distribution. Indeed, on average, Warp World would reveal 3 creatures (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;= 1 creatures) and 4 lands (&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;= 1 lands) with the latter deck.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;How would Figures 3 and 4 change if we increased the number of permanents on the battlefield before casting Warp World to, say, 20 permanents (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;y&lt;/i&gt;&amp;nbsp;= 20)? The probability distribution of&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;xi&lt;/i&gt;&amp;nbsp;in Figure 3 would look like this&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-lpsdIq-EZCs/XSyFaNye1pI/AAAAAAAABMk/mVERuOUrFJsGTlQd-YeJWIf2Sww71NJAQCLcBGAs/s1600/5%2B-%2Bqh4oDDJ.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;705&quot; data-original-width=&quot;1223&quot; height=&quot;184&quot; src=&quot;https://1.bp.blogspot.com/-lpsdIq-EZCs/XSyFaNye1pI/AAAAAAAABMk/mVERuOUrFJsGTlQd-YeJWIf2Sww71NJAQCLcBGAs/s320/5%2B-%2Bqh4oDDJ.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;and would have mean 5 creatures (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;= 2) and 8 lands (&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;= 2), while the distribution in Figure 4 would look like this&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-VSGqqoC90sI/XSyFdE3YnSI/AAAAAAAABMs/CCPMGnxuCzowPwYC4DkPtQXDMY5cm30_wCLcBGAs/s1600/6%2B-%2BhuJIvIh.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;687&quot; data-original-width=&quot;1210&quot; height=&quot;181&quot; src=&quot;https://1.bp.blogspot.com/-VSGqqoC90sI/XSyFdE3YnSI/AAAAAAAABMs/CCPMGnxuCzowPwYC4DkPtQXDMY5cm30_wCLcBGAs/s320/6%2B-%2BhuJIvIh.jpg&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;and have mean 8 creatures (&lt;i style=&quot;font-weight: inherit; margin-left: 0px; margin-right: 0px; margin-top: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;= 2) and 9 lands (&lt;i style=&quot;font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px;&quot;&gt;sd&lt;/i&gt;&amp;nbsp;= 2).&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;Of course, we could calculate probability distributions for decks that have non-zero artifacts and enchantments as well but it would be difficult to visualize them, as we would be using higher dimensions than before. Similarly, the same approach could be used for different, mutually exclusive distinctions (e.g., green creatures vs. red creatures vs. other permanents; ramp permanents vs. gy recursion permanents).&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;There are many things that can be done moving forward. For instance, we could use Eq. 4-6 to investigate how cards that generate mana or produce more than one permanent can net mana or permanents, then describe the necessary and sufficient conditions to create loops with Warp World. Unfortunately, I don’t have time to talk about them right now, so I’ll let you figure them out on your own.&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;b&gt;Tokens&lt;/b&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;So far, we’ve worked under the assumption that when we cast Warp World, the only sort of permanent we have on the battlefield (and thus the number of cards we will reveal with Warp World) are the ones contained in our deck—that is, Ψ⊆Λ. In some cases, this will be true; in others, however, it won’t, as we might have tokens on the battlefield, which will increase the number of cards revealed with Warp World but it doesn’t mean we’ll shuffle that many cards into our library. Fortunately, taking tokens into account does not require us to make huge changes to the previous equations. Specifically, if Ψ⊆Λ is not true, then by the end of step ‘b’ of Warp World, our new library will have size |Θ| + |Ψ∩Λ|, instead of |Θ∪Ψ|, in which Ψ∩Λ are all permanents on the battlefield that are permanents from our deck (i.e., all non-token permanents). Everything else remains the same in Eq. 1-6.&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;b&gt;Other spells similar to Warp World&lt;/b&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;There are a few other spells that in one way or another, do something that is quite similar to what Warp World does. One example that comes to mind is &lt;b&gt;The Great Aurora&lt;/b&gt;. I have no doubt we can use the Warp World model to compute probabilities for those spells as well. We just need to tweak the model a little bit to make it consistent with the wording used in similar spells (e.g., great aurora also makes we shuffle our hand).&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-1KwhLJ-miLs/XSyGtRht8gI/AAAAAAAABNA/Aqs2jVxGpkcI1fr3NWDuySRmfmSuW43XwCLcBGAs/s1600/ori-179-the-great-aurora.jpg&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;936&quot; data-original-width=&quot;672&quot; height=&quot;320&quot; src=&quot;https://1.bp.blogspot.com/-1KwhLJ-miLs/XSyGtRht8gI/AAAAAAAABNA/Aqs2jVxGpkcI1fr3NWDuySRmfmSuW43XwCLcBGAs/s320/ori-179-the-great-aurora.jpg&quot; width=&quot;229&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;b&gt;Other possible approaches&lt;/b&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;We could find probability distributions empirically. Goldfish a Warp World deck, say, a thousand times, take note of the relevant stats prior to and after casting Warp World, and estimate the distributions empirically. I’m not that guy though.&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;line-height: 1.42857em; margin-bottom: 0.357143em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;b&gt;Final remarks&lt;/b&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1em; line-height: 1.42857em; margin-top: 0.357143em; padding: 0px;&quot;&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;We end with a cautionary note. We know that adding more permanents to a Warp World deck usually yields a better outcome—that is, the more permanents we have in the deck, the more permanents we’ll likely reveal with Warp World. However, it would be inappropriate to simply compare mean differences to draw conclusions about different Warp World decks. That is because changing properties of Warp World decks will likely change the variance of their distributions. One possible solution is to use a standardized measure of the compound mean difference—that is, the standardized measure of distance between the means of two&amp;nbsp;&lt;i style=&quot;font-weight: inherit; margin: 0px;&quot;&gt;p(xi)&lt;/i&gt;&amp;nbsp;distributions. I feel like going into this would be beyond the scope of this analysis.&lt;/span&gt;&lt;/div&gt;
&lt;div style=&quot;font-size: 1.07692em;&quot;&gt;
&lt;br /&gt;
--CG&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/form&gt;
&lt;/div&gt;</content><author><name>Carlos Gomes</name></author><category term="mtg" /><category term="math" /><category term="probability" /><category term="model" /></entry><entry><title type="html">Securing access to backends with HAproxy’s stick-tables: A guide for pfSense users</title><link href="http://localhost:4000/blog/Securing-backend-haproxy-pfsense/" rel="alternate" type="text/html" title="Securing access to backends with HAproxy's stick-tables: A guide for pfSense users" /><published>2019-07-13T00:00:00-03:00</published><updated>2019-07-13T00:00:00-03:00</updated><id>http://localhost:4000/blog/Securing-backend-haproxy-pfsense</id><content type="html" xml:base="http://localhost:4000/blog/Securing-backend-haproxy-pfsense/">&lt;div&gt;
&lt;u&gt;Updated on May 1st 2020:&lt;/u&gt; This guide still works with pfsense version &lt;b&gt;2.4.5-RELEASE&lt;/b&gt; and the haproxy packaged version &lt;b&gt;0.60_4&lt;/b&gt;.&lt;br /&gt;
&lt;br /&gt;
This is a rough guide on how to create and configure user lists and stick-tables using pfsense's HAproxy package to protect access to a backend and limit the number of failed login attempts.&amp;nbsp; The guide is divided into two main sections.&amp;nbsp; In the first one, we'll create a user list and add encrypted (SHA512) passwords for each of them.&amp;nbsp; Then, in the second section, we'll create and configure stick-tables to limit the number of failed login attempts.&lt;br /&gt;
&lt;br /&gt;
Now, it's fairly simple to accomplish all those things by manually changing HAproxy's config file (e.g., &lt;a href=&quot;https://gist.github.com/Iristyle/5005653&quot;&gt;https://gist.github.com/Iristyle/5005653&lt;/a&gt;,&amp;nbsp;&lt;a href=&quot;https://www.haproxy.com/blog/introduction-to-haproxy-stick-tables/&quot;&gt;https://www.haproxy.com/blog/introduction-to-haproxy-stick-tables/&lt;/a&gt;).&amp;nbsp; However, I found it difficult to find any sort of documentation on how to accomplish the same thing using only pfsense's graphical user interface (GUI).&amp;nbsp; The GUI makes it very easy to implement and configure the core aspects of HAproxy (e.g., reverse proxy and load balancing) but at the same time, it seems to lack support for other features, such as adding basic authentication requests and using stick-tables to mitigate attempts to brute-force users' credentials.&amp;nbsp; If that's what you'd like to do, then read on.&lt;br /&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div&gt;
&lt;div&gt;
The prerequisites are the following:&lt;/div&gt;
&lt;div&gt;
- you're running&amp;nbsp;&lt;b&gt;pfsense&lt;/b&gt;&amp;nbsp;version&amp;nbsp;&lt;b&gt;2.4.4-RELEASE-p3&amp;nbsp;&lt;/b&gt;or similar&lt;/div&gt;
&lt;div&gt;
- you've installed the&amp;nbsp;&lt;b&gt;HAproxy&amp;nbsp;&lt;/b&gt;package version&amp;nbsp;&lt;b&gt;0.59_19&amp;nbsp;&lt;/b&gt;or similar&lt;/div&gt;
&lt;div&gt;
- you've already added backends and frontends with HAproxy using subdomains (e.g.,&amp;nbsp;&lt;a href=&quot;https://blog.devita.co/pfsense-to-proxy-traffic-for-websites-using-pfsense/&quot;&gt;https://blog.devita.co/pfsense-to-proxy-traffic-for-websites-using-pfsense/&lt;/a&gt;)&lt;/div&gt;
&lt;div&gt;
&lt;br /&gt;
Recommended:&lt;br /&gt;
- configure ACME SSL with HAproxy (e.g.,&amp;nbsp;&lt;a href=&quot;https://www.youtube.com/watch?v=5Frn96oADOU&quot;&gt;https://www.youtube.com/watch?v=5Frn96oADOU&lt;/a&gt;)&lt;/div&gt;
&lt;br /&gt;
&lt;b&gt;# Basic user authentication&lt;/b&gt;&lt;br /&gt;
(&lt;a href=&quot;https://hochwald.net/user-authentication-with-haproxy-on-pfsense/&quot;&gt;Based on Joerg Hocwald's guide.&lt;/a&gt;)&lt;br /&gt;
In HAproxy, it's pretty simple to create a user list with encrypted passwords.&amp;nbsp; There is basically three steps involved: (a) user and password list creation, (b) adding those to the global settings, and (c) creating an access control list (ACL) and action for each backend.&lt;br /&gt;
&lt;br /&gt;
1. Create a .txt file and write the following:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;userlist UserGroup&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;group is-admin&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;group is-user&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;user &lt;i&gt;example01&lt;/i&gt;&amp;nbsp;password &lt;i&gt;sha512-encrypted01&amp;nbsp;&lt;/i&gt;groups &lt;i&gt;is-admin&lt;/i&gt;&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;user&amp;nbsp;&lt;i&gt;example02&lt;/i&gt;&amp;nbsp;password&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;sha512-&lt;/i&gt;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;encrypted02&amp;nbsp;&lt;/i&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;groups&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;is-user&lt;/i&gt;&lt;br /&gt;
&lt;div&gt;
...&lt;/div&gt;
&lt;div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div&gt;
The argument &lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;userlist&lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt; defines the name of your user list, which in this case we're going to call &lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;UserGroup&lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;.&amp;nbsp; Next, &lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;group&lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt; defines the group that each user belongs to, which will be either a standard user (&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;is-user&lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;) or admin (&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;is-admin&lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;).&amp;nbsp; (You don't need to define groups but it's a nice way of restricting access to critical services.) Below groups, we have the list of all users, their (SHA-512 encrypted) passwords and the group they belong to.&amp;nbsp;&amp;nbsp;&lt;/span&gt;You can add as many users as you want this way.&lt;/div&gt;
&lt;div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-7ek0zGGy3M0/XStOCTbMYyI/AAAAAAAABJ0/TZuiA3IIkbwVX_m5LWDtY3Ah_E2n8YV4QCLcBGAs/s1600/user-list-txt-file.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;532&quot; data-original-width=&quot;647&quot; height=&quot;263&quot; src=&quot;https://1.bp.blogspot.com/-7ek0zGGy3M0/XStOCTbMYyI/AAAAAAAABJ0/TZuiA3IIkbwVX_m5LWDtY3Ah_E2n8YV4QCLcBGAs/s320/user-list-txt-file.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div&gt;
2. For each user, create a SHA-512 encrypted password.&amp;nbsp; &lt;a href=&quot;https://lmgtfy.com/?q=how%20to%20create%20a%20sha-512%20password&amp;amp;s=g&quot;&gt;There are many ways of doing that&lt;/a&gt;.&amp;nbsp; If you're running Debian (or any Linux distro), run &lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;apt install whois &lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;in a terminal window&lt;/span&gt;, which has the &lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;mkpasswd&lt;/span&gt; command that we're going to user, and then run each of the followin commands, changing&amp;nbsp;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;sha512-encrypted01&lt;/i&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;&amp;nbsp;and&amp;nbsp;&lt;/span&gt;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;sha512-encrypted02&lt;/i&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;&amp;nbsp;for the actual (insecure) password string of those respective users&lt;/span&gt;:&lt;/div&gt;
&lt;div&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;printf &quot;&lt;/span&gt;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;sha512-encrypted01&lt;/i&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;&quot; | mkpasswd --stdin --method=sha-512&lt;/span&gt;&lt;/div&gt;
&lt;div&gt;
&lt;div&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;printf &quot;&lt;/span&gt;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;sha512-encrypted02&lt;/i&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;&quot; | mkpasswd --stdin --method=sha-512&lt;/span&gt;&lt;/div&gt;
&lt;div&gt;
...&lt;/div&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-siAScvce880/XStNC9kGVYI/AAAAAAAABJs/Bh5BSzuw0yIxzIMaQBJsPstbd5zfC3a9QCLcBGAs/s1600/sha-512_pass.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;57&quot; data-original-width=&quot;921&quot; height=&quot;19&quot; src=&quot;https://1.bp.blogspot.com/-siAScvce880/XStNC9kGVYI/AAAAAAAABJs/Bh5BSzuw0yIxzIMaQBJsPstbd5zfC3a9QCLcBGAs/s320/sha-512_pass.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;div&gt;
&lt;br /&gt;&lt;/div&gt;
&lt;div&gt;
3. Now copy each encrypted password and paste them over the respective&amp;nbsp;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;sha512-encryptedXX&lt;/i&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;&amp;nbsp;string in the user list .txt file.&lt;/span&gt;&lt;/div&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-HQcjdMIh_jw/XStOjJukTEI/AAAAAAAABJ8/6aMV-ciTtd454w85rR1EtsYZ3deB9RWOQCLcBGAs/s1600/user-list-txt-file2.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;193&quot; data-original-width=&quot;1600&quot; height=&quot;38&quot; src=&quot;https://1.bp.blogspot.com/-HQcjdMIh_jw/XStOjJukTEI/AAAAAAAABJ8/6aMV-ciTtd454w85rR1EtsYZ3deB9RWOQCLcBGAs/s320/user-list-txt-file2.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
4. Go to pfsense's GUI and in &lt;b&gt;Services &amp;gt; HAproxy&lt;/b&gt;, go to the &lt;b&gt;Settings tab&lt;/b&gt;.&amp;nbsp; Now find&amp;nbsp;&lt;b&gt;Global Advanced pass thru&lt;/b&gt; and &lt;b&gt;paste the content from your user list .txt file&lt;/b&gt;.*&amp;nbsp; When you're done, hit&lt;b&gt; Save &lt;/b&gt;and then&lt;b&gt; Apply Settings&lt;/b&gt;.&lt;br /&gt;
&lt;br /&gt;
* If you've other things in the global pass thru, make sure to add the user list to the bottom of all other commands.&amp;nbsp; Otherwise, you might get a few errors when trying to apply the settings.&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-UrOULw_gdZs/XStP_3yMXkI/AAAAAAAABKI/C7sLhWz1dswTTY6EjQCcBXr-cl1uFiPAgCLcBGAs/s1600/global-pass-thru.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;437&quot; data-original-width=&quot;1285&quot; height=&quot;108&quot; src=&quot;https://1.bp.blogspot.com/-UrOULw_gdZs/XStP_3yMXkI/AAAAAAAABKI/C7sLhWz1dswTTY6EjQCcBXr-cl1uFiPAgCLcBGAs/s320/global-pass-thru.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
5. Now head to the &lt;b&gt;Backend tab&lt;/b&gt;.&amp;nbsp; We're going to &lt;b&gt;edit one of the backends&lt;/b&gt; (e.g., &lt;i&gt;&lt;b&gt;www&lt;/b&gt;&lt;/i&gt;.domain.com).&amp;nbsp; In &lt;b&gt;Access control lists and actions&lt;/b&gt;, create a new ACL, as follows:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Name = UserAuth&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Expression = Custom acl:&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;CS = blank&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Not = no&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Value =&amp;nbsp;http_auth_group(UserGroup) is-user&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
(If you want to restrict access to admin, then you need to change the value from is-user to is-admin.)&amp;nbsp; Then, &lt;b&gt;in Actions&lt;/b&gt;, create a new one as follows:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Action = http-request auth&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Parameters = See below&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Condition acl names = blank&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Actions = blank&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;realm =&amp;nbsp;realm User unless UserAuth&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
(As before, if you want to restrict access to admin, then in realm, change User for Admin.) Hit &lt;b&gt;Save&lt;/b&gt;&amp;nbsp;and then &lt;b&gt;Apply Settings&lt;/b&gt;.&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-qJ5TRN5cwd8/XStTQL_aUMI/AAAAAAAABKk/lkW81nDzG-8LAzniYGH3r9rRMX2EY-RfwCLcBGAs/s1600/backends_basicauth_001.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;498&quot; data-original-width=&quot;1282&quot; height=&quot;124&quot; src=&quot;https://1.bp.blogspot.com/-qJ5TRN5cwd8/XStTQL_aUMI/AAAAAAAABKk/lkW81nDzG-8LAzniYGH3r9rRMX2EY-RfwCLcBGAs/s320/backends_basicauth_001.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
6. Rinse and repeat for each backend you want to protect with basic user authentication.&amp;nbsp; Make sure to test your config before moving on to the next section.&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;# Stick-table to protect against brute-force&lt;/b&gt;&lt;br /&gt;
In our case, access to each backend is secured by a basic http authentication request.&amp;nbsp; If the client does not provide correct credentials, it will be requested to enter new ones.&amp;nbsp; By default, HAproxy will do that forever, which is not something that sounds desirable to me because it allows clients to brute force their way into my services.&amp;nbsp; On HAproxy's official blog, you'll find a very instructive guide on how to protect your servers from bots, including a &lt;a href=&quot;https://www.haproxy.com/blog/bot-protection-with-haproxy/#brute-force-bots&quot;&gt;step-by-step procedure to help you mitigate brute-force attacks&lt;/a&gt;.&amp;nbsp; In their case, however, the authentication is associated to a particular /login page, instead of using HAproxy's own http-request auth feature, and we'd like to use the latter instead.&lt;br /&gt;
&lt;br /&gt;
Fortunately, when a client provides incorrect credentials, the result is an http error code (401) and because 4xx errors should be fairly uncommon in a properly configured server, we can use the rate of such errors (http_err_rate) as a marker of misuse/brute-force.&amp;nbsp; In HAproxy, a stick-table is used to keep track of a client's IP address and both the http_err_rate and the total number of errors (http_err_cnt).&amp;nbsp; In pfsense's GUI, however, there's no point-and-click way of enabling/disabling this, so we'll need to make use of backend pass thru and write custom access control lists and actions.&lt;br /&gt;
&lt;br /&gt;
1. Edit one of your &lt;b&gt;backends&lt;/b&gt; (e.g., &lt;i&gt;&lt;b&gt;www&lt;/b&gt;&lt;/i&gt;.domain.com) and in &lt;b&gt;Advanced Settings&lt;/b&gt;, add the following to &lt;b&gt;Backend pass thru&lt;/b&gt;:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;stick-table type ip size 1m expire 30m store conn_cur,conn_rate(3s),http_req_cnt,http_req_rate(10s),http_err_cnt,http_err_rate(20s)&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-Go_aDeV6gS8/XSp-_jeMw4I/AAAAAAAABIg/V9x-ZUCvABsozI9sRaqHBQoO98giGiCKACLcBGAs/s1600/backends_001.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;251&quot; data-original-width=&quot;1308&quot; height=&quot;61&quot; src=&quot;https://1.bp.blogspot.com/-Go_aDeV6gS8/XSp-_jeMw4I/AAAAAAAABIg/V9x-ZUCvABsozI9sRaqHBQoO98giGiCKACLcBGAs/s320/backends_001.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
This will create a stick-table that will capture the IP address of each client (&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;type ip&lt;/span&gt;), will store up to 1MB of data (&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;size 1m&lt;/span&gt;), will expire after 30min it was last matched/created/refreshed (&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;expire 30m&lt;/span&gt;) and for each client (key), it will store the # of connections and their rate over 3s, the # of http requests and their rate over 10s, and the # of http errors and their&lt;span style=&quot;font-family: inherit;&quot;&gt; rate over 20s (&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;store conn_cur,conn_rate(3s),http_req_cnt,http_req_rate(10s),http_err_cnt,http_err_rate(20s)&lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;).&amp;nbsp; (We won't use all those data but I figure you might find useful for other applications.&amp;nbsp; We'll only use the last two.)&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;2. Hit &lt;b&gt;Save&lt;/b&gt;.&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;3. Now go the the Frontend tab edit the &lt;i&gt;www.&lt;/i&gt;domain.com &lt;b&gt;frontend&lt;/b&gt; (or whichever frontend is associated with the backend you just edited).&amp;nbsp; Here, we'll create a couple of ACLs and actions that will make use of the data from the stick-table.&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: inherit;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;4. In &lt;/span&gt;&lt;b&gt;Default backend, access control lists and actions, create a new ACL&lt;/b&gt; as follows:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Name = acl-&lt;i&gt;www&lt;/i&gt;-err-rate&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Expression = Custom acl:&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;CS = blank&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Not = no&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Value = sc_http_err_rate(0) gt 10&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
This acl applies to all clients that have more than 10 4xx errors over the last 10s.&lt;br /&gt;
&lt;br /&gt;
5.&amp;nbsp; Now, &lt;b&gt;create a new ACL&lt;/b&gt; as follows:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Name = acl-&lt;i&gt;www&lt;/i&gt;-err-total&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Expression = Custom acl:&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;CS = blank&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Not = no&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Value = sc_http_err_cnt(0) gt 100&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
This acl applies to all clients that have more than 100 4xx errors stored on the stick-table (so, in the last 30min).&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-NRPdmPdUgqU/XSqCRMcGRgI/AAAAAAAABI8/EgdWCE-74p8QYcLchnbAfZp8nKTh5XDqwCLcBGAs/s1600/frontends_002.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;411&quot; data-original-width=&quot;1312&quot; height=&quot;100&quot; src=&quot;https://1.bp.blogspot.com/-NRPdmPdUgqU/XSqCRMcGRgI/AAAAAAAABI8/EgdWCE-74p8QYcLchnbAfZp8nKTh5XDqwCLcBGAs/s320/frontends_002.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;/div&gt;
&lt;br /&gt;
6. &lt;b&gt;In Actions&lt;/b&gt;, we will define what HAproxy will do in each of those cases.&amp;nbsp; First, however, we need to &lt;b&gt;instruct HAproxy to track the correct backend stick-table&lt;/b&gt;.&amp;nbsp; So, create a new action as follows:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Action = Custom&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Parameters = See below&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Condition acl names = acl-&lt;/span&gt;&lt;i style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;www &lt;/i&gt;&lt;span style=&quot;font-family: inherit;&quot;&gt;(or whichever name you're using for the Host matches: &lt;i&gt;www.&lt;/i&gt;domain.com ACL)&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;customaction =&amp;nbsp;http-request track-sc0 src table &lt;i&gt;www&lt;/i&gt;.domain.com_ipvANY&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
The last sections, customaction, tells HAproxy to use the stick-table from the &lt;i&gt;www.&lt;/i&gt;domain.com backend.&amp;nbsp; By default, that table is called {backend-name}_ipvANY, so edit it accordingly.&lt;br /&gt;
&lt;br /&gt;
7. Now, we're going to deny requests from acl-&lt;i&gt;subdomain&lt;/i&gt;-err-total, as follows:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Action = http-request deny&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Parameters = See below&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Condition acl names = acl-&lt;i&gt;www&lt;/i&gt;-err-total&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;denystatus = 403&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
This will return a Forbidden error to clients that have more than 100 errors&lt;br /&gt;
&lt;br /&gt;
8. Now, we're going to drop connections from clients that have a high error rate, as follows:&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Action = Custom&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Parameters = See below&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;Condition acl names = acl-&lt;i&gt;www&lt;/i&gt;-err-rate&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;font-family: &amp;quot;courier new&amp;quot;, &amp;quot;courier&amp;quot;, monospace;&quot;&gt;customaction = http-request silent-drop&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
This will cause the client to wait for a reply from our server but our server will never send one, so the client will hang in there until it gets a timeout.&amp;nbsp; This alone should be an effective way of dealing with brute-force attacks but I like the idea of completely denying access to persistent offenders.&lt;br /&gt;
&lt;br /&gt;
9.&amp;nbsp; Now move your &lt;b&gt;Use Backend&lt;/b&gt; action to the bottom of the list and &lt;b&gt;hit Save&lt;/b&gt;.&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-MfYptUoYzd4/XSqCU2Z5ToI/AAAAAAAABJA/WNrdDjOsabQRpLSga9zGYWh0N9x2IeGmACLcBGAs/s1600/frontends_003.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;452&quot; data-original-width=&quot;1320&quot; height=&quot;109&quot; src=&quot;https://1.bp.blogspot.com/-MfYptUoYzd4/XSqCU2Z5ToI/AAAAAAAABJA/WNrdDjOsabQRpLSga9zGYWh0N9x2IeGmACLcBGAs/s320/frontends_003.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;br /&gt;&lt;/div&gt;
10.&amp;nbsp; &lt;b&gt;Apply settings&lt;/b&gt; and check if it's working correctly in the &lt;b&gt;Stats tab&lt;/b&gt;.&lt;br /&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-EqWWzInPZ54/XSqDWx2UTVI/AAAAAAAABJQ/NgpYU5waMuE26V8An42TxA_Me0KDFnuGwCLcBGAs/s1600/stats_001.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;149&quot; data-original-width=&quot;1296&quot; height=&quot;36&quot; src=&quot;https://1.bp.blogspot.com/-EqWWzInPZ54/XSqDWx2UTVI/AAAAAAAABJQ/NgpYU5waMuE26V8An42TxA_Me0KDFnuGwCLcBGAs/s320/stats_001.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
&lt;div class=&quot;separator&quot; style=&quot;clear: both; text-align: center;&quot;&gt;
&lt;a href=&quot;https://1.bp.blogspot.com/-I7wHK2t9S2Q/XSqDY8mrTJI/AAAAAAAABJU/yI6WTN42OlEqEpkCEbVEwgKdH6lf1Ix1QCLcBGAs/s1600/stats_002.png&quot; style=&quot;margin-left: 1em; margin-right: 1em;&quot;&gt;&lt;img border=&quot;0&quot; data-original-height=&quot;109&quot; data-original-width=&quot;1265&quot; height=&quot;27&quot; src=&quot;https://1.bp.blogspot.com/-I7wHK2t9S2Q/XSqDY8mrTJI/AAAAAAAABJU/yI6WTN42OlEqEpkCEbVEwgKdH6lf1Ix1QCLcBGAs/s320/stats_002.png&quot; width=&quot;320&quot; /&gt;&lt;/a&gt;&lt;/div&gt;
&lt;br /&gt;
(11. Rinse and repeat for other backends.)&lt;br /&gt;
&lt;br /&gt;
That's it!&amp;nbsp; Let me remind you that the options described here were tuned to my own case and therefore, you should review them to make sure they'll work for yours as well.&amp;nbsp; For example, you might want to set a shorter expire for a given stick-table than 30 min., or you may not want to use http-request deny instead of http-request silent-drop.&lt;br /&gt;
&lt;br /&gt;
Stick-tables are great and there are many other things you can do with them.&amp;nbsp; For example, you can use a similar procedure to implement &lt;a href=&quot;https://www.haproxy.com/blog/bot-protection-with-haproxy&quot;&gt;other recommendations mentioned in the official blog&lt;/a&gt;.&amp;nbsp; This one has been working very well for me.&lt;br /&gt;
&lt;br /&gt;
If you have any suggestions and advice, please leave a comment bellow.&amp;nbsp; I've started using pfsense and haproxy less than a month ago, so I'm pretty sure there's a lot more that I can learn.&lt;br /&gt;
&lt;br /&gt;
--CG&lt;/div&gt;</content><author><name>Carlos Gomes</name></author><category term="haproxy" /><category term="homelab" /><category term="homeserver" /><category term="http" /><category term="pfsense" /></entry></feed>