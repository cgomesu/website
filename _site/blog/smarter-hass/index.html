<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Towards a smarter Home Assistant: Getting started on the analytical tools (and moving beyond) - CGomesu</title>
<meta name="description" content="A blog and portfolio website built with Jekyll and hosted on Github Pages">


  <meta name="author" content="Carlos Gomes">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="CGomesu">
<meta property="og:title" content="Towards a smarter Home Assistant: Getting started on the analytical tools (and moving beyond)">
<meta property="og:url" content="/blog/smarter-hass/">


  <meta property="og:description" content="A blog and portfolio website built with Jekyll and hosted on Github Pages">



  <meta property="og:image" content="/assets/posts/2021-06-04-smarter-hass/header.jpg">





  <meta property="article:published_time" content="2021-06-04T10:40:00-03:00">





  

  


<link rel="canonical" href="/blog/smarter-hass/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "",
      "url": "/"
    
  }
</script>


  <meta name="google-site-verification" content="FA-B3i_TqYeaLPYwZvxxOsx07Coy_drBKJ0M_4DD0Gw" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="CGomesu Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" href="/assets/img/site/favicon.ico" type="image/x-icon">

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/img/site/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
           
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">Home</a>
            </li><li class="masthead__menu-item">
              <a href="/blog/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/contact/">Contact</a>
            </li><li class="masthead__menu-item">
              <a href="/mtg/">MtG</a>
            </li><li class="masthead__menu-item">
              <a href="/publications/">Publications</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style="background-color: #000; background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('/assets/posts/2021-06-04-smarter-hass/header.jpg');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          Towards a smarter Home Assistant: Getting started on the analytical tools (and moving beyond)

        
      </h1>
      
        <p class="page__lead">
</p>
      
      
        <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  35 minute read

</p>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/img/profile/profile-00.jpg" alt="Carlos Gomes" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Carlos Gomes</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Iâ€™m a scientist, psychologist, math modeler, programmer, mtg player, free knowledge supporter, sbc fanatic, and electronics hobbyist.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Brazil</span>
        </li>
      

      
        
          
            <li><a href="mailto:me@cgomesu.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Main e-mail</span></a></li>
          
        
          
        
          
            <li><a href="https://cgomesu.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">https://cgomesu.com</span></a></li>
          
        
          
        
          
        
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Towards a smarter Home Assistant: Getting started on the analytical tools (and moving beyond)">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2021-06-04T10:40:00-03:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-list"></i> Table of Contents</h4></header>
              <ul class="toc__menu">
  <li><a href="#changelog">Changelog</a></li>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#outline">Outline</a></li>
  <li><a href="#prerequisites">Prerequisites</a>
    <ul>
      <li><a href="#hass-core">HASS Core</a></li>
      <li><a href="#hass-configuration-files">HASS configuration files</a></li>
      <li><a href="#hass-database">HASS database</a>
        <ul>
          <li><a href="#default-database">Default database</a></li>
          <li><a href="#resetting-entity-data-in-the-db">Resetting entity data in the DB</a></li>
        </ul>
      </li>
      <li><a href="#statistics">Statistics</a></li>
    </ul>
  </li>
  <li><a href="#implementation">Implementation</a>
    <ul>
      <li><a href="#data">Data</a></li>
      <li><a href="#sampling">Sampling</a></li>
      <li><a href="#utilities">Utilities</a>
        <ul>
          <li><a href="#history-stats">History Stats</a></li>
          <li><a href="#statistics-1">Statistics</a></li>
          <li><a href="#trend">Trend</a></li>
          <li><a href="#integration">Integration</a></li>
        </ul>
      </li>
      <li><a href="#statistical-inference">Statistical inference</a>
        <ul>
          <li><a href="#visualizing-inferences">Visualizing inferences</a></li>
        </ul>
      </li>
      <li><a href="#inferential-automations">Inferential automations</a></li>
    </ul>
  </li>
  <li><a href="#development">Development</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>

            </nav>
          </aside>
        
        <h1 id="changelog">Changelog</h1>
<p class="notice notice--info"><strong>June 4th, 2021</strong>: Publication of the original article</p>

<p><a href="#" class="btn btn--light-outline btn--small">top</a></p>

<h1 id="introduction">Introduction</h1>
<p><a href="https://www.home-assistant.io/">Home Assistant</a> (HASS) is a free and open-source software (FOSS) that provides a feature-rich environment for managing, controlling, and automating smart home devices, such as light bulbs, blinders, and LED strips.  In addition, it provides a highly customizable system for collecting and organizing a multitude of data (e.g., on/off device states, local temperature, GPS tracking, exchange rates), as provided by <strong>more than a thousand <a href="https://www.home-assistant.io/integrations">integrations</a></strong> with <a href="https://en.wikipedia.org/wiki/Internet_of_things">Internet of things</a> (IoT) devices (e.g., <a href="https://sonoff.tech/">Sonoff</a>, <a href="https://wyze.com/">Wyze</a>, <a href="https://www.z-wave.com/">Z-Wave</a>), local sensors (e.g., micro-controllers or single-board computers connected to sensor modules), and cloud-based services (e.g., weather and financial web APIs).</p>

<p><a href="/assets/posts/2021-06-04-smarter-hass/hass-demo.jpg"><img src="/assets/posts/2021-06-04-smarter-hass/hass-demo.jpg" alt="HASS demo frontend" class="PostImage PostImage--large" /></a></p>

<p>More often than not, people use HASS to view or modify the <strong>current state and value</strong> of integrated devices and sensors via manual triggers (e.g., pressing a button to turn off the AC) or automations (e.g., if the temperature is lower than 14Â°C, then turn on the heat).  However, the <a href="https://www.home-assistant.io/integrations#utility">HASS utility integrations</a> offer users the possibility to go (way) beyond with the help of built-in mathematical and statistical tools.  More specifically, such <strong>analytical tools</strong> allow users to summarize past states and measurements to answer questions such as:</p>

<ul>
  <li>How many times has the front door been opened over the last 24hrs and for how long?</li>
  <li>How much energy (kWh) has my uninterrupted power supply used over the last month?</li>
  <li>What was the average temperature in the living-room during yesterdayâ€™s morning, afternoon, and evening?  What about last week?</li>
  <li>What is the average level of volatile organic compounds (VOC) measured by the <a href="https://www.bosch-sensortec.com/products/environmental-sensors/gas-sensors/bme680/">BME680 sensor</a> in my bedroom?  How much does it change over the day?</li>
</ul>

<p><a href="/assets/posts/2021-06-04-smarter-hass/voc-plot.jpg"><img src="/assets/posts/2021-06-04-smarter-hass/voc-plot.jpg" alt="VOC plot" class="PostImage PostImage--large" /></a></p>

<p>In addition, the same analytical tools can be used to make statistical, data-driven inferences about the <strong>future states</strong> of smart devices and sensors to create what I call <em>inferential automations</em>. Inferential automations determine actions based on abnormal states and measurements, for example, or reliable tendencies over a user-specified period of time:</p>

<ul>
  <li>if the water level is <em>significantly lower than yesterday</em>, then __ .</li>
  <li>if the number of detected cars on my camera is <em>significantly higher than thirty minutes ago</em>, then __ .</li>
  <li>if the temperature started <em>decreasing significantly over the last five minutes</em>, then __ .</li>
  <li>if the VOC started <em>increasing significantly over the last fifteen minutes</em>, then __ .</li>
</ul>

<p><a href="/assets/posts/2021-06-04-smarter-hass/voc-plot-linear-fit.jpg"><img src="/assets/posts/2021-06-04-smarter-hass/voc-plot-linear-fit.jpg" alt="VOC plot linear fit" class="PostImage PostImage--large" /></a></p>

<p>Unfortunately, according to the HASS website, the <a href="https://www.home-assistant.io/integrations/statistics/">Statistics</a> and related utilities are currently used by less than 5% of the HASS userbase.  I feel there is much to be explored and gained from the application of <strong>dynamic statistical inferences</strong> in home automation systems.  To mention a few reasons, sensors are susceptible to measurement error and many user-defined events (e.g., Carlos is at home) are multidimensional and frequently determined by more factors than integrated with a home automation system (e.g., my cellphone connected to my homeâ€™s private network is not a sufficient condition to tell that Iâ€™m at home but it does inform about the likelihood that I am at home).  This creates uncertainty about the current and future states of things but fortunately, the uncertainty can be quantified and taken into account by various statistical tools that have already been developed.</p>

<p>Furthermore, the fact that HASS integrations are written in the <a href="https://www.python.org/">Python programming language</a> makes HASS a prime candidate for exploring the use of statistical inference in home automation systems because many mathematical and statistical packages are already available in Python and are widely used and well-maintained (e.g., <a href="https://pypi.org/project/numpy/"><code class="language-plaintext highlighter-rouge">numpy</code></a> and <a href="https://pypi.org/project/scipy/"><code class="language-plaintext highlighter-rouge">scipy</code></a>). Therefore, porting new and more sophisticated analytical tools to HASS should be fairly straightforward.  (More on this in the <a href="#development">Development</a> section).</p>

<p>If you find these ideas interesting and want to get started on their implementation in your own personal HASS instances, then read on.  As in my previous guides and tutorials, I tried to unpack and digest as much of the content as possible, the goal being to make it accessible to experts as well as novices.  Check the <a href="#changelog">Changelog</a> for updates and if you ever get stuck on something or just want to share a few ideas and opinions, feel free to <a href="/contact">get in touch with me</a>.</p>

<p><a href="#" class="btn btn--light-outline btn--small">top</a></p>

<h1 id="outline">Outline</h1>
<ul>
  <li>TODO: General picture of the structure</li>
</ul>

<p><a href="#" class="btn btn--light-outline btn--small">top</a></p>

<h1 id="prerequisites">Prerequisites</h1>
<p>The implementation of analytical tools in HASS has the following basic requirements:</p>

<ol>
  <li>A <a href="#hass-core">HASS <strong>Core</strong></a> instance;</li>
  <li>Understanding of <a href="#hass-configuration-files">the <strong>configuration</strong> files and the <strong>YAML</strong> syntax</a>;</li>
  <li>Understanding the <a href="#hass-database">HASS <strong>database</strong></a>;</li>
  <li>And of course, <a href="#statistics">basic <strong>statistics</strong></a> knowledge.</li>
</ol>

<p>Those four topics are described separately next.  If you are already familiar with them, feel free to skip straight to the main <a href="#implementation">Implementation</a> section.  However, at the very least, I suggest to glance over each topic to make sure we are on the same page before moving on.</p>

<h2 id="hass-core">HASS Core</h2>
<p>Structurally, HASS can be divided into three main layers: (a) Core; (b) Supervisor; and (c) Operating System (OS).  The folks at the HASS wiki were kind enough to put together a plethora of <a href="https://www.home-assistant.io/installation/">installation methods</a> for all sorts of OSes and environments (bare-metal vs. virtual).  For this guide, however, only the most basic layer of the HASS system is needed, namely the <strong>HASS Core</strong>, which is available in <em>any</em> installation method.</p>

<p>Instead of using an existing HASS instance, I <strong>strongly</strong> recommend to <strong>create a containerized (Docker) HASS instance</strong> for testing purposes.  This will be much safer than playing with an existing HASS instance and its database.</p>

<p>To create a HASS Docker container, follow the instructions in the <strong>official documentation</strong>:</p>

<ol>
  <li><a href="https://docs.docker.com/engine/install/">Install <strong>Docker Engine - Community Edition</strong></a>;</li>
  <li>(<em>Optional</em>.) <a href="https://documentation.portainer.io/v2.0/deploy/ceinstalldocker/">Install <strong>Portainer - Community Edition</strong></a> to manage your Docker containers;</li>
  <li><a href="https://www.home-assistant.io/installation/linux#install-home-assistant-container">Install <strong>HASS Docker container</strong></a>.</li>
</ol>

<p>Of note, after deploying the HASS container, use a hostâ€™s text editor (e.g., <code class="language-plaintext highlighter-rouge">nano</code>, <code class="language-plaintext highlighter-rouge">vi</code>, <code class="language-plaintext highlighter-rouge">vim</code>, <code class="language-plaintext highlighter-rouge">pluma</code>) to edit the <code class="language-plaintext highlighter-rouge">configuration.yaml</code> file and related configuration files.  Whenever you create a new <code class="language-plaintext highlighter-rouge">.yaml</code> file, make sure that the HASS user will have permission to read it at the very least, or you will run into issues.  Finally, in the HASS webUI, your HASS user must be able to access the <a href="https://www.home-assistant.io/docs/tools/dev-tools/"><strong>Developer Tools</strong> &gt; Services</a> tab to check the state of each entity and their attributes.  The default admin user should have access to such a resource.</p>

<h2 id="hass-configuration-files">HASS configuration files</h2>
<p>The configuration files in HASS use a human-readable data serialization language called <a href="https://yaml.org/"><strong>YAML</strong></a> (YAML Ainâ€™t Markup Language).  In this guide, we will use YAML to edit and create configuration files for HASS that will customize database settings and new entities to collect data and help with their visualization.</p>

<p>If you are new to YAML, take a few minutes right now to familiarize yourself with it.  The HASS wiki has a straight to the point explanation that I invite everyone to read:</p>

<ul>
  <li><a href="https://www.home-assistant.io/docs/configuration/yaml/">https://www.home-assistant.io/docs/configuration/yaml/</a></li>
</ul>

<p>To highlight a few important points about the configuration files and the YAML syntax:</p>

<ul>
  <li>Indentation and spacing in general are <strong>very</strong> important in YAML. Use only the spacebar and maintain consistency across all configuration files. If at all possible, use an editor that shows whitespaces when editing any YAML files;</li>
  <li>UPPER and lower cases matter;</li>
  <li>Use <code class="language-plaintext highlighter-rouge">#</code> to add comments;</li>
  <li>Use <code class="language-plaintext highlighter-rouge">""</code> (double quotation marks) for escaping special characters in sequences (e.g., <code class="language-plaintext highlighter-rouge">"Hey! What's up?"</code>) and <code class="language-plaintext highlighter-rouge">''</code> (single quotation marks) when escaping is not necessary (e.g., <code class="language-plaintext highlighter-rouge">'Nothing much.'</code>);</li>
  <li>Use the <code class="language-plaintext highlighter-rouge">!include</code> for splitting up your <code class="language-plaintext highlighter-rouge">configuration.yaml</code>. For instance, instead of adding all your <code class="language-plaintext highlighter-rouge">sensor:</code> and <code class="language-plaintext highlighter-rouge">binary_sensor:</code> to the <code class="language-plaintext highlighter-rouge">configuration.yaml</code> file itself, create <code class="language-plaintext highlighter-rouge">sensors.yaml</code> and <code class="language-plaintext highlighter-rouge">binary_sensors.yaml</code> files in the <code class="language-plaintext highlighter-rouge">config/</code> directory and then use <code class="language-plaintext highlighter-rouge">!include</code> to add them automatically to your <code class="language-plaintext highlighter-rouge">configuration.yaml</code>:
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sensors</span>
<span class="na">sensor</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">sensors.yaml</span>
<span class="na">binary_sensor</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">binary_sensors.yaml</span>
</code></pre></div>    </div>
  </li>
  <li>Use <code class="language-plaintext highlighter-rouge">!secret</code> and a <code class="language-plaintext highlighter-rouge">secrets.yaml</code> for managing passwords.  (See more in the HASS wiki called <a href="https://www.home-assistant.io/docs/configuration/secrets/">Storing secrets</a>.)</li>
</ul>

<p>Finally, after making any changes to any YAML file (and saving them), it is necessary to <a href="https://www.home-assistant.io/docs/configuration/#reloading-changes"><strong>reload</strong> the <code class="language-plaintext highlighter-rouge">configuration.yaml</code> file</a>.  If your installation method does not allow for selective reloading, then go ahead and reload the entire HASS.  However, <em>before reloading any configuration file</em>, use the <code class="language-plaintext highlighter-rouge">hass --script check_config</code> script to make sure your <code class="language-plaintext highlighter-rouge">configuration.yaml</code> file is okay, as follows:</p>

<ul>
  <li>
    <p>From within the HASS webUI, navigate to <strong>Configuration</strong> &gt; <strong>Server Controls</strong> &gt; Configuration validation.</p>

    <p><a href="/assets/posts/2021-06-04-smarter-hass/hass-config-validation.jpg"><img src="/assets/posts/2021-06-04-smarter-hass/hass-config-validation.jpg" alt="HASS config validation" class="PostImage PostImage--large" /></a></p>

    <p><a href="/assets/posts/2021-06-04-smarter-hass/hass-config-reload.jpg"><img src="/assets/posts/2021-06-04-smarter-hass/hass-config-reload.jpg" alt="HASS config reload" class="PostImage PostImage--large" /></a></p>

    <p class="notice">Alternatively, if running the HASS Docker container, use <code class="language-plaintext highlighter-rouge">docker exec homeassistant python -m homeassistant --script check_config --config /config</code> to run the <code class="language-plaintext highlighter-rouge">check_config</code> script from your host machine.  (This assumes that your HASS container is called <code class="language-plaintext highlighter-rouge">homeassistant</code>. If this is not the case, change it accordingly.)</p>
  </li>
</ul>

<p>Always keep an eye on the <code class="language-plaintext highlighter-rouge">home-assistant.log</code> file for errors.  This will greatly help you troubleshooting most issues on your own (e.g., incorrect references or operations in templates).</p>

<h2 id="hass-database">HASS database</h2>
<p>HASS uses a relational database (DB) management system (RDBMS) based on the <strong>SQL engine</strong> and by default, it creates a <a href="https://www.sqlite.org/index.html"><strong>SQLite DB</strong></a> in <code class="language-plaintext highlighter-rouge">config/home-assistant_v2.db</code> to track events and parameters over time.  If you want to learn more about and dive into the HASS DB, including how to create your own SQL backend, take a look at the two following resources:</p>

<ul>
  <li><a href="https://www.home-assistant.io/docs/backend/database/">https://www.home-assistant.io/docs/backend/database/</a></li>
  <li><a href="https://www.home-assistant.io/integrations/recorder/">https://www.home-assistant.io/integrations/recorder/</a></li>
</ul>

<p>Fortunately, most users wonâ€™t need to learn RDBMSes and SQL to take advantage of analytical tools in HASS because the default SQLite DB is usually enough.  However, there are a few aspects about the <strong>default settings</strong> that can affect the way the data are analyzed.  Those aspects are described in more detail next.</p>

<h3 id="default-database">Default database</h3>
<p>In the <code class="language-plaintext highlighter-rouge">configuration.yaml</code> file, the <strong>default SQLite DB</strong> is created along with many of the other default settings by the following configuration variable:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">default_config</span><span class="pi">:</span>
</code></pre></div></div>

<p>To change the default DB settings, it is necessary to add a <code class="language-plaintext highlighter-rouge">recorder:</code> configuration variable to the <code class="language-plaintext highlighter-rouge">configuration.yaml</code> file, as follows:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">default_config</span><span class="pi">:</span>
<span class="c1"># Customized DB settings</span>
<span class="na">recorder</span><span class="pi">:</span>
</code></pre></div></div>

<p>The documentation of the specific <code class="language-plaintext highlighter-rouge">recorder:</code> variables can be found at the HASS wiki:</p>

<ul>
  <li><a href="https://www.home-assistant.io/integrations/recorder/">https://www.home-assistant.io/integrations/recorder/</a></li>
</ul>

<p>In brief, by default, the HASS DB <strong>keeps historical data up to 10 days</strong> (<code class="language-plaintext highlighter-rouge">purge_keep_days: 10</code>), running an automatic purge of the database every night to prevent the DB from increasing in size indefinitely (<code class="language-plaintext highlighter-rouge">auto_purge: true</code>).  Therefore, <em>if you want to keep data from one or more entities for longer than 10 days</em>, then you must edit the DB default settings.  The <code class="language-plaintext highlighter-rouge">include</code> and <code class="language-plaintext highlighter-rouge">exclude</code> filter parameters are particularly useful whenever working with non-default settings, as they help you specify which entities should be tracked.  <a href="https://www.home-assistant.io/integrations/recorder/#common-filtering-examples">Check the HASS wiki Configure Filter for examples</a>.</p>

<p>In addition, as mentioned before, the default DB is stored in your <code class="language-plaintext highlighter-rouge">config/</code> directory and also by default, <strong>changes are committed to the DB every 1 sec</strong> (<code class="language-plaintext highlighter-rouge">commit_interval: 1</code>). This matters because if you are collecting data over a time window lower than 1 sec, then you might want to change the commit interval to <code class="language-plaintext highlighter-rouge">0</code> (zero, or as soon as possible) instead. At this point, it is also important to consider where the DB is being physically stored (SD card, eMMC, HDD, or SSD), owing to <strong>disk I/O</strong> and <strong>wear and tear</strong> considerations.  (More advanced aspects come into play if HASS is not the only application committing to the DB but I trust that if this is your case, then you probably know how to customize the HASS DB accordingly.)</p>

<p>For advanced users who want to browse and manually add/edit entries from the default (SQLite) <code class="language-plaintext highlighter-rouge">home-assistant_v2.db</code>, it is possible to use the <a href="https://sqlitebrowser.org/">SQLite Database Browser</a>.  Just keep in mind that the default HASS DB might have permissions (ownership and group membership) that are incompatible with your current host user and therefore, you might be unable even to read the DB without first editing the permissionsâ€“in Linux, appending <code class="language-plaintext highlighter-rouge">sudo</code> to <code class="language-plaintext highlighter-rouge">sqlitebrowser</code> should give you access no matter what though.</p>

<h3 id="resetting-entity-data-in-the-db">Resetting entity data in the DB</h3>
<p>In addition to the SQL browser method of editing the HASS DB, HASS allow users to run a <a href="https://www.home-assistant.io/docs/scripts/service-calls/">service call</a> from within the webUI to manually run a <strong>purge task</strong>. This is particularly useful to run once you are done making changes to a newly created template entity and want to clean any previous (and possibly erroneous) records from the DB.  To remove all the data from a list of entities, do the following:</p>

<ol>
  <li>Navigate to <strong>Developer Tools</strong> &gt; States;</li>
  <li>Select <strong>Go to YAML mode</strong> and paste the following:
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">service</span><span class="pi">:</span> <span class="s">recorder.purge_entities</span>
<span class="na">target</span><span class="pi">:</span>
  <span class="na">entity_id</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">sensor.my_template_entity_01</span>
    <span class="pi">-</span> <span class="s">sensor.my_template_entity_02</span>
</code></pre></div>    </div>
    <p>in which <code class="language-plaintext highlighter-rouge">sensor.my_template_entity*</code> are the target template entities you want to purge;</p>
  </li>
  <li>Press <strong>Call Service</strong> to purge their data from the DB. The new data will be collected as soon as an update is triggered (see the <a href="#sampling">Sampling</a> section).</li>
</ol>

<p>Of course, there are other <code class="language-plaintext highlighter-rouge">recorder</code> services available in the Developer Tools &gt; Services tab. Feel free to explore them.</p>

<h2 id="statistics">Statistics</h2>

<p><a href="/assets/posts/2021-06-04-smarter-hass/humor-stats.png"><img src="/assets/posts/2021-06-04-smarter-hass/humor-stats.png" alt="Humor about stats" class="PostImage PostImage--large" /></a></p>

<p>You donâ€™t need to be a mathematician who specialized in statistics to make use of it.  In this guide, we will only make reference to very introductory statistical knowledge, such as measures of central tendency (e.g., mean, median), variability (e.g., variance, standard deviation) and simple (univariate) linear regression (e.g., gradient/slope). Similarly, math-wise, I will briefly talk about first-order derivatives (the ratio of the increment) and integrals (the area under the curve).</p>

<p>The goal in this guide is to present a starting point for more advanced usage of analytical tools in home automation systems.  The possibilities are endless for knowledgeable users (e.g., application of Bayesian methods, dynamic mixed-effects modeling) and how far you will go along these paths is up to you.</p>

<p>Fortunately, it doesnâ€™t take much to create really good inferential automations for your HASS instances. If you want to refresh your stats knowledge or dig deeper into it, save some time and take a look at the following resources:</p>

<ul>
  <li>Basic calculus refresher:
    <ul>
      <li><em>TODO: Embed videos? Series + Derivative + Integration</em></li>
    </ul>
  </li>
  <li>Basic stats refresher:
    <ul>
      <li><em>TODO: Embed videos? Probability + Basic stats</em></li>
    </ul>
  </li>
  <li>Reading material:
    <ul>
      <li>Introduction:
        <ul>
          <li><em>TODO: Link to papers and books</em></li>
        </ul>
      </li>
      <li>Advanced topics:
        <ul>
          <li><em>TODO: Link to papers and books</em></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><a href="#" class="btn btn--light-outline btn--small">top</a></p>

<h1 id="implementation">Implementation</h1>
<p>The main functionalities in HASS are extended by the configuration of new <strong>integrations</strong>.  According to the <a href="https://www.home-assistant.io/docs/glossary/">HASS Glossary</a>,</p>

<blockquote>
  <p><a href="https://www.home-assistant.io/integrations/">Integrations</a> provide the core logic for the functionality in Home Assistant.</p>
</blockquote>

<p>Therefore, the analytical tools covered in this guide are implemented by one or more of the <strong>1800</strong> integrations that are currently supported by a community of home automation enthusiasts.  More specifically, most of the analytical tools are grouped under <a href="https://www.home-assistant.io/integrations/#utility">Utility</a> integrations and in this guide, I will cover the following four:</p>

<ol>
  <li><a href="#history-stats">History Stats</a></li>
  <li><a href="#statistics-1">Statistics</a></li>
  <li><a href="#trend">Trend</a></li>
  <li><a href="#integration">Integration</a></li>
</ol>

<p>The current set of analytical integrations is fairly limited in what it can do.  For the most part, the tools can be used to create summary statistics of the past states and measurements of integrated devices and sensors.  Inference-wise, a lot can be done via <a href="https://www.home-assistant.io/docs/configuration/templating/">templates</a> but moving forward, there is a need for more advanced analytical integrations.  For this reason, at the end of this guide, I added a section about <a href="#development">Development</a> for anyone interested in helping out.  First, however, we need to talk about <a href="#data">Data</a> and <a href="#sampling">Sampling</a>.</p>

<h2 id="data">Data</h2>
<p>Before delving into any analytical integration, there are at least three things that we need to do. First, we need to think about the nature of the data.  For example, consider the default <a href="https://www.home-assistant.io/integrations/sun/">Sun</a> (<code class="language-plaintext highlighter-rouge">sun.sun</code>) entity in HASS:</p>

<p><a href="/assets/posts/2021-06-04-smarter-hass/hass-entity-sun.jpg"><img src="/assets/posts/2021-06-04-smarter-hass/hass-entity-sun.jpg" alt="Sun entity" class="PostImage" /></a></p>

<p>While the <code class="language-plaintext highlighter-rouge">sun.sun</code> <em>state</em> is a <strong>discrete</strong> variable (itâ€™s either <code class="language-plaintext highlighter-rouge">above_horizon</code> or <code class="language-plaintext highlighter-rouge">below_horizon</code>), its <code class="language-plaintext highlighter-rouge">elevation</code> <em>attribute</em> is actually <strong>continuous</strong> (e.g., <code class="language-plaintext highlighter-rouge">35.84</code>Â° between the sun and the horizon) and therefore, it doesnâ€™t make sense to use the same tools to analyze both of them.  Nonetheless, discrete variables can be transformed into continuous ones (e.g., the sun was <code class="language-plaintext highlighter-rouge">above_horizon</code> for <code class="language-plaintext highlighter-rouge">34.1</code>% of the day), and similarly, continuous variables can be discretised (e.g., the elevation is either <code class="language-plaintext highlighter-rouge">negative</code> or <code class="language-plaintext highlighter-rouge">positive</code> or <code class="language-plaintext highlighter-rouge">zero</code>) in order to better answer our questions of interest.</p>

<p>Second, we need to check whether HASS is keeping track of the data we need. There are multiple ways of doing that but by far, the easiest method is to navigate to <strong>Developer Tools</strong> &gt; States and then make sure that the entities whose states and attributes we would like to keep track of are being listed there.  (Alternatively, you can open the HASS DB with a SQL browser and look for the entity in the <code class="language-plaintext highlighter-rouge">states</code> Table.)</p>

<p><a href="/assets/posts/2021-06-04-smarter-hass/hass-developer-tools.jpg"><img src="/assets/posts/2021-06-04-smarter-hass/hass-developer-tools.jpg" alt="HASS developer tools" class="PostImage PostImage--large" /></a></p>

<p>Third, we need to check how the data are being represented in the DB.  As in the previous example, some variables might be an attribute of an existing entity in the HASS DB.  If the <code class="language-plaintext highlighter-rouge">recorder:</code> settings for such entity are fine for the type of analysis you want to automate (e.g., purge every 10 days), then you should be fine.  However, notice that <em>attributes</em> cannot be displayed the same way as the <em>states</em> of an entity in the HASS webUI.  In addition, you might want to <strong>pre-process</strong> the attributes (e.g., <code class="language-plaintext highlighter-rouge">float</code> and then <code class="language-plaintext highlighter-rouge">round(2)</code>) or perform transformations before running the analysis.</p>

<p>For all such a reasons, I always create <strong>new entities</strong> for the variables that will be analyzed. This is accomplished with the <a href="https://www.home-assistant.io/integrations/template/"><code class="language-plaintext highlighter-rouge">template</code> integration</a>.  Per the HASS wiki:</p>

<blockquote>
  <p>The template integration allows creating entities which derive their values from other data. This is done by specifying templates for properties of an entity, like the name or the state.</p>
</blockquote>

<p><a href="https://www.home-assistant.io/docs/configuration/templating/#building-templates">Building templates</a> is fairly easy once you get the hang of the syntax.  In short, templates follow the <a href="https://palletsprojects.com/p/jinja"><strong>Jinja2</strong> templating engine</a> and are mainly used to perform mathematical operations (<code class="language-plaintext highlighter-rouge">+</code>, <code class="language-plaintext highlighter-rouge">-</code>, <code class="language-plaintext highlighter-rouge">*</code>, <code class="language-plaintext highlighter-rouge">/</code>) and logic tests (if <code class="language-plaintext highlighter-rouge">true</code> , then __ ) but can also do loops (for <code class="language-plaintext highlighter-rouge">i</code> in <code class="language-plaintext highlighter-rouge">states.sensor</code>), for example.  As a result, templates give users a scripting tool to go beyond the HASS built-in functionalities.</p>

<p>As an example, letâ€™s create an entity to store and round to zero the <code class="language-plaintext highlighter-rouge">sun.sun</code> <code class="language-plaintext highlighter-rouge">elevation</code> attribute.  First, in the <code class="language-plaintext highlighter-rouge">configuration.yaml</code>, <strong>append</strong> (add to the bottom) a reference to the <code class="language-plaintext highlighter-rouge">templates.yaml</code> configuration file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Templates</span>
<span class="na">template</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">templates.yaml</span>
</code></pre></div></div>

<p>Then, use a text editor to create an empty <code class="language-plaintext highlighter-rouge">templates.yaml</code> file and create a sensor template for the sun elevation, as follows:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sensor templates</span>
<span class="pi">-</span> <span class="na">sensor</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">template</span><span class="nv"> </span><span class="s">sun</span><span class="nv"> </span><span class="s">elevation"</span>
      <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Â°"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="pi">&gt;</span>
        <span class="s">{{ state_attr('sun.sun', 'elevation') | float | round(0) }}</span>
</code></pre></div></div>

<p>Notice that in <code class="language-plaintext highlighter-rouge">state:</code>, we use <code class="language-plaintext highlighter-rouge">state_attr()</code> to retrieve the <code class="language-plaintext highlighter-rouge">elevation</code> attribute of the <code class="language-plaintext highlighter-rouge">sun.sun</code> entity. Then, we use <code class="language-plaintext highlighter-rouge">float</code> to force the output to a <a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic">floating point number</a>, which ensures that the output is interpreted as a number, and run <code class="language-plaintext highlighter-rouge">round(0)</code> on the numeric output to round the decimals to zero cases.  The result should be an <a href="https://en.wikipedia.org/wiki/Integer">integer</a> of the Sun elevation.  (Alternatively, we could simply use <code class="language-plaintext highlighter-rouge">int</code> to convert the output to an integer, of course.)</p>

<p class="notice">I find the use of the folded style (<code class="language-plaintext highlighter-rouge">&gt;</code>) very helpful in keeping the templates organized. Refer to the <a href="https://yaml.org/spec/1.2/spec.html">YAML - Scalars</a> documentation for more information.</p>

<p>Check your <code class="language-plaintext highlighter-rouge">configuration.yaml</code> file for errors (Configuration &gt; Server Controls &gt; Configuration validation), and finally, <strong>reload your HASS</strong>.  Afterwards, navigate to Developers Tools &gt; States and if everything is correct, you should see a new <code class="language-plaintext highlighter-rouge">sensor.template_sun_elevation</code> entity:</p>

<p><a href="/assets/posts/2021-06-04-smarter-hass/hass-entity-template-sun-elevation.jpg"><img src="/assets/posts/2021-06-04-smarter-hass/hass-entity-template-sun-elevation.jpg" alt="HASS template sun elevation" class="PostImage PostImage--large" /></a></p>

<p>By default, the values of this newly created entity will update as soon as the Sun <code class="language-plaintext highlighter-rouge">elevation</code> attribute changes. However, it is also possible to configure different <strong>triggers</strong> for <strong>template entities</strong>.  This is particularly relevant for the next topic, namely data sampling.</p>

<h2 id="sampling">Sampling</h2>
<p>Devices, sensors, and services measure and transmit data with a certain frequency, which I refer by the term <strong>measurement resolution</strong>.  Such a frequency might be determined by a time-based rule (e.g., every 1 sec) or an event (HTTP request) or a combination of both.  Regardless of the nature of the trigger, the <em>higher</em> the measurement resolution, the more frequent the measurement and transmission are.  For example, an <a href="https://www.espressif.com/en/products/devkits">ESP32 Development board</a> connected to a <a href="https://www.bosch-sensortec.com/products/environmental-sensors/humidity-sensors-bme280/">BME280 environmental sensor</a> might send a temperature measurement <em>every 5 minutes</em> to a MQTT broker.  Therefore, for all intended purposes, the measurement resolution of such a temperature sensor is <em>at best</em> 5 minutes.  Now, if a second ESP32 measures and send data <em>every 1 minute</em> instead, then the measurement resolution of the latter ESP32 is higher than the former (i.e., we can expect it to send temperature data more frequently).</p>

<p>As mentioned before, in HASS, <strong>template entities</strong> follow state-based updates by defaultâ€“that is, they update as soon as the data of any of the referenced entities change.  Letâ€™s say that over a 20-min window, none of the referenced data changed.  This means that the template entity also didnâ€™t change and more importantly, in the DB, there will be a <em>single data point</em> over the 20-min window.  However, letâ€™s say that over the same 20-min window, one of the referenced data changed twice. This means that the template entity now changed twice and more importantly, in the DB, there will be <em>three data points</em> over the 20-min window.  This a very efficient way of storing data but you can probably see how this might affect the usage of analytical tools, owing to an inconsistent number of data points over equal time-frames as well as the under-representation of data over time.</p>

<p>Fortunately, just like we specify triggers for automations, HASS offers the possibility to specify <a href="https://www.home-assistant.io/integrations/template/#trigger-based-template-sensors">triggers for template entities</a>.  Thereâ€™s a large variety of triggers that can be used here (e.g, <code class="language-plaintext highlighter-rouge">webhook</code>, <code class="language-plaintext highlighter-rouge">mqtt</code>) but for <strong>longitudinal analysis</strong>, the most useful one is the <a href="https://www.home-assistant.io/docs/automation/trigger#time-pattern-trigger"><strong>time pattern</strong> trigger</a>, called <code class="language-plaintext highlighter-rouge">time_pattern</code>.  Time pattern triggers can be specified for hours (<code class="language-plaintext highlighter-rouge">hours:</code>), minutes (<code class="language-plaintext highlighter-rouge">minutes:</code>), and seconds (<code class="language-plaintext highlighter-rouge">seconds:</code>), and for each one, itâ€™s possible to prefix the value with a <code class="language-plaintext highlighter-rouge">/</code> to match whenever the current value is divisible by the specified value (e.g., <code class="language-plaintext highlighter-rouge">hours: "/2"</code> will match every 2 hours) or use <code class="language-plaintext highlighter-rouge">*</code> to match any value (e.g., <code class="language-plaintext highlighter-rouge">minutes: "*"</code> to match every minute).</p>

<p>To create a time pattern trigger for one or more template entity sensor, simply add a list of time-based <code class="language-plaintext highlighter-rouge">sensor:</code> and <code class="language-plaintext highlighter-rouge">binary_sensor:</code> under a <code class="language-plaintext highlighter-rouge">trigger:</code> configuration in the <code class="language-plaintext highlighter-rouge">templates.yaml</code> configuration file, as follows:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Time pattern trigger</span>
<span class="pi">-</span> <span class="na">trigger</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">platform</span><span class="pi">:</span> <span class="s">time_pattern</span>
      <span class="c1"># Update every 5 minutes</span>
      <span class="na">minutes</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/5"</span>
  <span class="c1"># Sensor templates</span>
  <span class="na">sensor</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">template</span><span class="nv"> </span><span class="s">sun</span><span class="nv"> </span><span class="s">elevation</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">time-based"</span>
      <span class="na">unit_of_measurement</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Â°"</span>
      <span class="na">state</span><span class="pi">:</span> <span class="pi">&gt;</span>
        <span class="s">{{ state_attr('sun.sun', 'elevation') | float | round(0) }}</span>
      <span class="na">attributes</span><span class="pi">:</span>
        <span class="na">timestamp</span><span class="pi">:</span> <span class="pi">&gt;</span>
          <span class="s">{{ as_timestamp(now()) }}</span>
</code></pre></div></div>

<p>Of note, the <code class="language-plaintext highlighter-rouge">timestamp:</code> under <code class="language-plaintext highlighter-rouge">attributes:</code> forces HASS to create a new entry on the DB (update) whenever the template is triggered.  This keeps the number of data points constant over time and each one of them will have a timestamp as attribute.  (In the DB, you will also see that if the state remained unchanged, it maintains the correct <code class="language-plaintext highlighter-rouge">last_changed</code> date and updates the <code class="language-plaintext highlighter-rouge">last_updated</code> variable.)</p>

<p>Also, notice that it does not make sense to use a <code class="language-plaintext highlighter-rouge">time_pattern</code> trigger rule that has higher resolution than the deviceâ€™s <em>measurement</em> resolution because then, thereâ€™s no chance for a new value to occur and the DB would just repeat the last transmitted measurement.  Ideally, the time pattern should <strong>match the measurement resolution</strong> but to save space, you might want to set a lower time pattern resolution (as in 1:2, or 1:4, and so on).</p>

<p>Finally, there is also the topic of statistical sampling (representativeness) when it comes to making generalizations from a couple of samples (e.g., environmental sensors in my bedroom and kitchen) to a population (temperature and humidity in my entire house).  In this guide, however, we will only make extrapolations about the devices, sensors, and services themselves, rather than any population that they might belong.</p>

<h2 id="utilities">Utilities</h2>
<ul>
  <li>Tools to prepare the collected data for inferential automations</li>
  <li>Each covered utility includes an usage example that anyone can follow along using a fresh or existing HASS instance</li>
</ul>

<h3 id="history-stats">History Stats</h3>
<ul>
  <li>Counting, compute ratios and state duration over a user-specified time</li>
  <li>Overview of the doc and configuration</li>
  <li>
    <p>Illustrate usage with an example anyone can use and follow along</p>
  </li>
  <li>Additional content
    <ul>
      <li>Codes and docs:
        <ul>
          <li>HASS doc: https://www.home-assistant.io/integrations/history_stats/</li>
          <li>HASS Github: https://github.com/home-assistant/core/tree/dev/homeassistant/components/history_stats</li>
          <li>Methods defined by the integration itself (no external dependencies)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="statistics-1">Statistics</h3>
<ul>
  <li>Multiple, general purpose descriptive statistics</li>
  <li>Overview of the doc and configuration</li>
  <li>
    <p>Illustrate with an example</p>
  </li>
  <li>Additional content
    <ul>
      <li>Codes and docs:
        <ul>
          <li>HASS doc: https://www.home-assistant.io/integrations/statistics/</li>
          <li>HASS Github: https://github.com/home-assistant/core/blob/dev/homeassistant/components/statistics/sensor.py</li>
          <li>Python (statistics core pkg): https://docs.python.org/3/library/statistics.html</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="trend">Trend</h3>
<ul>
  <li>Of note, depends on the <code class="language-plaintext highlighter-rouge">numpy</code> Python pkg.  More specifically, uses the <code class="language-plaintext highlighter-rouge">np.polyfit(time, values, degree=1)</code> method to estimate the slope of a linear function over a user-speficied time period (gradient).</li>
  <li>Note about the comparison between the Trend utility vs. Derivative: Derivative is just for the last two values over the last two time points; trend can accomplish the same thing for n=2 and can.</li>
  <li>Overview of the doc</li>
  <li>
    <p>Illustrate with an example anyone can use and follow along</p>
  </li>
  <li>Additional content
    <ul>
      <li>Codes and docs:
        <ul>
          <li>HASS doc: https://www.home-assistant.io/integrations/trend/</li>
          <li>HASS Github: https://github.com/home-assistant/core/blob/dev/homeassistant/components/trend/binary_sensor.py</li>
          <li>Python (NumPy): https://numpy.org/doc/stable/reference/generated/numpy.polyfit.html</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="integration">Integration</h3>
<ul>
  <li>
    <p>Area under the curve; cumulative measures, such as kWh for energy consumption</p>
  </li>
  <li>
    <p>Additional content</p>
    <ul>
      <li>Codes and docs:
        <ul>
          <li>HASS doc: https://www.home-assistant.io/integrations/integration/</li>
          <li>HASS Github: https://github.com/home-assistant/core/blob/dev/homeassistant/components/integration/sensor.py</li>
          <li>Methods defined by the integration itself (no external dependencies)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="statistical-inference">Statistical inference</h2>
<ul>
  <li>Where your statistics knowledge comes in</li>
  <li>At the very basic level:
    <ul>
      <li>Confidence intervals (CI): https://www.statology.org/test-significance-regression-slope/</li>
      <li>Distance from the mean in SD units</li>
    </ul>
  </li>
  <li>Notes on sample, power, and null hypothesis testing for robust dynamic predictions</li>
</ul>

<h3 id="visualizing-inferences">Visualizing inferences</h3>
<ul>
  <li>Making use of HASS built-in visualization tools
    <ul>
      <li>Historical plots</li>
      <li>Filters (state_filter gradients) to create heatmaps</li>
    </ul>
  </li>
  <li>Customized plots
    <ul>
      <li>Mini-graph card (https://github.com/kalkih/mini-graph-card)</li>
    </ul>
  </li>
</ul>

<h2 id="inferential-automations">Inferential automations</h2>
<ul>
  <li>Automations based on future states</li>
</ul>

<p><a href="#" class="btn btn--light-outline btn--small">top</a></p>

<h1 id="development">Development</h1>
<ul>
  <li>A lot more can be done via templating but consider developing and porting new analytic tools as utility integrations
    <ul>
      <li>Develop new integrations: https://developers.home-assistant.io/docs/development_index/</li>
    </ul>
  </li>
  <li>Ideas
    <ul>
      <li>Generalized polynomial fits for the Trend utility, instead of the forced linear
        <ul>
          <li>default degree = 1 assures backward compatibility</li>
        </ul>
      </li>
      <li>Correlations (linear, rank)</li>
      <li>Genrealized linear models and other common statistical models</li>
      <li>Endless possibilities for analytic tool development; most require simple porting to the HASS environment because we already have many Python pkgs for statistical analysis (e.g., SciPy)</li>
    </ul>
  </li>
</ul>

<p><a href="#" class="btn btn--light-outline btn--small">top</a></p>

<h1 id="conclusion">Conclusion</h1>

<p>This is all served via a beautiful and configurable web interface that can be accessed both locally and remotely using either any of the popular web browsers or its official app for <a href="https://play.google.com/store/apps/details?id=io.homeassistant.companion.android">Android</a> and <a href="https://apps.apple.com/us/app/home-assistant/id1099568401">iOS</a>.</p>

<p><a href="#" class="btn btn--light-outline btn--small">top</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Posted on:</strong> <time datetime="2021-06-04T10:40:00-03:00">June 4, 2021</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="mailto:?subject=[cgomesu.com] Towards a smarter Home Assistant: Getting started on the analytical tools (and moving beyond)&amp;body=%2Fblog%2Fsmarter-hass%2F " class="btn btn--inverse" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on E-mail"><i class="fas fa-envelope" aria-hidden="true"></i><span> E-mail</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=%2Fblog%2Fsmarter-hass%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.reddit.com/submit?title=Towards a smarter Home Assistant: Getting started on the analytical tools (and moving beyond)&url=%2Fblog%2Fsmarter-hass%2F" class="btn btn--reddit" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a>

  <a href="https://twitter.com/intent/tweet?text=Towards+a+smarter+Home+Assistant%3A+Getting+started+on+the+analytical+tools+%28and+moving+beyond%29%20%2Fblog%2Fsmarter-hass%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/blog/chimarrao-gaucho/" class="pagination--pager" title="How to make a chimarrÃ£o GaÃºcho
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search terms here...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search terms here..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/cgomesu" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
        
          <li><a href="https://www.reddit.com/user/cgomesu/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i> Reddit</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> RSS feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 CGomesu - Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> and <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a></div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
