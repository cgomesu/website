---
title: "DIY series: Cheap, reliable, low-profile, USB-powered Tasmota ambient sensor"
date: 2021-07-18 11:20:00 -0300
tags: diy-series tasmota sensor hass iot automation temperature
header:
  overlay_image: "/assets/posts/2021-07-18-diy-tasmota-bme280/header.jpg"
  overlay_filter: "0.6"
toc: true
toc_label: "Table of Contents"
toc_icon: "list"
---

# Changelog
**July 18th, 2021**: Publication of the original article
{:.notice--info }

[top](#){:.btn .btn--light-outline .btn--small}


# Introduction
This is the first article of a **Do It Yourself** (DIY) series in which I describe simple electronic projects that make use of an [ESP8266](https://www.espressif.com/en/products/socs/esp8266)/[ESP32](https://www.espressif.com/en/products/socs/esp32) board running the [Tasmota](https://github.com/arendst/Tasmota) firmware to integrate various modules into a home automation system, such as [Home Assistant](https://www.home-assistant.io/).  In this first iteration of the series, I described how to wire and configure a [**BME280**](https://www.bosch-sensortec.com/products/environmental-sensors/humidity-sensors-bme280/) to the tiny [**ESP-01**](http://www.ai-thinker.com/pro_view-60.html) (or its successor, the [ESP-01S](http://www.ai-thinker.com/pro_view-88.html)) to create a cheap, low-power, and low-profile ambient sensor that provides **temperature**, **humidity**, and **relative pressure** measurements to a Home Assistant instance.

- Here is a preview of the ambient sensor standalone and attached to a different devices:
  
[![ESP-BME280 sensor 01](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-01.jpg){:.PostImage .PostImage--large}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-01.jpg)

[![ESP-BME280 sensor 02](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-02.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-02.jpg)

[![ESP-BME280 sensor 03](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-03.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-03.jpg)

This is a great project for anyone who wants to get started on building their own Internet of Things (IoT) devices.  The article started with my motivation for this particular project.  Next, I talked about the hardware and software components, and finally, at the end, I covered the assembly of it all to create a functional unit.

Because this is such a low-profile project, I do not ever bother printing a case for it.  However, if you designed a case to house this particular project, [get in touch with me](/contact) and I will feature your case here.  But please [observe the official mounting instructions for the BME280 sensor](https://www.bosch-sensortec.com/media/boschsensortec/downloads/handling_soldering_mounting_instructions/bst-bme280-hs006.pdf) before printing your case because the heat generated by the ESP-01 and its USB adapter can affect the sensors.
{:.notice--info }

[top](#){:.btn .btn--light-outline .btn--small}

# Motivation
Over the years, I have started noticing that multiple devices spread across many households (e.g., smart TVs, sound systems, wireless routers, PC towers and laptops) had one or more **USB ports** that could be used to power a few DIY electronic projects.  

[![Device with USB port 01](/assets/posts/2021-07-18-diy-tasmota-bme280/device-usb-port-01.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/device-usb-port-01.jpg)

[![Device with USB port 02](/assets/posts/2021-07-18-diy-tasmota-bme280/device-usb-port-02.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/device-usb-port-02.jpg)

However, the most common type of USB port available ([USB 2.0](https://en.wikipedia.org/wiki/USB#USB_2.0)) usually delivers a maximum of *500mA* at *5V* (2.5W), which constraints the type of projects that could reasonably use such USB ports as power supply. In addition, because interfacing via the USB connection might not always be possible, due to proprietary and closed-source firmware, the DIY project should be able to transmit data wirelessly instead.

Fortunately, the **ESP-01 WiFi module** meets all such requirements. Specifically, it requires very little energy to operate safely (roughly 3.3V and at least 300mA) and can be connected to USB 2.0 ports via USB adapters that have a built-in voltage regulator.

[top](#){:.btn .btn--light-outline .btn--small}


# Overview of the main hardware components
## ESP-01
The **ESP-01** is a cheap and very small WiFi module developed by [Ai-Thinker](http://en.ai-thinker.com/) that is based on the ESP8266EX microcontroller unit (MCU) by [ESPRESSIF](https://www.espressif.com/):

[![ESP-01 top](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-top.png){:.PostImage .PostImage--large}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-top.png)

[![ESP-01 bottom](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-bottom.png){:.PostImage .PostImage--large}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-bottom.png)

[![ESP-01 dimensions and pinout](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-dimensions-pinout.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-dimensions-pinout.jpg)

[![ESP-01 schematics](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-schematics.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-schematics.jpg)

Of note, it **exposes only four GPIO pins** to interface with other devices--namely, `URXD`, `UTXD`, `GPIO2` and `GPIO0`--and it is powered via **`3v3 DC`** to the `VCC` and `GND` pins. Each of the eight exposed pins has specific functions, as suggested by their name:

| Pin # | Name         | Function                      |
|:-----:|:------------:|:-----------------------------:|
| `1`   | `GND`        | Ground                        |
| `2`   | `IO2`        | GPIO, internal pull-up        |
| `3`   | `IO0`        | GPIO, internal pull-up        |
| `4`   | `RX`         | UART0, serial RX data         |
| `5`   | `3V3`/`VCC`  | 3.3V power supply             |
| `6`   | `RST`        | Reset pin, active low         |
| `7`   | `EN`/`CH_PD` | Chip enabled pin, active high |
| `8`   | `TXD`        | UART0, serial TX data         |

In addition, there is no programmable ROM in the SoC, meaning that any software must be stored on the module's SPI flash.  Regarding the latter, there are actually three popular versions of the ESP-01 WiFi module that differ in flash memory size:

1. **ESP-01 Blue**: The original version with **`512KB`** of flash memory;
2. **ESP-01 Black**: The original version with **`1MB`** of flash memory;
3. **ESP-01S**: A revised version with **`1MB`** of flash memory.

Fortunately, visual inspection of the module can easily indicate which version it is:

[![ESP-01 comparison 01](/assets/posts/2021-07-18-diy-tasmota-bme280/esp01-version-comparison-01.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp01-version-comparison-01.jpg)

[![ESP-01 comparison 02](/assets/posts/2021-07-18-diy-tasmota-bme280/esp01-version-comparison-02.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp01-version-comparison-02.jpg)

The external SPI flash can be changed for anything up to `16MB`.  However, this requires de/soldering very small components and such procedure won't be covered in this guide.  My recommendation is to simply look for the versions that have at least `1MB` of flash memory, which is just enough for the project described in this article.

In fact, Ai-Thinker has developed [many other versions of the ESP-01 module](https://docs.ai-thinker.com/en/%E8%A7%84%E6%A0%BC%E4%B9%A6), such as the [ESP-01E](https://docs.ai-thinker.com/_media/esp8266/docs/esp-01e_product_specification_en.pdf) and [ESP-01F](https://docs.ai-thinker.com/_media/esp8266/docs/esp-01f_product_specification_en.pdf). However, such modules differ in other important aspects, like format and antenna, and for such a reason, they won't be covered here.  If interested, check their official e-commerce website at Alibaba.com ([https://ai-thinker.en.alibaba.com/](https://ai-thinker.en.alibaba.com/)) to learn how to acquire modules not covered here.
{:.notice--info }

## BME280
The **BME280** is a low-profile (`2.5 x 2.5 x 0.93 mm³`) and low-power (`3.6 mA` at roughly `3.3V`) environmental sensor developed by [Bosch Sensortec](https://www.bosch-sensortec.com). Specifically, this unit comes with high accuracy sensors for **temperature**, **humidity**, and **pressure**, all protected by a metal-lid.  Of note, it uses [I²C](https://en.wikipedia.org/wiki/I%C2%B2C) and [SPI](https://en.wikipedia.org/wiki/Serial_Peripheral_Interface) interfaces for data communication and is powered by **3v3 DC** (specifically, from `1.71V` to `3.6V`).

[![BME280 01 photo](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-01.png){:.PostImage .PostImage--large}](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-01.png)

[![BME280 02 dimensions](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-02.png){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-02.png)

Bosch Sensortec has made a terrific job at [documenting all many aspects about this sensor](https://www.bosch-sensortec.com/products/environmental-sensors/humidity-sensors-bme280/#documents). For quick reference, here are the main docs:

- [Datasheet](https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bme280-ds002.pdf)
- [Handling, soldering and mounting instructions](https://www.bosch-sensortec.com/media/boschsensortec/downloads/handling_soldering_mounting_instructions/bst-bme280-hs006.pdf)

[top](#){:.btn .btn--light-outline .btn--small}


# Hardware
To make a single ESP-01 Tasmota ambient sensor, you will need the following items:

- [ESP-01 Black](#) or [ESP-01S](#)

- [USB adapter for the ESP-01 with exposed pins](#)

- [BME280 module](#)
  - Depending on the module, may need soldering kit for headers

- 05x [Female-Female dupont wires](#)

- *Optional.* 01x [4x2 header for jumper wires](#)
- *Optional.* 01x [4x1 header for jumper wires](#)

[top](#){:.btn .btn--light-outline .btn--small}


# Software
*Tasmota info*

[top](#){:.btn .btn--light-outline .btn--small}


# Assembly
*Explain how to put it all together*

[top](#){:.btn .btn--light-outline .btn--small}


# Home assistant integration
*Describe Discovery and MQTT broker setup and HASS configuration*

[top](#){:.btn .btn--light-outline .btn--small}


# Conclusion
*Final remarks about the unit and its usage*

[top](#){:.btn .btn--light-outline .btn--small}


# TODO
- ~~Overview of the ESP01~~
- ~~Motivation for making the sensor~~
- ~~Overview of the ESP-01~~
- ~~Overview of the BME280~~
- Hardware
   1. ESP01 Black or ESP-01S
   2. BME280 module
   3. USB adapter for the ESP01 with exposed pins (add pinout)
   4. Female-female jumper wires
   5. Soldering stuff for the BME280 module (depends on module)
- Software
   1. Tasmota sensor binary (includes I2C sensor support)
   2. Template for the ESP-01
- Assembly
   1. Flashing + wiring (grounding GPIO0)
   2. Wiring for BME280 modules
   3. Tasmota configuration for I2C
- Home Assistant Integration
   1. MQTT
      1. Auto
      2. Manual
- Conclusion
- Review article

[top](#){:.btn .btn--light-outline .btn--small}
