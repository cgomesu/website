---
title: "DIY series: USB-powered, low-profile, and reliable ESP-01 Tasmota environmental sensor"
date: 2021-07-18 11:20:00 -0300
tags: diy-series tasmota sensor hass iot automation temperature
header:
  overlay_image: "/assets/posts/2021-07-18-diy-tasmota-bme280/header.jpg"
  overlay_filter: "0.6"
toc: true
toc_label: "Table of Contents"
toc_icon: "list"
---

# Changelog
**July 18th, 2021**: Publication of the original article
{:.notice--info }

[top](#){:.btn .btn--light-outline .btn--small}


# Introduction
This is the first article of a **Do It Yourself** (DIY) series in which I describe simple electronic projects that make use of an [ESP8266](https://www.espressif.com/en/products/socs/esp8266)/[ESP32](https://www.espressif.com/en/products/socs/esp32) board running the [Tasmota](https://github.com/arendst/Tasmota) firmware to integrate various modules into a home automation system, such as [Home Assistant](https://www.home-assistant.io/).  In this first iteration of the series, I described how to wire and configure a [**BME280**](https://www.bosch-sensortec.com/products/environmental-sensors/humidity-sensors-bme280/) to the tiny [**ESP-01**](http://www.ai-thinker.com/pro_view-60.html) (or its successor, the [ESP-01S](http://www.ai-thinker.com/pro_view-88.html)) to create a cheap, low-power, and low-profile ambient sensor that provides **temperature**, **humidity**, and **relative pressure** measurements to a Home Assistant instance.

- Here is a preview of the ambient sensor alone and attached to different devices:
  
[![ESP-BME280 sensor 01](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-01.jpg){:.PostImage .PostImage--large}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-01.jpg)

[![ESP-BME280 sensor 02](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-02.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-02.jpg)

[![ESP-BME280 sensor 03](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-03.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-bme280-sensor-03.jpg)

This is a great project for anyone who wants to get started on building their own Internet of Things (IoT) devices.  The article started with my motivation for this particular project.  Next, I talked about the hardware and software components, and finally, at the end, I covered the assembly of it all to create a functional unit.

Because this is such a low-profile project, I do not ever bother printing a case for it.  However, if you designed a case to house this particular project, [get in touch with me](/contact) and I will feature your case here.  But please [observe the official mounting instructions for the BME280 sensor](https://www.bosch-sensortec.com/media/boschsensortec/downloads/handling_soldering_mounting_instructions/bst-bme280-hs006.pdf) before printing your case because the heat generated by the ESP-01 and its USB adapter can affect the sensors.
{:.notice--info }

[top](#){:.btn .btn--light-outline .btn--small}

# Motivation
Over the years, I have started noticing that multiple devices spread across the household (e.g., smart TVs, sound systems, wireless routers, PC towers and laptops) had one or more **USB ports** that could be used to power a few DIY electronic projects.  

[![Device with USB port 01](/assets/posts/2021-07-18-diy-tasmota-bme280/device-usb-port-01.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/device-usb-port-01.jpg)

[![Device with USB port 02](/assets/posts/2021-07-18-diy-tasmota-bme280/device-usb-port-02.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/device-usb-port-02.jpg)

However, the most common type of USB port available ([USB 2.0](https://en.wikipedia.org/wiki/USB#USB_2.0)) usually delivers a maximum of `500mA` at `5V` (`2.5W`), which constraints the type of projects that could reasonably use such ports as power supply. In addition, because interfacing via the USB connection might not always be possible, owing to proprietary and closed-source firmware, the DIY project should be able to transmit data wirelessly instead.

Fortunately, the **ESP-01 WiFi module** meets all such requirements. Specifically, it requires very little energy to operate (roughly `.3W` on average, with `1W` peaks) and can be connected to USB 2.0 ports via USB adapters that have a built-in voltage regulator.

[![ESP-01 with USB adapter](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-with-usb-adapter.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-with-usb-adapter.jpg)

Furthermore, because the unit will draw power from standard USB ports, it can be connected to most [power banks](https://duckduckgo.com/?t=ffab&q=usb+power+bank&iax=images&ia=images) to create a mobile/remote ambient sensor.

[top](#){:.btn .btn--light-outline .btn--small}


# Overview of the main hardware components
## ESP-01
The **ESP-01** is a cheap and very small WiFi module developed by [Ai-Thinker](http://en.ai-thinker.com/) that is based on the ESP8266EX microcontroller unit (MCU) by [Espressif](https://www.espressif.com/):

[![ESP-01 top](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-top.png){:.PostImage .PostImage--large}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-top.png)

[![ESP-01 bottom](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-bottom.png){:.PostImage .PostImage--large}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-bottom.png)

[![ESP-01 dimensions and pinout](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-dimensions-pinout.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-dimensions-pinout.jpg)

[![ESP-01 schematics](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-schematics.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-schematics.jpg)

Of note, it **exposes only four GPIO pins** to interface with other devices--namely, `URXD`, `UTXD`, `IO2` and `IO0`--and it is powered via `3v3 DC` to the `VCC` and `GND` pins. Each of the eight exposed pins has specific functions, as suggested by their name:

<center>
<table>
   <thead>
      <th style="text-align: center;">Pin #</th>
      <th style="text-align: center;">Name</th>
      <th style="text-align: center;">Function</th>
   </thead>
   <tr>
      <td>1</td>
      <td>GND</td>
      <td>Ground</td>
   </tr>
   <tr>
      <td>2</td>
      <td>IO2</td>
      <td>GPIO 2, internal pull-up</td>
   </tr>
   <tr>
      <td>3</td>
      <td>IO0</td>
      <td>GPIO 0 (zero), internal pull-up</td>
   </tr>
   <tr>
      <td>4</td>
      <td>URXD</td>
      <td>UART0, serial RX data</td>
   </tr>
   <tr>
      <td>5</td>
      <td>3v3 / VCC</td>
      <td>3.3V power supply</td>
   </tr>
   <tr>
      <td>6</td>
      <td>RST / IO16</td>
      <td>Reset pin, active low</td>
   </tr>
   <tr>
      <td>7</td>
      <td>EN / CH_PD</td>
      <td>Chip enabled pin, active high</td>
   </tr>
   <tr>
      <td>8</td>
      <td>UTXD</td>
      <td>UART0, serial TX data</td>
   </tr>
</table>
</center>

In addition, there is no programmable ROM in the SoC, meaning that any software must be stored on the module's SPI flash.  Regarding the latter, there are actually three popular versions of the ESP-01 WiFi module that have the same format but differ in flash memory size or other minor specs:

1. **ESP-01 Blue**: The original version with `512KB` of flash memory;
2. **ESP-01 Black**: The original version with `1MB` of flash memory;
3. **ESP-01S**: A revised version with `1MB` of flash memory.

Fortunately, visual inspection of the module can easily indicate which version it is:

[![ESP-01 comparison 01](/assets/posts/2021-07-18-diy-tasmota-bme280/esp01-version-comparison-01.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp01-version-comparison-01.jpg)

[![ESP-01 comparison 02](/assets/posts/2021-07-18-diy-tasmota-bme280/esp01-version-comparison-02.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp01-version-comparison-02.jpg)

The external SPI flash can be changed for anything up to `16MB`.  However, this requires de/soldering very small components and such procedure won't be covered in this guide.  My recommendation is to simply look for the versions that have at least `1MB` of flash memory, which is just enough for the project described in this article.

For more information, refer to the official documentation:
- [ESP-01](https://docs.ai-thinker.com/_media/esp8266/docs/esp-01_product_specification_en.pdf)
- [ESP-01S](https://docs.ai-thinker.com/_media/esp8266/docs/esp-01s_product_specification_en.pdf)

In fact, Ai-Thinker has developed [many other versions of the ESP-01 module](https://docs.ai-thinker.com/en/%E8%A7%84%E6%A0%BC%E4%B9%A6), such as the [ESP-01E](https://docs.ai-thinker.com/_media/esp8266/docs/esp-01e_product_specification_en.pdf) and [ESP-01F](https://docs.ai-thinker.com/_media/esp8266/docs/esp-01f_product_specification_en.pdf). However, such modules differ in major aspects in comparison to the modules covered here, like format and connectivity, and for such a reason, they won't be covered in this article.  If interested, check their official e-commerce website at Alibaba.com ([https://ai-thinker.en.alibaba.com/](https://ai-thinker.en.alibaba.com/)) to learn how to acquire those less popular modules.
{:.notice--info }

## BME280
The **BME280** is a low-profile (`2.5 x 2.5 x 0.93 mm³`) and low-power (`3.6 mA` at roughly `3.3V`) environmental sensor developed by [Bosch Sensortec](https://www.bosch-sensortec.com). Specifically, this unit comes with high accuracy sensors for **temperature**, **humidity**, and **pressure**, all protected by a metal-lid.  Of note, it uses [I²C](https://en.wikipedia.org/wiki/I%C2%B2C) and [SPI](https://en.wikipedia.org/wiki/Serial_Peripheral_Interface) interfaces for data communication and is powered by `3v3 DC` (specifically, from `1.71V` to `3.6V`).

[![BME280 01 photo](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-01.png){:.PostImage .PostImage--large}](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-01.png)

[![BME280 02 dimensions](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-02.png){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-02.png)

Bosch Sensortec has made an amazing job at [documenting all aspects about this sensor](https://www.bosch-sensortec.com/products/environmental-sensors/humidity-sensors-bme280/#documents). For quick reference, here are the main docs:

- [Datasheet](https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bme280-ds002.pdf)
- [Handling, soldering and mounting instructions](https://www.bosch-sensortec.com/media/boschsensortec/downloads/handling_soldering_mounting_instructions/bst-bme280-hs006.pdf)

[top](#){:.btn .btn--light-outline .btn--small}


# Hardware
To make a single ESP-01 Tasmota environmental sensor, you will need the following items:

- 01x [ESP-01 Black/ESP-01S](https://www.amazon.com/s?k=esp-01+wifi+module): These modules are very cheap and useful for simple projects, so I recommend buying multiples at once.
  
  [![ESP-01 top](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-top.png){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/esp-01-top.png)

- 01x [USB to ESP-01 adapter](https://www.amazon.com/s?k=USB+to+ESP-01): Look for the ones that have **exposed pins** (see figure below) and preferably, that make use of the Silicon Labs [CP2104](https://www.silabs.com/documents/public/data-sheets/cp2104.pdf) (or [CP2102](https://www.silabs.com/documents/public/data-sheets/CP2102-9.pdf)) chip. More often than not, however, the adapters will make use of a cheaper and less well-documented chip--namely, a [CH340](https://www.mpja.com/download/35227cpdata.pdf) variation--which might actually work just as well.
  
  [![USB to ESP-01 CP2104 adapter 01](/assets/posts/2021-07-18-diy-tasmota-bme280/usb-to-esp01-cp2104-adapter-01.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/usb-to-esp01-cp2104-adapter-01.jpg)

  [![USB to ESP-01 CP2104 adapter 02](/assets/posts/2021-07-18-diy-tasmota-bme280/usb-to-esp01-cp2104-adapter-02.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/usb-to-esp01-cp2104-adapter-02.jpg)

  Notice how the exposed male pins are mapped to the female pins in your own adapter. This is fundamental to figuring out how to put the module into *flash mode* and later on, how to connect the ESP-01 module to the BME280 module.  The advantage of having exposed pins is that no soldering job is required to interface with the ESP-01 module.

- 01x [GY-BME280 module](https://www.amazon.com/s?k=GY-BME280): You can always [buy just the BME280 sensor itself](https://www.alibaba.com/trade/search?SearchText=bme280) and wire it on your own but it's *much* easier to buy a module that contains it instead. The one I used is the one shown in the figures below. More likely than not, you will need to solder the headers to the board (see below). As before, these modules are very cheap, so I recommend to buy multiples.
  
  [![BME280 module 01](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-module-01.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-module-01.jpg)

  [![BME280 module 02](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-module-02.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/bme280-module-02.jpg)

- 05x [Female-Female DuPont wires](https://www.amazon.com/s?k=female+dupont+wire): You cannot go wrong by buying lots of these wires in all three connector combinations.  For this project, however, you will only need five f-f jumpers (or four, if you reuse one).
  
  [![f-f dupont wires](/assets/posts/2021-07-18-diy-tasmota-bme280/female-dupont.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/female-dupont.jpg)

- *Optional.* [Female DuPont connector kit](https://www.amazon.com/s?k=female+dupont+connector+kit&ref=nb_sb_noss): This is optional but does help securing your connections and make your project look better by housing exposed male pins. I recommend buying a kit with various sizes but for this project, we will only need the following connectors:

  - 01x `2x4` female connector for the ESP-01 USB adapter
  
    [![dupont connector 2x4](/assets/posts/2021-07-18-diy-tasmota-bme280/dupont-connector-2x4.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/dupont-connector-2x4.jpg)
  
  - 01x `1x4` female connector for the BME280 module

    [![dupont connector 1x4](/assets/posts/2021-07-18-diy-tasmota-bme280/dupont-connector-1x4.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/dupont-connector-1x4.jpg)

    You **do not** need crimping tools for this. Check the following video for this and other tricks when working with DuPont wires: 
    
    {% include video id="eI3fxTH6f6I" provider="youtube" %}

- [Basic soldering kit](https://www.amazon.com/s?k=soldering+kit): This is only required for soldering the headers to the BME280 module. You **do not** need anything fancy for this at all. If you have a multimeter, always test your connections afterwards.
  
  [![soldering kit](/assets/posts/2021-07-18-diy-tasmota-bme280/soldering-kit.jpg){:.PostImage}](/assets/posts/2021-07-18-diy-tasmota-bme280/soldering-kit.jpg)

## Estimated cost
Estimated cost of the basic hardware components:

<center>
<table>
   <thead>
      <th style="text-align: center;">Hardware</th>
      <th style="text-align: center;">Quantity</th>
      <th style="text-align: center;">USD$*</th>
   </thead>
   <tr>
      <td>ESP-01 WiFi module</td>
      <td>01</td>
      <td>1.5</td>
   </tr>
   <tr>
      <td>USB to ESP-01 adapter (CP2104)</td>
      <td>01</td>
      <td>2.5</td>
   </tr>
   <tr>
      <td>GY-BME280 module</td>
      <td>01</td>
      <td>1.5</td>
   </tr>
   <tr>
      <td>F-F DuPont 20CM long</td>
      <td>05</td>
      <td>0.05</td>
   </tr>
   <tr>
      <td><b>TOTAL</b></td>
      <td><b>-</b></td>
      <td><b>5.55</b></td>
   </tr>
</table>
</center>

\* Based on [AliExpress.com](https://www.aliexpress.com) offers from Chinese stores **without** including shipping + tax
{: .notice--info }

[top](#){:.btn .btn--light-outline .btn--small}


# Software
In this tutorial, we will make use of the following applications:

- [Tasmota](https://github.com/arendst/Tasmota) (`tasmota-sensors.bin`)
  > Alternative firmware for ESP8266 and ESP32 based devices with easy configuration using webUI, OTA updates, automation using timers or rules, expandability and entirely local control over MQTT, HTTP, Serial or KNX.

- [Esptool](https://github.com/espressif/esptool) (`esptool.py`)
  > A Python-based, open source, platform independent, utility to communicate with the ROM bootloader in Espressif ESP8266 & ESP32 series chips.

[top](#){:.btn .btn--light-outline .btn--small}


# Assembly
As in the previous tutorials, this article assumes you are running a **Linux** distribution (e.g., Debian, Ubuntu, Arch, etc.). The instructions may or may not be compatible with Android, macOS, Windows, or any other Operating System (OS). If you run into issues, please refer to the official documentation of the software mentioned in the [Software](#software) section.

- install esptool
- connect esp01 to adapter
- check flash size
- put device into flash mode (ground gpio0)
- download tasmota-sensors.bin
- flash to device
- remove flash mode
- restart device

- basic tasmota config
  - template
  - time
  - mqtt
  - discovery

- disconnect device
- wire BME280 module do the adapter
- connect device
- configure template
  - SDA and SDC pins
- restart device

- done

[top](#){:.btn .btn--light-outline .btn--small}


# Home assistant integration
*Describe Discovery and MQTT broker setup and HASS configuration*

[top](#){:.btn .btn--light-outline .btn--small}


# Conclusion
*Final remarks about the unit and its usage*

[top](#){:.btn .btn--light-outline .btn--small}


# TODO
- ~~Overview of the ESP01~~
- ~~Motivation for making the sensor~~
- ~~Overview of the ESP-01~~
- ~~Overview of the BME280~~
- ~~Hardware~~
   1. ~~ESP01 Black or ESP-01S~~
   2. ~~BME280 module~~
   3. ~~USB adapter for the ESP01 with exposed pins (add pinout)~~
   4. ~~Female-female jumper wires~~
   5. ~~Soldering stuff for the BME280 module (depends on module)~~
- Software
   1. Tasmota sensor binary (includes I2C sensor support)
   2. Template for the ESP-01
- Assembly
   1. Flashing + wiring (grounding GPIO0)
   2. Wiring for BME280 modules
   3. Tasmota configuration for I2C
- Home Assistant Integration
   1. MQTT
      1. Auto
      2. Manual
- Conclusion
- Review article

[top](#){:.btn .btn--light-outline .btn--small}
