---
title: "Youtube live-streams as IPTV channels for TVHeadend"
date: 2020-05-07
tags: github iptv kodi streamlink tvheadend youtube
---
<b>- Update tracker -</b><br /><div><i>May 19th, 2020 - </i>Added info about TVH m3u re-fetch period and youtube4tvh cronjob for streams that change very often.<br /></div><div><i>May 14th, 2020 - </i>Added more info about streamlink install and outdated versions; fixed a few typos. <br /></div><div><br /></div><div><br /></div><div><font size="4"><b>Introduction</b></font></div><div>
In this guide, we will learn how to feed Youtube live-streams into a TVHeadend (TVH) server as IPTV channels.&nbsp; This is a fairly advanced guide but I'll try my best to make it as digestible as possible to any individual with minimal knowledge about selfhosting.&nbsp; You will need a <b>Linux distro</b> (e.g., Debian, Ubuntu) to follow this guide.&nbsp; All the software described here is <b>free</b> and <b>open-source</b>.</div>
<br />
The guide is divided into eight sections:<br />
<br />
1. <a href="#motivation">Motivation</a><br />
2. <a href="#objectives">Objectives</a><br />
3. <a href="#clientserverlayout">Client-server layout</a>&nbsp; <br />
4. <a href="#youtube4tvh">Youtube4tvh</a><br />
5. <a href="#streamlink">Streamlink </a><br />
6. <a href="#tvhserver">TVH server</a><br />
7. <a href="#tvhclient">TVH client</a><br />
8. <a href="#conclusion">Conclusion</a><br />
<br />
I'm not an expert in any of the topics mentioned here.&nbsp; If you have suggestions on how to improve something, please leave a comment below stating what could be changed and why it should be changed.<br />
<br />
Youtube4tvh is a utility program I wrote just for this guide.&nbsp; I welcome anyone who wants to improve it or fork into something more abstract.&nbsp; If that sounds like something you want to do, please head to github (<a href="https://github.com/cgomesu/youtube4tvh">https://github.com/cgomesu/youtube4tvh</a>) and hit me up once you've done some coding. <br />
<br />
<br />
<span style="font-size: large;"><b><a id="motivation" name="motivation">1. Motivation</a> </b></span><br />
There are multiple reasons to watch Youtube live-streams as if they were IPTV channels.&nbsp; Here are a reasons few that come to mind right now:<br />
<ul>
<li>It's free and all programs are open-source; </li>
<li>There is at least one Youtube 24/7 live-stream that you enjoy. Some of my personal favorites, per category:&nbsp;</li>
<ul>
<li>News: <a href="https://www.youtube.com/user/NewsOnABC" target="_blank">ABC News AU</a>, <a href="https://www.youtube.com/user/skynews" target="_blank">Sky News</a>, <a href="https://www.youtube.com/user/deutschewelleenglish" target="_blank">DW in English</a>, <a href="https://www.youtube.com/user/france24english" target="_blank">France 24 in English</a></li>
<li>Space: <a href="https://www.youtube.com/user/NASAtelevision" target="_blank">NASA TV</a>, <a href="https://www.youtube.com/channel/UCakgsb0w7QB0VHdnCc-OVEA" target="_blank">Space Videos</a>, <a href="https://www.youtube.com/channel/UC9pYOJPB5UYlMlGKKZWo-Bw" target="_blank">Space &amp; The Universe HD</a></li>
<li>Webcam - Nature: <a href="https://www.youtube.com/channel/UCZXZQxS3d6NpR-eH_gdDwYA" target="_blank">Cornell Lab of Ornithology Cams</a>, <a href="https://www.youtube.com/user/MontereyBayAquarium" target="_blank">Monterey Bay Aquarium</a>, <a href="https://www.youtube.com/channel/UCSyg9cb3Iq-NtlbxqNB9wGw" target="_blank">Explore Oceans</a>, <a href="https://www.youtube.com/channel/UC-2KSeUU5SMCX6XLRD-AEvw" target="_blank">Explore Nature</a>, <a href="https://www.youtube.com/channel/UCi3T_esus8Sr9I-3W5teVQQ" target="_blank">Volcanoverse </a></li>
<li>Webcam - Other: <a href="https://www.youtube.com/channel/UCOIkT9bq-1N2BvrsBjhNlag" target="_blank">Virtual Railfan</a>, <a href="https://www.youtube.com/user/earthTV" target="_blank">earthTV</a>, <a href="https://www.youtube.com/channel/UCMpn1qLudF-zb4M4bqxLIbw" target="_blank">I Love You Venice</a>, </li>
<li>Radio:&nbsp; <a href="https://www.youtube.com/user/bgmchannelbgm" target="_blank">BGM channel</a>, <a href="https://www.youtube.com/user/cafedelmar" target="_blank">Cafe del Mar</a>, <a href="https://www.youtube.com/user/stayseemusic" target="_blank">Stay See</a></li>
</ul>
</ul>
<ul>
<li>You want to make selected Youtube live-streams available as IPTV channels through a TVH server (TVH -&gt; Streamlink pipe -&gt; Youtube); </li>
<li>You want to keep your streaming services as centralized as possible.&nbsp; That is, instead of multiple apps, you can manage all of them using a single application (TVH);</li>
<li>You want to take advantage of one of the fastest and most reliable media delivery networks out there (Youtube's CDN);</li><li>You dislike Youtube ads (Streamlink will get rid of them without the need to install any filtering system);</li><li>You like how it looks for the client:</li></ul><div style="text-align: center;"><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube-nocookie.com/embed/9FSPf5wISUY" width="560"></iframe><br /></div>

<div><br /></div><div><br /></div>
<span class="flex-auto mb-2"><span class="text-gray-dark mr-2"><a id="objectives" name="objectives"><span style="font-size: large;"><b>2. Objectives</b></span></a> </span></span><br />
<span class="flex-auto mb-2"><span class="text-gray-dark mr-2">By the end of the guide, you'll have learned how to do the following:</span></span><br />
<ul><li>Create a customized Youtube live-stream
m3u playlist with the help of youtube4tvh; </li><li>Install a TVH server on a Linux machine;</li><li>Install Streamlink (https://streamlink.github.io) to pipe live-stream data into a TVH server;</li><li>Add a Youtube live-stream m3u playlist to a TVH server as an IPTV auto network;</li><li>Configure a TVH server to auto-map muxes to channels using bouquets;</li><li>Create a cronjob to automatically update the Youtube live-stream m3u playlist every day at 6am.</li></ul><div><br /></div><div><br /></div>
<span style="font-size: large;"><a id="clientserverlayout" name="clientserverlayout"><b>3. Client-server layout</b></a> </span><br />
There are three main components to this setup, namely <b>TVH</b>, <b>Streamlink</b>, and <b>youtube4tvh</b>, which are all open-source and free:<br />
<br />
- <b>TVHeadend</b> (<a href="https://github.com/tvheadend/tvheadend">https://github.com/tvheadend/tvheadend</a>): <span class="text-gray-dark mr-2">Tvheadend is a TV 
streaming server for Linux supporting DVB-S, DVB-S2, DVB-C, DVB-T, ATSC,
 IPTV, SAT&gt;IP and other formats through the unix pipe as input sources.</span><br />
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-_ute9lktZgM/XrGOMVJSDWI/AAAAAAAABYo/Bp1w9A8GEWUT1K7Q9j8GKJLAff8EZ1ZCwCEwYBhgL/s1600/tvh_github_front.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="876" data-original-width="1243" height="225" src="https://1.bp.blogspot.com/-_ute9lktZgM/XrGOMVJSDWI/AAAAAAAABYo/Bp1w9A8GEWUT1K7Q9j8GKJLAff8EZ1ZCwCEwYBhgL/s320/tvh_github_front.png" width="320" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">TVH Github</td></tr>
</tbody></table>
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-zqIz7kT7Ir8/XrGPUu7BflI/AAAAAAAABY0/dfEWu_DsjhsM02fAq1inAsEvywLfQ5t1QCNcBGAsYHQ/s1600/tvh_webui_channels.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="900" data-original-width="1600" height="180" src="https://1.bp.blogspot.com/-zqIz7kT7Ir8/XrGPUu7BflI/AAAAAAAABY0/dfEWu_DsjhsM02fAq1inAsEvywLfQ5t1QCNcBGAsYHQ/s320/tvh_webui_channels.png" width="320" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">WebUI</td></tr>
</tbody></table>
<div class="separator" style="clear: both; text-align: center;">
<br /></div>
<br />
- <b>Streamlink</b> (<a href="https://github.com/streamlink/streamlink">https://github.com/streamlink/streamlink</a>): <span class="text-gray-dark mr-2">Streamlink is a CLI utility which pipes video streams from various services into a video player.</span><br />
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-0_NUjHhKTSM/XrGOMRMfrEI/AAAAAAAABYg/lwPtu4Q4eC86LxzC0MOBjujiMKAnoqs-wCEwYBhgL/s1600/streamlink_github_front.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="878" data-original-width="1255" height="223" src="https://1.bp.blogspot.com/-0_NUjHhKTSM/XrGOMRMfrEI/AAAAAAAABYg/lwPtu4Q4eC86LxzC0MOBjujiMKAnoqs-wCEwYBhgL/s320/streamlink_github_front.png" width="320" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">Streamlink Github</td></tr>
</tbody></table>
<span class="text-gray-dark mr-2">&nbsp;</span> <br />
- <b>youtube4tvh</b> (<a href="https://github.com/cgomesu/youtube4tvh">https://github.com/cgomesu/youtube4tvh</a>): <span class="flex-auto mb-2"><span class="text-gray-dark mr-2">Youtube4tvh
 is a Python CLI program that uses Youtube API to create (or update) m3u
 playlists of live-streams that are piped into a TVH server via 
Streamlink.&nbsp;</span></span><br />
<div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-gBCFFy5hQS8/XrGOMOs5qmI/AAAAAAAABYk/JQRfD5SmlWoary4SX_rODeCgXRpIoiT6wCK4BGAsYHg/youtube4tvh_github_front.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="872" data-original-width="1292" src="https://1.bp.blogspot.com/-gBCFFy5hQS8/XrGOMOs5qmI/AAAAAAAABYk/JQRfD5SmlWoary4SX_rODeCgXRpIoiT6wCK4BGAsYHg/s320/youtube4tvh_github_front.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">youtube4tvh Github<br /></td></tr></tbody></table><div><br /></div><div><br /></div><div><span class="flex-auto mb-2"><span class="text-gray-dark mr-2">For this guide, we will assume that such components are related to each other and any clients (any IPTV players, such as VLC, Plex or a Kodi PVR) according to the following layout:</span></span></div>
<span class="flex-auto mb-2"><span class="text-gray-dark mr-2"><br /></span></span>
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-ir6K0zJDeUA/XrGkNGgQ6RI/AAAAAAAABZA/RFsB4RuO8vUL3QES8upgLGff-FNMUWgCQCNcBGAsYHQ/s1600/tvh_layout.jpg" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="456" data-original-width="713" height="204" src="https://1.bp.blogspot.com/-ir6K0zJDeUA/XrGkNGgQ6RI/AAAAAAAABZA/RFsB4RuO8vUL3QES8upgLGff-FNMUWgCQCNcBGAsYHQ/s320/tvh_layout.jpg" width="320" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">Client-server layout</td></tr>
</tbody></table>
<span class="flex-auto mb-2"><span class="text-gray-dark mr-2"><br /></span></span>
<span class="flex-auto mb-2"><span class="text-gray-dark mr-2"><br /></span></span>
<span class="flex-auto mb-2"><span class="text-gray-dark mr-2">However, once you're done with the initial configuration, you can try changing it to accomodate your needs.&nbsp; For example, you can multicast a live-stream to a TVH server using VLC (<a href="https://tvheadend.org/projects/tvheadend/wiki/VLC_Multicasting">https://tvheadend.org/projects/tvheadend/wiki/VLC_Multicasting</a>).&nbsp; This will let you use a single connection to Youtube be distributed to multiple clients, instead of creating multiple connections to Youtube--definitely take a look at it if you're serving a large number of clients with your TVH server.&nbsp; Also, you might want to pipe the Streamlink data to FFMPEG before sending to TVH, which will let you set custom AV codecs.&nbsp; </span></span><br />

<br />
<br />
<a id="youtube4tvh" name="youtube4tvh"><span style="font-size: large;"><b>4. Youtube4tvh</b></span></a><br />
This is a utility program that will let us create and manage m3u playlist of Youtube live-streams.&nbsp; It uses Youtube API, so we'll need to create one (or more) to use it before anything else.&nbsp; APIs have daily quotas that this program will reach fairly quickly.&nbsp; Fortunately, those quotas are <i>per project</i>, and you should be able to create multiple projects with a free account.&nbsp; For more info, checkout the github page: <a href="https://github.com/cgomesu/youtube4tvh" target="_blank">https://github.com/cgomesu/youtube4tvh</a>.<br />
<br />
<b>4.1 Create a Youtube API v3</b><br /><div>
You can find instructions on the official page (<a href="https://developers.google.com/youtube/v3/getting-started" target="_blank">https://developers.google.com/youtube/v3/getting-started</a>).&nbsp; (Don't follow that video though. It's outdated as fuck.)&nbsp; If you don't want to head there, here is a streamlined version:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Sing up for or Log into your Google account</span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"># Go to your API dashboard (<a href="https://console.developers.google.com/apis/" target="_blank">https://console.developers.google.com/apis/</a>)</span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"># Create a project (top left &gt; new project)</span><br /></div><br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://1.bp.blogspot.com/-R-QxzI50PSM/XrG9CM1oMbI/AAAAAAAABZM/FDF302FBLOwWw-6Ddd6M8vBGxsBQTxwygCNcBGAsYHQ/s1600/youtubeapi_newproject.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="788" data-original-width="1600" height="98" src="https://1.bp.blogspot.com/-R-QxzI50PSM/XrG9CM1oMbI/AAAAAAAABZM/FDF302FBLOwWw-6Ddd6M8vBGxsBQTxwygCNcBGAsYHQ/s200/youtubeapi_newproject.png" width="200" /></a></div>
<div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Give the project a name and create it (this should take a few seconds...)</span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"></span></div><div><span style="font-family: &quot;courier&quot;;"># Select the project you just created and in the dashboard,</span></div><div><span style="font-family: &quot;courier&quot;;"># go to '+ Enable APIs and Services'</span></div><div><br />
</div><div class="separator" style="clear: both; text-align: center;">
<a href="https://1.bp.blogspot.com/-v0g5lipXau0/XrG-DsCyuVI/AAAAAAAABZU/ZeVpnsY_M9AKM5pX93fcC1umKTV9di1_QCNcBGAsYHQ/s1600/youtubeapi_enableapi.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="827" data-original-width="1600" height="103" src="https://1.bp.blogspot.com/-v0g5lipXau0/XrG-DsCyuVI/AAAAAAAABZU/ZeVpnsY_M9AKM5pX93fcC1umKTV9di1_QCNcBGAsYHQ/s200/youtubeapi_enableapi.png" width="200" /></a></div>
<br />
<div></div><div><span style="font-family: &quot;courier&quot;;"># Search for Youtube Data API v3 and enable it.&nbsp; <br /></span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"># It should redirect you to its dashboard but if doesn't, select Manage</span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"></span></div><div><span style="font-family: &quot;courier&quot;;"># Select Create Credentials (if you don't see a button, <br /></span></div><div><span style="font-family: &quot;courier&quot;;"># just go to Credentials in the side menu)</span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"></span></div><div><span style="font-family: &quot;courier&quot;;"># It's going to ask you which API you're going to use (select Youtube Data API v3),</span></div><div><span style="font-family: &quot;courier&quot;;"># where you'll be calling it from (Other UI) and what data (Public data). <br /></span></div><div><span style="font-family: &quot;courier&quot;;"># Then select 'What credentials do I need?' and it will generate an unrestricted <br /></span></div><div><span style="font-family: &quot;courier&quot;;"># API for the project you created.</span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"></span></div><div><span style="font-family: &quot;courier&quot;;"># In the side menu, go to Credentials and Edit the API Key you generated<br /></span></div><div><br /><span style="font-family: &quot;courier&quot;;"></span></div><div><span style="font-family: &quot;courier&quot;;"></span></div><div><span style="font-family: &quot;courier&quot;;"># Under 'API restrictions', select Restrict key &gt; Youtube Data API v3 &gt; Save</span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"></span></div><div><span style="font-family: &quot;courier&quot;;"><span style="font-family: &quot;verdana&quot;;">That's it! Your key is that long string with random letters and numbers in the column labeled Key (blurred in the figure below). Whenever you see a field to YOURKEY, use that one.&nbsp; Also, you can repeat this process to generate additional keys.&nbsp; It's a good idea to do so. </span><br /></span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div class="separator" style="clear: both; text-align: center;">
<a href="https://1.bp.blogspot.com/-QWYvTwv7erw/XrHDdzFiT-I/AAAAAAAABZg/pHuM-S46tq8kI0YCmq9LZ_H0p0vIXXTOACNcBGAsYHQ/s1600/youtubeapi_goodapi.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="783" data-original-width="1600" height="97" src="https://1.bp.blogspot.com/-QWYvTwv7erw/XrHDdzFiT-I/AAAAAAAABZg/pHuM-S46tq8kI0YCmq9LZ_H0p0vIXXTOACNcBGAsYHQ/s200/youtubeapi_goodapi.png" width="200" /><br /></a></div><div class="separator" style="clear: both; text-align: center;"><br /><a href="https://1.bp.blogspot.com/-QWYvTwv7erw/XrHDdzFiT-I/AAAAAAAABZg/pHuM-S46tq8kI0YCmq9LZ_H0p0vIXXTOACNcBGAsYHQ/s1600/youtubeapi_goodapi.png" style="margin-left: 1em; margin-right: 1em;"></a></div><b>4.2 Install youtube4tvh</b><br /><div>Open a terminal window and run the following<br /><span style="font-family: &quot;courier&quot;;">sudo apt update<br />sudo apt install git python-pip<br />cd /opt<br />sudo git clone https://github.com/cgomesu/youtube4tvh.git<br />cd youtube4tvh<br /></span></div><div><br /></div><div>Install required packages via pip<br /><span style="font-family: &quot;courier&quot;;">pip install .</span><br /></div><div><br /></div><div>Test the program (change YOURKEY for your API key)<br /><span style="font-family: &quot;courier&quot;;">cd youtube4tvh<br />python main.py --apikey=YOURKEY --channelname="DW News"</span></div><div><br /></div><div>Now, there should be an output.m3u file on the same folder you are (you can 'ls' to list files).<br /></div><div><br /></div><div>If you run into permission issues, make sure to use a user with sudo perission.&nbsp; Also, if your user is not allowed to write to /opt, then run the follwing (changing YOURSER for your sudo username):<br /><span style="font-family: &quot;courier&quot;;">sudo chown -R YOURUSER:sudo /opt/youtube4tvh</span></div><div><br /></div><div>If everything looks good, go ahead and add permission to execute the streamlink.sh helper script that will pipe data into TVH (if you want to change settings from streamlink, change them in the streamlink.sh file):</div><div><span style="font-family: &quot;courier&quot;;">sudo chmod +x /opt/youtube4tvh/streamlink.sh</span></div><div><br /></div><div>Done!</div><div><br /></div><b>4.3 Basic usage</b><br /><div></div><div>(If you don't feel like reading this, please refer to the <a href="https://github.com/cgomesu/youtube4tvh/blob/master/README.md" target="_blank">README.md</a> in the Github page.) <br /></div><div><br /></div><div>This program has two modes of execution, '<b>add</b>' and '<b>update</b>'. The '--mode=add' is the default mode and it will create an m3u file if you don't specify one.&nbsp; However, if you do provide an '--m3uinput=/path/to/file.m3u', it will instead append channels to output.m3u. (If --m3uinput and --m3uoutput are the same, then it appends to itself).&nbsp; <br /></div><div><br /></div><div>The '--mode=update' will parse an '--m3uinput=/path/to/file.m3u' and update all URLs to make sure they are the ones currently available (instead of a broken URL).&nbsp; This is useful because even though some Youtube channels stream 24/7, they will at times stop and restart the stream, which will cause Youtube to generate a new URL to their live-stream.&nbsp; The '--mode=update' will make sure your output.m3u is always using the correct URLs.&nbsp; (Again, if you want to update the same input file, then point both --m3uinput and --m3uoutput to the same m3u file.)<br /></div><div><br /></div><div>First, we will generate a youtube.m3u file with the channel "DW News".&nbsp; Afterwards, we will append a couple of additional channels to the youtube.m3u file.&nbsp; Then, we will create a cronjob to keep our youtube.m3u up-to-date.<br /></div>
<br /><div>
4.3.1 Create youtube.m3u file and add the channel "DW News" (change YOURKEY to your actual API key)<br /></div><div><span style="font-family: &quot;courier&quot;;">cd /opt/youtube4tvh/youtube4tvh<br /></span></div><div><span style="font-family: &quot;courier&quot;;">python main.py --apikey=YOURKEY --m3uoutput=youtube.m3u --channelname="DW News"</span></div><div><br /></div><div>4.3.2 Append the channel "France 24 English" to the youtube.m3u file</div><div><span style="font-family: &quot;courier&quot;;">python main.py --apikey=YOURKEY --m3uinput=youtube.m3u --m3uoutput=youtube.m3u --channelname="France 24 English"</span><br /></div><div><br /></div><div>4.3.3 Append the channel "Explore Nature" to the youtube.m3u file</div><div><span style="font-family: &quot;courier&quot;;">python main.py --apikey=YOURKEY --m3uinput=youtube.m3u --m3uoutput=youtube.m3u --channelname="Explore Nature"</span><br /></div><div><br /></div><div>4.3.4 Create a cronjob to update the youtube.m3u file everyday at 6am (make sure the paths are correct first!)<br /></div><div><span style="font-family: &quot;courier&quot;;"># First, make a backup or your youtube.m3u file</span></div><div><span style="font-family: &quot;courier&quot;;">cp /opt/youtube4tvh/youtube4tvh/youtube.m3u /opt/youtube4tvh/youtube4tvh/youtube.m3u.backup<br /></span></div><div><span style="font-family: &quot;courier&quot;;"># Create a cronjob<br /></span></div><div><span style="font-family: &quot;courier&quot;;">crontab -e</span></div><div><span style="font-family: &quot;courier&quot;;"># Add the following at the bottom<br /></span></div><div><span style="font-family: &quot;courier&quot;;">0 6 * * * /usr/bin/python /opt/youtube4tvh/youtube4tvh/main.py --apikey=YOURKEY --m3uinput=</span><span style="font-family: &quot;courier&quot;;"><span style="font-family: &quot;courier&quot;;">/opt/youtube4tvh/youtube4tvh/</span>youtube.m3u --m3uoutput=</span><span style="font-family: &quot;courier&quot;;"><span style="font-family: &quot;courier&quot;;">/opt/youtube4tvh/youtube4tvh/</span>youtube.m3u --mode=update</span></div><div><span style="font-family: &quot;courier&quot;;"># Save and exit (ctrl+x)</span><br /></div>
<br /><div>
That's all we need to do with this program.&nbsp; If you ever feel like adding a new channel to the playlist, you can just repeat the "Append" examples with the new channel instead.&nbsp; <br /></div><div><br /></div><div>If you want to remove a channel, you'll need to manually edit the youtube.m3u file (remove the channel's #EXTINF row and the one immediately below it, which contains the pipe command).&nbsp; You can also manually edit the m3u file to add a group-title to the channels (see sample/input.m3u, for example), change their order, etc.&nbsp; Just use your favorite text editor to do that and when you're done, save preserving the .m3u extension.</div><div><br /></div><div><b>4.4 Recommendations</b><br /></div>
<div>Theoretically, the m3u playlists can contain as many streams as you want.&nbsp; However, as a general rule of thumb, I find it useful to create one m3u playlist for <i>each type of streaming channel</i>--for example, youtube-webcams.m3u, youtube-news.m3u, youtube-radio.m3u, and etc--and then have a unique API key for each of them.&nbsp; This way, I can run the youtube4tvh cronjob more often, thus reducing the chance of having broken URLs in the m3u file.<br /></div><div><br /></div><div><br /></div><div><a id="streamlink" name="streamlink"><font size="4"><b>5. Streamlink</b></font></a><br /></div><div>Streamlink is an awesome utility program and if you've never used it before, make sure to check their documentation at <a href="https://streamlink.github.io/" target="_blank">https://streamlink.github.io/</a>.&nbsp; Here, we will only use it to pipe data from Youtube to a TVH server but Streamlink is able to pipe video streams from many other platforms (Twitch, Dailymotion, etc.).&nbsp; <br /></div><div><br /></div><div>To install Streamlink, please follow the instructions on the official website: <a href="https://streamlink.github.io/install.html" target="_blank">https://streamlink.github.io/install.html</a>.&nbsp; Make sure you're running the latest version afterwards.&nbsp; You can find the installed version by running 'streamlink --version', which should be the same one as the latest version on their Releases page (<a href="https://github.com/streamlink/streamlink/releases" target="_blank">https://github.com/streamlink/streamlink/releases</a>). <br /></div><div><br /></div><div>(It looks like multiple repos are distributing a much older version than the 1.4.1, which is the latest when this article was first posted.&nbsp; If that's the case for your distro, take a look at the PyPi and source installation on their Install page.&nbsp; Uninstall the older version and install via pip and if that doesn't work, try cloning their git repo and install via setup-tools, very much like the youtube4tvh utility.)<br /></div><div><br /></div><div>In <span style="font-family: &quot;courier&quot;;">/opt/youtube4tvh</span>, you'll notice a file called <span style="font-family: &quot;courier&quot;;">streamlink.sh</span>.&nbsp; That is a <b>helper script</b> that TVH will use to get the video stream from a Youtube URL.&nbsp; If you open it with a text editor, you'll see the follwoing:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;">#!/bin/bash<br />####################################################<br />################ Streamlink script #################<br />####################################################<br /># The default version writes the data from the best<br /># stream ($1, the first argument) to stdout using a<br /># thread pool of size 2 to download HLS segments.<br /># Everything else follows default values.<br />#<br /># Inspired by niwi_niwi's post at<br /># https://tvheadend.org/boards/5/topics/35658<br />#<br /># More info: https://streamlink.github.io/cli.html<br />#<br />####################################################<br />#### Add/modify script according to your needs #####<br />streamlink \<br />--stdout \<br />--hls-segment-threads 4 \<br />--hls-live-edge 10 \<br />"$1" best</span><br /></div><div><br /></div><div>The actual command to execute streamlink and its options are all at the bottom.&nbsp; If you know what you're doing and want to play with different configurations, go ahead and change the arguments in the streamlink command.&nbsp; Say, if instead of playing always the 'best' stream you want to play the 480p version, then just change it to that (but always leave --stdout or you won't be able to pipe data to TVH).&nbsp; Once again, check the docs for a comprehensive list of options (<a href="https://streamlink.github.io/cli.html" target="_blank">https://streamlink.github.io/cli.html</a>).&nbsp; <br /></div><div><br /></div><div>To test the script, you can simply execute the following (change YOUTUBEURL for the URL of a Youtube live-stream):</div><div><br /></div><div><font face="courier">bash streamlink.sh YOUTUBEURL</font><br /></div><div><br /></div><div>You should see a whole bunch random characters as streamlink outputs the video stream to the terminal.&nbsp; Hit ctrl+c to terminate the process.&nbsp; If you have a player, you can run the command above with a pipe to the player.&nbsp; Using VLC (<a href="https://github.com/videolan/vlc" target="_blank">https://github.com/videolan/vlc</a>), for example:<br /></div><div><br /></div><div><font face="courier">bash streamlink.sh YOUTUBEURL | vlc -<br /></font></div><div><br /></div><div><br /></div><div><a id="tvhserver" name="tvhserver"><font size="4"><b>6. TVH server</b></font></a></div><div>TVH was a game-changer for me.&nbsp; It offers a centralized system to manage multiple IPTV networks and TV tuners.&nbsp; I can fully customize how all channels will show up to all my clients and that's so much better than using multiple (and sometimes shady) applications developed by each IPTV provider.&nbsp; If a channel is down, I can tell TVH to automatically remove it or remap to another provider.&nbsp; If the EPG is not working, I can tell TVH to fetch from another source.&nbsp; If a client does not support a particular type of codec, I can create a profile that uses the codec that works with it.&nbsp; And all those changes are automatically applied to all clients, without the need to change one by one, because they are all getting data from my TVH server instead of external sources.&nbsp; (It's the TVH server that should always do that latter.)&nbsp; <br /></div><div><br /></div><div><b>6.1 Installation</b><br /></div><div>To install a TVH server, please follow the instructions on the official website: <a href="https://tvheadend.org/projects/tvheadend/wiki/Download" target="_blank">https://tvheadend.org/projects/tvheadend/wiki/Download</a>.&nbsp; I strongly suggest you to install from the repo to make it easy to update with a simple <span style="font-family: &quot;courier&quot;;">apt update</span> command.&nbsp; Also, make sure you're running the latest version of it afterwards.<br /></div><div><br /></div><div><b>6.2 Basic Configuration</b><br /></div><div>After installing TVH, head to the webUI on <a href="http://localhost:9981" target="_blank">http://localhost:9981</a>.&nbsp; (If you're not running a desktop environment on the same machine, access it from another machine on the same network and change localhost for the IP of the machine running the TVH server.&nbsp; Also, it goes without saying that the machine hosting the TVH server should have a fixed IP address at the local network because all the clients will be pointing to it.)&nbsp; <br /></div><div><br /></div><div>If you provided admin credentials for TVH during the installation, it will ask you to identify yourself now.&nbsp; <br /></div><div><br /></div><div>TVH will start the wizard the first time you access the webUI but you can just skip it (hit Cancel).</div><div><br /></div><div>Notice that there are several tabs in the webUI but many options will not show up if the "View level" is set to Basic, so let's change the default to <b>Expert</b>:&nbsp;</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Configuration &gt; General &gt; Base &gt; Server &gt; Set "User interface level" to Expert and hit Save</span><br /></div><div><br /></div><div>Now, let's configure the Stream profiles to restart on error:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Configuration &gt; Stream &gt; Stream profiles &gt; htsp &gt; Check "restart on error" hit Save</span><br /></div><div><br /></div><div>(You can repeat that step to all profiles that you're going to use.&nbsp; I usually just use htsp for clients and pass for auto-recording.)</div><div><br /></div><div>While we're at it, let's go ahead and customize the Recording settings as well.&nbsp; This is all really up to your own preferences but this is what I use that is different from the default configuration:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Configuration &gt; Recording &gt; DVR Profiles &gt; Default profile <br /></span></div><div><span style="font-family: &quot;courier&quot;;"># DVR file retention: 3 days</span></div><div><span style="font-family: &quot;courier&quot;;"># Pre-recording padding: 5 mins</span></div><div><span style="font-family: &quot;courier&quot;;"># Post-recording padding: 5 mins</span></div><div><span style="font-family: &quot;courier&quot;;"># Recording system path: /path/to/my/NAS/media/iptv/recording</span></div><div><span style="font-family: &quot;courier&quot;;"># Maintain free storage space in MiB: 5000</span></div><div><span style="font-family: &quot;courier&quot;;"># File permissions: 0777</span></div><div><span style="font-family: &quot;courier&quot;;"># Filename character set: UTF-8</span></div><div><span style="font-family: &quot;courier&quot;;"># Skip commercials: Unchecked</span></div><div><span style="font-family: &quot;courier&quot;;"># Format string: $c/$t - $c - %F - %R$n.$x</span></div><div><span style="font-family: &quot;courier&quot;;"># Directory permissions: 0777</span></div><div><span style="font-family: &quot;courier&quot;;"># Make subdirectories per channel: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Include date in filename: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Include time in filename: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Remove all unsafe characters from filename: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Hit Save<br /></span></div><div><br /></div><div>We're done with the basic configuration!&nbsp; Before moving to the next section, notice that at the bottom of the webUI there's a bar called "<b>Tvheadend log</b>" and on the opposite side, there is a button.&nbsp; Click on it to open the log.&nbsp; This is very useful to check if there's any error while you're making changes to the server.&nbsp; Keep it open as you change the settings and if you see an error, there's probably something misconfigured that you should fix before moving on.&nbsp; <br /></div><div><br /></div><div><b>6.3 Adding the youtube.m3u playlist as an IPTV automatic network to the TVH server</b><br /></div><div>We're now going to create an IPTV network using the youtube.m3u file we created with youtube4tvh.&nbsp; Open the TVH webUI and do the following:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Configuration &gt; DVB Inputs &gt; Networks &gt; Add</span></div><div><span style="font-family: &quot;courier&quot;;"># Type: IPTV automatic network</span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"><span style="font-family: &quot;verdana&quot;;">This will redirect to IPTV settings.&nbsp; Change the following:</span><br /></span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"># Network name: youtube</span></div><div><span style="font-family: &quot;courier&quot;;"># URL: file:///opt/youtube4tvh/youtube4tvh/youtube.m3u</span></div><div><span style="font-family: &quot;courier&quot;;"># Create bouquet: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Channel numbers start from: 1</span></div><div><span style="font-family: &quot;courier&quot;;"># Accept zero value for TSID: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Provider network name: youtube</span></div><div><span style="font-family: &quot;courier&quot;;"># Ignore provider's channel numbers: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Character set: UTF-8</span></div><div><span style="font-family: &quot;courier&quot;;"># Scan after creation: Unchecked</span></div><div><span style="font-family: &quot;courier&quot;;"># Content character set: UTF-8</span></div><div><span style="font-family: &quot;courier&quot;;"># Service ID: 1<br /></span></div><div><span style="font-family: &quot;courier&quot;;"># Hit Create<br /></span></div><div><span style="font-family: &quot;courier&quot;;"><br /></span></div><div><span style="font-family: &quot;courier&quot;;"></span></div><div>Before we move on, now is a good time to check if streamlink and the helper script are working.&nbsp; We're going to force play a few muxes (channels from your youtube.m3u playlist) to make sure that it's all good before mapping them to actual TV channels.&nbsp; (You gonna need a player for this step; if you don't have one, skip it or install VLC).<br /></div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Configuration &gt; DVB Inputs &gt; Muxes &gt; Choose a random one and Hit the Play button</span></div><br /><div>The selected stream should show up in a few seconds.&nbsp; If it doesn't, there's likely an issue with streamlink or the player or both, in which case you should stop and try to solve it before moving on.</div><div><br /></div><div><b>6.4 Mapping services to channels: Bouquets and auto-mapping</b><br /></div><div>There are two ways of mapping services to channels.&nbsp; The standard way is to go to the Services tab and choose Map Selected &gt; Map all services.&nbsp; This should work very well if your muxes won't ever change.&nbsp; However, if they do (as in our case), they won't be automatically remapped to their channel, and you gonna have to do this mapping process manually once again, multiple times.&nbsp; We don't wanna do that.&nbsp; Fortunately, there's a second way of mapping services to channels that does so automatically, even if your muxes change, and that's via <b>Bouquets</b>.&nbsp; <br /></div><div><br /></div><div>Remember that when we created the youtube IPTV network, we selected "Create a bouquet".&nbsp; Because of that, there's now a new entry in Configuration &gt; Channel / EPG &gt; Bouquets &gt; "youtube".&nbsp; So, let's go ahead and edit it a little bit:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Configuration &gt; Channel / EPG &gt; Bouquets &gt; Edit the "youtube" bouquet</span></div><div><span style="font-family: &quot;courier&quot;;"># Enabled: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Auto-map to channels: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Channel mapping options: Select all</span></div><div><span style="font-family: &quot;courier&quot;;"># Create tags: Create provider name tags, Create network name tags<br /></span></div><div><span style="font-family: &quot;courier&quot;;"># Hit Save<br /></span></div><div><br /></div><div>Wait a few seconds and go to the "Channels" tab and you should see all your channels auto-mapped to their services.&nbsp; If you make any changes to the youtube.m3u playlist, the bouquet should automatically detect those changes from now on.</div><div><br /></div><div><b>6.5 EPG data<br /></b></div><div>Some of the 24/7 news channels on Youtube (e.g., France 24, DW) actually follow the same eletronic program guide (EPG) as their Cable/Satellite broadcast.&nbsp; So, if you want, you can add EPG data to their Youtube live-stream.&nbsp; There's a fantastic program called <b>WebGrab+Plus</b> (<a href="http://webgrabplus.com/" target="_blank">http://webgrabplus.com/</a>) that can do that for you <b>for free</b>, but there's a learning curve to it and how to feed the data to TVH (netcat or curl).&nbsp; I'm planning on writing a guide about it in the near future, as I work on a parser for the site.pack folder as well.&nbsp; But if you don't feel like diving into that, you can always pay an EPG provider--<a href="https://lmgtfy.com/?q=epg+provider" target="_blank">just Google it</a>--and manually add it to your clients (bad) or try to figure it out how to feed the EPG data to the TVH server (good).<br /></div><div><br /></div><div><b>6.6 Creating and editing Users for clients</b></div><div>Clients can access TVH using the same credentials as you've been using to configure the TVH server (admin access). As a general rule of thumb, however, that's not a good practice.&nbsp; Also, if you have multiple clients, it's nice to know what each one is trying to access on your TVH server.&nbsp; So, let's go ahead and create a "client" user:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Configuration &gt; Users &gt; Access Entries &gt; Add</span></div><div><span style="font-family: &quot;courier&quot;;"># Streaming: Select all</span></div><div><span style="font-family: &quot;courier&quot;;"># Video recorder: Basic, HTSP, View All</span></div><div><span style="font-family: &quot;courier&quot;;"># Hit Create<br /></span></div><div><br /><span style="font-family: &quot;courier&quot;;"></span></div><div>Now let's add a password for it:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Configuration &gt; Users &gt; Passwords &gt; Add</span></div><div><span style="font-family: &quot;courier&quot;;"># Enabled: Checked</span></div><div><span style="font-family: &quot;courier&quot;;"># Username: client</span></div><div><span style="font-family: &quot;courier&quot;;"># Password: password</span></div><div><span style="font-family: &quot;courier&quot;;"># Hit Create</span><br /></div><div><br /></div><div>That's it!&nbsp; You can repeat this process as many times as you need and play around with permissions, depending on your use-case.</div><div><br /></div><div><b>6.7 Re-fetch period and youtube4tvh cronjobs</b></div><div>If you've a youtube m3u playlist with channels that are likely to change multiple times during the same day, then it's a good idea to create a separate playlist for those channels.&nbsp; Then, when you create a youtube4tvh cronjob for the new m3u playlist, make it run more frequently (e.g., every 5 mins would be "*/5 * * * *") and in the TVH server, add a new IPTV auto network for the new m3u playlist and in its settings, edit the "re-fetch period" to match the cronjob update interval (5); hit save and then restart the TVH server to apply the new settings. If you've done it right, the TVH server will now check the m3u playlist at an interval equal to the re-fetch period and update any new/changed mux on it, which will be automatically mapped to a channel in its bouquet.<br /></div><div><br /></div><div><br /></div><div><b><a href="#" id="tvhclient">7. TVH client</a><br /></b></div><div>There are multiple ways to watch the channels on your TVH server, including directly from the webUI itself (EPG tab &gt; Watch TV).&nbsp; The one I use is <b>Kodi</b> (<a href="https://kodi.tv/download" target="_blank">https://kodi.tv/download</a>) + <b>TVH client addon</b> because my Kodi clients also access my Plex server.<br /></div><div><br /></div><div>You can install Kodi on virtually any single-board computer, such as Raspberry Pi (<a href="https://www.raspberrypi.org/" target="_blank">https://www.raspberrypi.org/</a>) and Odroid (<a href="https://www.hardkernel.com/" target="_blank">https://www.hardkernel.com/</a>), and Linux distro.&nbsp; There are hundreds of guides showing how to install Kodi, so I won't do that.&nbsp; Instead, I'll talk about the <b>TVH client addon</b> for it.</div><div><br /></div><div><b>7.1 Install a TVH client addon for Kodi</b><br /></div><div>Open Kodi and try to install via the official repo:</div><div><font face="courier"><br /></font></div><div><font face="courier"># Go to Add-ons &gt; Install from repo &gt; PVR clients</font></div><div><font face="courier"># Look for Tvheadend HTSP Client and install it</font><br /></div><div><br /></div><div>Now, depending on the distribution, you won't see the "PVR clients" option.&nbsp; In this case, you have to manually install the TVH client.&nbsp; On Debian, for example, you can install it like so:</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Open a terminal</span></div><div><span style="font-family: &quot;courier&quot;;">sudo apt update</span></div><div><span style="font-family: &quot;courier&quot;;">sudo apt install kodi-pvr-hts</span></div><div></div><div><br /></div><div>(Another option is to download a .zip of the addon but please do your research first.&nbsp; Don't download and install addons from random repos.)&nbsp; If you didn't see any error, it means the PVR client is now available on Kodi, so open it (restart it, if it was already open) and then do the following (changing the values to the appropriate ones for your TVH server and client credentials):</div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to Add-ons &gt; My add-ons &gt; PVR clients &gt; Tvheadend HTSP Client &gt; Configure <br /></span></div><div><span style="font-family: &quot;courier&quot;;"># </span><span style="font-family: &quot;courier&quot;;"><span style="font-family: &quot;courier&quot;;">&gt; Connection Settings</span></span></div><div><span style="font-family: &quot;courier&quot;;"># IP address: The IP address of the machine hosting your TVH server</span></div><div><span style="font-family: &quot;courier&quot;;"># HTTP port: 9981</span></div><div><span style="font-family: &quot;courier&quot;;"># HTSP port: 9982</span></div><div><span style="font-family: &quot;courier&quot;;"># Username: client</span></div><div><span style="font-family: &quot;courier&quot;;"># Password: password</span></div><div><span style="font-family: &quot;courier&quot;;"># &gt; Streaming settings</span></div><div><span style="font-family: &quot;courier&quot;;"># Profile to use: htsp</span></div><div><span style="font-family: &quot;courier&quot;;"># (If your connection is pretty good, you might want to try enabling predictive tuning <br /></span></div><div><span style="font-family: &quot;courier&quot;;"># but I've had mixed results with it.)</span></div><div><span style="font-family: &quot;courier&quot;;"># Hit OK</span></div><div><span style="font-family: &quot;courier&quot;;"># Restart Kodi<br /></span></div><div><br /></div><div>If you want to play around, you can create a video profile just for this client and then set the Profile to use it.&nbsp; This could be a profile that transcodes to a particular AV codec that best fits the client hardware, for example.&nbsp; Be mindful that whenever you make a change to the addon, you'll need to restart Kodi to see the changes take effect.</div><div><br /></div><div>Test the Kodi client:<br /></div><div><br /></div><div><span style="font-family: &quot;courier&quot;;"># Go to TV &gt; Channels &gt; Play random one</span><br /></div><div><br /></div><div>If everything is working as it should, you should now be able to watch the stream from your Kodi client.&nbsp; Play around with it and try recording something, too.&nbsp; Now it's time to fine-tune your TVH server to best serve your clients.</div><div><br /></div><div>You can make further client-side changes in <b>Kodi's PVR &amp; Live TV settings menu</b>, such as mapping channels to specific numbers, behavior of changing channels, etc.<br /></div><div><br /></div><div><br /></div><div><a href="#" id="conclusion"><b><font size="4">8. Conclusion</font></b></a></div><div>Congratulations for reaching the end of this guide.&nbsp; As I said before, one of my future projects is to work on a parser for the Webgrab+Plus EPG data and then write a guide on how to implement it using the current setup.</div><div><br /></div><div>If you found this useful or have suggestions on how to improve this guide, please leave a comment and I'll try to reply asap.</div><div><br /></div><div>--CG<br /></div>